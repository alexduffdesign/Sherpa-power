<style>
  .chatbot-container {
    background-color: #403545;
    border-radius: var(--rounded-lg);
    padding: var(--spacing-6);
    color: rgb(var(--text-color, 255 255 255));
    position: relative;
    overflow: hidden;
  }

  section-chatbot .chatbot-container::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    pointer-events: none;
    border: 2px solid transparent;
    border-radius: inherit;
    background: linear-gradient(to right, #9F92FF, #DB9BFB) border-box;
    -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
    mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: destination-out;
    mask-composite: exclude;
  }

  section-chatbot .chat-messages {
    height: 35vh;
    overflow-y: auto;
  }

  .chatbot-content {
    position: relative;
    z-index: 1;
  }

  .chatbot-content .h5 {
    margin-bottom: var(--spacing-3);
  }


  /*
   .chatbot-content p {
   font-size: var(--text-sm);
   opacity: 1;
   color: white;
   }
*/

  .message .message--assistant .message__content p {
    color: #231F25;
  }

  .message--user p {
    color: white;
  }

  .chatbot-title {
    margin-bottom: var(--spacing-6);
  }

  .chatbot-subtitle {
    color: white;
    opacity: 0.7;
  }

  .message-container {
    display: flex;
    flex-direction: column;
    align-items: baseline;
  }

  .message-wrapper {
    display: flex;
    align-items: flex-end;
    width: 100%;
    margin-bottom: var(--spacing-6);
    grid-gap: var(--spacing-2);
  }

  .message-wrapper--assistant {
    justify-content: flex-start;
  }

  .message-wrapper--user {
    justify-content: flex-end;
  }

  .message {
    max-width: 80%;
    padding: var(--spacing-4);
    border-radius: 20px;
    word-wrap: break-word;
  }

  .message__icon {
    flex-shrink: 0;
    margin-right: var(--spacing-3);
    margin-top: var(--spacing-1);
    display: flex;
    /* Added to ensure proper alignment */
    align-items: center;
    /* Added to ensure proper alignment */
  }


  .message__content {
    display: flex;
    flex-direction: column;
    grid-gap: 1em;
    flex-grow: 1;
    margin-block-start: 0 important;
    font-family: inherit;
  }

  .message--assistant {
    align-self: flex-start;
    background-color: #FFFFFF;
    color: #231F25 !important;
    border-bottom-left-radius: 4px;
  }

  .message--user {
    align-self: flex-end;
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px solid #FFFFFF;
    color: white;
  }

  .message-icon {
    width: 30px;
    height: 20px;
    margin-right: var(--spacing-2);
  }

  .chat-messages {
    display: flex;
    flex-direction: column;
  }

  .chat-image {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin-top: 8px;
  }

  .chat-form {
    display: flex;
    margin-top: var(--spacing-4);
    z-index: 2;
  }

  .chat-form input {
    flex-grow: 1;
    padding: var(--spacing-3);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--rounded) 0 0 var(--rounded);
    background-color: rgba(255, 255, 255, 0.1);
    color: #FFFFFF;
  }

  .chat-form button {
    padding: var(--spacing-3);
    background-color: #FFFFFF;
    border: none;
    border-radius: 0 var(--rounded) var(--rounded) 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .button-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: var(--spacing-4);
  }

  .button.chat-button {
    margin-block-start: 0 !important;
  }


</style>

<div class="chatbot-container">
  <div class="chatbot-content">
    {% if section.settings.is_section_chatbot %}
      <div class="chatbot-title">
        <h5 class="h5">
          {%-
            render 'styled-text', content: section.settings.calculator_title | default: 'Find Out How Long The BASE 5.0 Will Power Your Appliance!', text_color: section.settings.heading_color, gradient: section.settings.heading_gradient
          -%}
        </h5>
        <p class="chatbot-subtitle">
          {{
            section.settings.calculator_subtitle | default: 'For best results be specific on your item e.g Macbook 15inch 2023'
          }}
        </p>
      </div>
    {% endif %}

    <div class="chat-messages" id="chatMessages">
      <div class="message-container" id="messageContainer">
        <!-- Messages will be dynamically added here -->
      </div>

      <!-- Sherpa typing code -->
      <div class="chat-typing">
        <div class="logo-container">
          <div class="logo-background"></div>
        </div>
        <p>Sherpa Guide Is Typing...</p>
      </div>

      <style>
        .chat-typing {
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          gap: var(--spacing-2);
          align-items: center;
          margin-bottom: var(--spacing-4);
        }

        .chat-typing p {
          color: #FFFFFF;
        }

        .logo-container {
          width: 30px;
          height: 20px;
          position: relative;
          overflow: hidden;
        }

        .logo-background {
          width: 400%;
          height: 400%;
          background-image: url('https://cdn.shopify.com/s/files/1/0641/4290/1439/files/Glow_Layers_4e88f55c-5acf-4845-996f-45d5b3849b08.png?v=1724967812');
          background-size: cover;
          position: absolute;
          top: -150%;
          left: -150%;
          animation: moveBackgroundCircular 10s linear infinite;
          clip-path: url('#logo-clip');
        }

        @keyframes moveBackgroundCircular {
          0% {
            transform: translate(0, 0) rotate(0deg);
          }
          25% {
            transform: translate(-12.5%, -12.5%) rotate(90deg);
          }
          50% {
            transform: translate(-25%, 0) rotate(180deg);
          }
          75% {
            transform: translate(-12.5%, 12.5%) rotate(270deg);
          }
          100% {
            transform: translate(0, 0) rotate(360deg);
          }
        }
      </style>

      <svg
        width="0"
        height="0"
        style="position: absolute;">
        <defs>
          <clipPath id="logo-clip" clipPathUnits="objectBoundingBox">
            <path d="M0.69522,0.00475C0.69017,0.00164,0.68255,-0.00044,0.66662,0.00008C0.65068,0.0006,0.63202,0.00267,0.62303,0.00527C0.61404,0.00786,0.59741,0.01668,0.58691,0.02498C0.57508,0.0338,0.49745,0.12563,0.39789,0.26156C0.32835,0.35888,0.26216,0.44365,0.24041,0.47547C0.23392,0.48403,0.23265,0.49465,0.23722,0.50537C0.24389,0.5213,0.25606,0.54681,0.26937,0.5744C0.29443,0.62697,0.30802,0.65205,0.31042,0.64963C0.31241,0.64755,0.38902,0.54794,0.47999,0.42861C0.57096,0.30929,0.64866,0.20916,0.65144,0.20656C0.65477,0.20397,0.66431,0.20189,0.67209,0.20189C0.68043,0.20189,0.68997,0.20605,0.69431,0.21123C0.69865,0.2159,0.73876,0.29528,0.7836,0.38761C0.84401,0.52615,0.85693,0.55795,0.85693,0.57181C0.85723,0.58063,0.85459,0.59359,0.85124,0.59931C0.84789,0.60552,0.81466,0.65014,0.77717,0.69891C0.73968,0.74716,0.70522,0.7897,0.70043,0.79281C0.69506,0.79645,0.68969,0.79696,0.68375,0.79333C0.67941,0.79074,0.66986,0.77258,0.66026,0.74938C0.65803,0.74451,0.65581,0.73997,0.65139,0.73575C0.64213,0.71784,0.62968,0.71657,0.61892,0.73057C0.61458,0.73582,0.60969,0.74181,0.60463,0.74819C0.58682,0.76895,0.56935,0.78918,0.56556,0.79437C0.56138,0.79903,0.56027,0.8075,0.56333,0.81365C0.59771,0.88494,0.61424,0.91866,0.62348,0.93497C0.63247,0.95089,0.64643,0.97077,0.65459,0.97803C0.66235,0.98478,0.67718,0.99308,0.68663,0.99567C0.69975,0.9993,0.71232,0.99878,0.72544,0.99515C0.73489,0.99204,0.75138,0.98374,0.75954,0.97647C0.7673,0.96921,0.81221,0.91577,0.85916,0.85819C0.92198,0.77984,0.94626,0.74612,0.95289,0.72745C0.95843,0.71395,0.96559,0.68853,0.9689,0.67157C0.96224,0.64496,0.96334,0.62938,0.96224,0.60396C0.96113,0.58063,0.95778,0.55728,0.95234,0.53912C0.94744,0.52,0.9039,0.42238,0.84401,0.29061C0.79084,0.16922,0.73818,0.06285,0.73044,0.05351C0.72271,0.04418,0.70946,0.03068,0.70154,0.02342C0.69361,0.01616,0.67941,0.00786,0.69522,0.00475Z M0.30667,0.02394C0.28945,0.01097,0.28071,0.00734,0.25908,0.00631C0.24374,0.00527,0.22895,0.00786,0.22122,0.01149C0.21487,0.01564,0.20477,0.02291,0.19761,0.0281C0.19045,0.03328,0.14847,0.08465,0.10271,0.14223C0.05694,0.19982,0.01635,0.25377,0.01222,0.2621C0.00808,0.27038,0.00235,0.28646,0.00029,0.29787C-0.00118,0.30929,-0.00562,0.33263,-0.00769,0.34976C-0.00976,0.37206,-0.01003,0.38971,-0.00681,0.41201C-0.0051,0.42913,0.00085,0.45352,0.00443,0.46649C0.008,0.47945,0.05664,0.58529,0.11209,0.70252C0.16753,0.81979,0.21724,0.92563,0.2246,0.93808C0.23197,0.95053,0.24707,0.96868,0.25908,0.97856C0.27723,0.99204,0.28708,0.99671,0.30667,0.9993C0.32415,1.00086,0.34104,0.99982,0.34988,0.99619C0.35793,0.99308,0.37372,0.98374,0.38206,0.97595C0.3904,0.96817,0.47588,0.86285,0.56861,0.74145C0.66153,0.62005,0.73988,0.51785,0.73988,0.51474C0.74018,0.51111,0.72271,0.47271,0.70153,0.43017C0.68983,0.40742,0.67874,0.38688,0.66818,0.37261C0.66048,0.35843,0.65218,0.35768,0.64255,0.369C0.61706,0.40248,0.55966,0.48271,0.48507,0.57544C0.36858,0.72891,0.31084,0.79956,0.30374,0.80164C0.29895,0.80319,0.28945,0.80216,0.28349,0.79904C0.27752,0.79593,0.27026,0.79022,0.26667,0.78659C0.26309,0.78296,0.22602,0.70928,0.18399,0.62213C0.14154,0.5347,0.10468,0.45715,0.10192,0.44833C0.09832,0.43587,0.09793,0.42965,0.10089,0.4172C0.10427,0.40579,0.12734,0.37466,0.18895,0.30462C0.25208,0.22732,0.26785,0.20708,0.27486,0.20708C0.2803,0.20708,0.28737,0.20916,0.29069,0.21175C0.29401,0.21435,0.30429,0.23302,0.31362,0.25326C0.32294,0.27401,0.33322,0.28958,0.33543,0.28905C0.33822,0.28802,0.35533,0.26882,0.37335,0.24599C0.38314,0.23351,0.39211,0.22136,0.39812,0.21238C0.40408,0.20356,0.40453,0.19236,0.4001,0.18169C0.39499,0.16846,0.38393,0.14889,0.37245,0.12822C0.35623,0.09294,0.33888,0.05922,0.33454,0.05248C0.33061,0.04574,0.31899,0.03328,0.30667,0.02394Z" />
          </clipPath>
        </defs>
      </svg>

    </div>


    {% render 'carousel' %}

  </div>


  <!-- Form Element ✉️ -->

  {% if section.settings.is_section_chatbot %}

    <form id="chatForm" class="chat-form">
      <input
        type="text"
        id="userInput"
        placeholder="Type your message here..."
        autocomplete="off"
        required>
      <button type="submit">
        <svg
          width="20"
          height="18"
          viewBox="0 0 20 18"
          fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <path d="M1.4 17.3984L18.85 9.91844C19.0304 9.84159 19.1842 9.71341 19.2923 9.54984C19.4004 9.38626 19.4581 9.19451 19.4581 8.99844C19.4581 8.80236 19.4004 8.61061 19.2923 8.44704C19.1842 8.28346 19.0304 8.15528 18.85 8.07844L1.4 0.598438C1.2489 0.532533 1.08377 0.505281 0.919509 0.519141C0.755246 0.533002 0.597018 0.587538 0.459098 0.67783C0.321179 0.768123 0.207908 0.891331 0.129505 1.03634C0.0511009 1.18135 0.010031 1.34359 0.00999999 1.50844L0 6.11844C0 6.61844 0.37 7.04844 0.87 7.10844L15 8.99844L0.87 10.8784C0.37 10.9484 0 11.3784 0 11.8784L0.00999999 16.4884C0.00999999 17.1984 0.74 17.6884 1.4 17.3984Z" fill="#231F25" />
        </svg>
      </button>
    </form>

  {% endif %}

<!-- Form Element ✉️ -->

</div>