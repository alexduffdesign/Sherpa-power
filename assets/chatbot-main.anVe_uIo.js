import{C as h,M as d,e as n,E as i}from"./chatbot.DfUcQSBi.js";import{g as c}from"./user-id-generator.DhYYxFTy.js";import"./vendor.DqvJXvYX.js";class u{constructor(t,e){this.core=t,this.ui=e,this.historyKey="mainChatbotHistory",this.isLaunched=!1,this.setupEventListeners()}setupEventListeners(){n.on(i.MAIN_CHATBOT.MESSAGE_RECEIVED,t=>{this.ui.addMessage("assistant",t.content)}),n.on(i.MAIN_CHATBOT.CHOICE_PRESENTED,t=>{this.ui.addButtons(t.buttons)}),n.on(i.MAIN_CHATBOT.CAROUSEL_PRESENTED,t=>{this.ui.addCarousel(t.carouselItems)}),n.on(i.MAIN_CHATBOT.ERROR,t=>{this.ui.displayError(t.message)}),n.on(i.MAIN_CHATBOT.TYPING,t=>{t.isTyping?this.ui.showTypingIndicator():this.ui.hideTypingIndicator()}),document.addEventListener("chatbotLaunch",()=>{this.launch()})}launch(){this.isLaunched||(this.core.sendLaunch(),this.isLaunched=!0)}sendMessage(t){const e=this.sanitizeInput(t);this.core.sendMessage(e),this.ui.addMessage("user",e),this.saveToHistory("user",e)}loadHistory(){const t=JSON.parse(localStorage.getItem(this.historyKey))||[];t.forEach(e=>{this.ui.addMessage(e.sender,e.message)}),t.length>0&&t[t.length-1].sender}saveToHistory(t,e){const s=JSON.parse(localStorage.getItem(this.historyKey))||[];s.push({sender:t,message:e}),localStorage.setItem(this.historyKey,JSON.stringify(s))}sanitizeInput(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("main-chatbot-ui");if(!a){console.error("Main Chatbot UI container not found");return}let t=localStorage.getItem("mainChatbotUserId");t||(t=c("mainChatbot"),localStorage.setItem("mainChatbotUserId",t));const e=new h({userID:t,endpoint:"https://chatbottings--development.gadget.app/voiceflowAPI/voiceflow-streaming",chatbotType:"main"}),s=new d(a),o=new u(e,s);o.loadHistory(),s.onUserMessage(r=>{o.sendMessage(r)}),s.onButtonClick(r=>{o.sendMessage(JSON.stringify(r))})});export{u as M};
//# sourceMappingURL=chatbot-main.anVe_uIo.js.map
