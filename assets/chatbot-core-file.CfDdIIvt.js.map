{"version":3,"file":"chatbot-core-file.CfDdIIvt.js","sources":["../node_modules/eventemitter3/index.js","../frontend/entrypoints/chatbot-core-file.js"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","// chatbot-core-file.js\n\nimport EventEmitter from \"eventemitter3\";\n\nexport class ChatbotCore extends EventEmitter {\n  constructor(config) {\n    super();\n    console.log(\"ChatbotCore constructor called with config:\", config);\n    this.apiEndpoint = config.proxyEndpoint; // URL to Gadget's streaming endpoint\n    this.projectID = config.projectID;\n    this.environment = config.environment || \"development\";\n    this.userIDPrefix = config.userIDPrefix || \"chatbot\";\n    this.userID = this.loadUserID();\n    this.messageContainer = null;\n    this.typingIndicator = null;\n    this.drawerBody = null;\n    this.defaultTypingText = \"Sherpa Guide Is Typing...\";\n    this.conversationHistory = [];\n    this.eventListenersAttached = false;\n    this.useStreaming = true; // Enable streaming by default\n\n    // Bind methods\n    this.sendMessage = this.sendMessage.bind(this);\n    this.handleStreaming = this.handleStreaming.bind(this);\n    this.gadgetInteract = this.gadgetInteract.bind(this);\n    this.addMessage = this.addMessage.bind(this);\n    this.updateLatestMessage = this.updateLatestMessage.bind(this);\n    this.parseSSE = this.parseSSE.bind(this);\n    this.handleTrace = this.handleTrace.bind(this);\n\n    console.log(\"ChatbotCore instance created:\", this);\n  }\n\n  loadUserID() {\n    // Generate or retrieve a unique user ID\n    let userID = localStorage.getItem(\"chatbotUserID\");\n    if (!userID) {\n      userID = `user_${Math.random().toString(36).substr(2, 9)}`;\n      localStorage.setItem(\"chatbotUserID\", userID);\n    }\n    return userID;\n  }\n\n  setDOMElements(messageContainer, typingIndicator, drawerBody) {\n    this.messageContainer = messageContainer;\n    this.typingIndicator = typingIndicator;\n    this.drawerBody = drawerBody;\n\n    // Setup event listeners once DOM elements are set\n    this.setupEventListeners();\n  }\n\n  setupEventListeners() {\n    if (this.eventListenersAttached) return;\n\n    // Handle button clicks within messages\n    this.messageContainer.addEventListener(\"click\", async (e) => {\n      const buttonElement = e.target.closest(\".button\");\n      if (buttonElement) {\n        const buttonData = JSON.parse(buttonElement.dataset.buttonData);\n        await this.handleButtonClick(buttonData);\n      }\n    });\n\n    this.eventListenersAttached = true;\n  }\n\n  addMessage(sender, content) {\n    if (!this.messageContainer) {\n      console.error(\"Message container not set\");\n      return;\n    }\n\n    const messageWrapper = document.createElement(\"div\");\n    messageWrapper.classList.add(\n      \"message-wrapper\",\n      `message-wrapper--${sender}`\n    );\n\n    // Optionally add an icon for the assistant\n    if (sender === \"assistant\") {\n      const iconSvg = document.createElement(\"div\");\n      iconSvg.classList.add(\"assistant-icon\");\n      iconSvg.innerHTML = `🚀`; // 🚀 Emoji as a placeholder for SVG\n      messageWrapper.appendChild(iconSvg);\n    }\n\n    const messageDiv = document.createElement(\"div\");\n    messageDiv.classList.add(\"message\", `message--${sender}`);\n    messageDiv.innerHTML = `<div class=\"message__content\">${this.markdownToHtml(\n      content\n    )}</div>`;\n\n    messageWrapper.appendChild(messageDiv);\n    this.messageContainer.appendChild(messageWrapper);\n    this.scrollToBottom();\n  }\n\n  updateLatestMessage(content) {\n    const lastAssistantMessage = this.messageContainer.querySelector(\n      \".message-wrapper--assistant:last-child .message__content\"\n    );\n    if (lastAssistantMessage) {\n      lastAssistantMessage.innerHTML += this.markdownToHtml(content);\n    } else {\n      // If no previous message, add a new one\n      this.addMessage(\"assistant\", content);\n    }\n  }\n\n  scrollToBottom() {\n    if (this.messageContainer) {\n      this.messageContainer.scrollTop = this.messageContainer.scrollHeight;\n    }\n  }\n\n  showTypingIndicator(text = this.defaultTypingText) {\n    if (this.typingIndicator) {\n      this.typingIndicator.innerText = text;\n      this.typingIndicator.style.display = \"block\";\n      this.scrollToBottom();\n    }\n  }\n\n  hideTypingIndicator() {\n    if (this.typingIndicator) {\n      this.typingIndicator.style.display = \"none\";\n    }\n  }\n\n  markdownToHtml(markdown) {\n    // Escape HTML to prevent XSS\n    const escapeHtml = (str) =>\n      str\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n        .replace(/\"/g, \"&quot;\")\n        .replace(/'/g, \"&#039;\");\n\n    let html = escapeHtml(markdown);\n\n    // Headers\n    html = html.replace(/^###### (.*)$/gm, '<h6 class=\"h6\">$1</h6>');\n    html = html.replace(/^##### (.*)$/gm, '<h6 class=\"h6\">$1</h6>');\n    html = html.replace(/^#### (.*)$/gm, '<h6 class=\"h6\">$1</h6>');\n    html = html.replace(/^### (.*)$/gm, '<h6 class=\"h6\">$1</h6>');\n    html = html.replace(/^## (.*)$/gm, '<h5 class=\"h5\">$1</h5>');\n    html = html.replace(/^# (.*)$/gm, '<h4 class=\"h4\">$1</h4>');\n\n    // Bold and Italic\n    html = html.replace(/\\*\\*\\*(.*?)\\*\\*\\*/g, \"<strong><em>$1</em></strong>\"); // Bold Italic\n    html = html.replace(/\\*\\*(.*?)\\*\\*/g, \"<strong>$1</strong>\"); // Bold\n    html = html.replace(/\\*(.*?)\\*/g, \"<em>$1</em>\"); // Italic\n\n    // Inline Code\n    html = html.replace(/`([^`]+)`/g, \"<code>$1</code>\");\n\n    // Images\n    html = html.replace(\n      /!\\[(.*?)\\]\\((.*?)\\)/g,\n      '<img src=\"$2\" alt=\"$1\" class=\"markdown-image\">'\n    );\n\n    // Links\n    html = html.replace(\n      /\\[(.*?)\\]\\((.*?)\\)/g,\n      '<a href=\"$2\" target=\"_blank\" rel=\"noopener noreferrer\">$1</a>'\n    );\n\n    // Lists\n    let inList = false;\n    html = html\n      .split(\"\\n\")\n      .map((line) => {\n        if (line.match(/^\\s*[-*+]\\s/)) {\n          if (!inList) {\n            inList = true;\n            return \"<ul>\\n<li>\" + line.replace(/^\\s*[-*+]\\s/, \"\") + \"</li>\";\n          }\n          return \"<li>\" + line.replace(/^\\s*[-*+]\\s/, \"\") + \"</li>\";\n        } else if (line.match(/^\\s*\\d+\\.\\s/)) {\n          if (!inList) {\n            inList = true;\n            return \"<ol>\\n<li>\" + line.replace(/^\\s*\\d+\\.\\s/, \"\") + \"</li>\";\n          }\n          return \"<li>\" + line.replace(/^\\s*\\d+\\.\\s/, \"\") + \"</li>\";\n        } else if (inList && line.trim() === \"\") {\n          inList = false;\n          return \"</ul>\\n\";\n        } else {\n          return line;\n        }\n      })\n      .join(\"\\n\");\n\n    if (inList) {\n      html += \"\\n</ul>\";\n    }\n\n    // Horizontal Rule\n    html = html.replace(/^---$/gm, \"<hr>\");\n\n    // Blockquotes\n    html = html.replace(/^>\\s(.*)$/gm, \"<blockquote>$1</blockquote>\");\n\n    // Remove excessive asterisks (more than 3)\n    html = html.replace(/\\*{4,}/g, \"\");\n\n    // Split content into paragraphs\n    const paragraphs = html.split(/\\n{2,}/);\n\n    // Wrap each paragraph with <p> tags, handling special cases\n    html = paragraphs\n      .map((para) => {\n        // Don't wrap headers, lists, blockquotes, horizontal rules, or images in <p> tags\n        if (\n          para.startsWith(\"<h\") ||\n          para.startsWith(\"<ul\") ||\n          para.startsWith(\"<ol\") ||\n          para.startsWith(\"<blockquote\") ||\n          para.startsWith(\"<hr\") ||\n          para.startsWith(\"<img\")\n        ) {\n          return para;\n        }\n        return `<p>${para}</p>`;\n      })\n      .join(\"\\n\");\n\n    return html;\n  }\n\n  async sendMessage(message) {\n    console.log(\"sendMessage called with:\", message);\n    this.addMessage(\"user\", message);\n    this.conversationHistory.push({ type: \"user\", message });\n    this.saveConversationToStorage();\n\n    try {\n      await this.handleStreaming({\n        action: {\n          type: \"text\",\n          payload: message,\n        },\n        config: {\n          completion_events: true,\n        },\n      });\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      this.addMessage(\n        \"assistant\",\n        \"Sorry, something went wrong. Please try again.\"\n      );\n    }\n  }\n\n  async sendLaunch() {\n    console.log(\"Sending chatbot launch request\");\n\n    try {\n      await this.handleStreaming({\n        action: {\n          type: \"launch\",\n        },\n        config: {\n          completion_events: true,\n        },\n      });\n    } catch (error) {\n      console.error(\"Error during launch:\", error);\n      this.addMessage(\n        \"assistant\",\n        \"Failed to initialize the chatbot. Please try again later.\"\n      );\n    }\n  }\n\n  async handleStreaming(payload) {\n    console.log(\"Handling streaming interaction with payload:\", payload);\n\n    try {\n      const response = await fetch(this.apiEndpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          userID: this.userID,\n          action: payload.action,\n          config: payload.config,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error(\"Gadget Streaming API error:\", errorText);\n        throw new Error(\n          `Gadget Streaming API error: ${response.status} - ${errorText}`\n        );\n      }\n\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder(\"utf-8\");\n      let buffer = \"\";\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        buffer += decoder.decode(value, { stream: true });\n\n        let boundary = buffer.indexOf(\"\\n\\n\");\n        while (boundary !== -1) {\n          const eventStr = buffer.substring(0, boundary);\n          buffer = buffer.substring(boundary + 2);\n          this.parseSSE(eventStr);\n          boundary = buffer.indexOf(\"\\n\\n\");\n        }\n      }\n    } catch (streamError) {\n      console.error(\"Error during stream processing:\", streamError);\n      this.addMessage(\n        \"assistant\",\n        \"An error occurred while processing your request.\"\n      );\n      this.hideTypingIndicator();\n    }\n  }\n\n  parseSSE(eventStr) {\n    const lines = eventStr.split(\"\\n\");\n    let eventType = null;\n    let data = null;\n\n    lines.forEach((line) => {\n      if (line.startsWith(\"event:\")) {\n        eventType = line.replace(\"event:\", \"\").trim();\n      } else if (line.startsWith(\"data:\")) {\n        data = line.replace(\"data:\", \"\").trim();\n      }\n    });\n\n    if (eventType === \"trace\" && data) {\n      try {\n        const trace = JSON.parse(data);\n        this.handleTrace(trace);\n      } catch (error) {\n        console.error(\"Error parsing trace data:\", error);\n      }\n    } else if (eventType === \"end\") {\n      console.log(\"Stream ended\");\n      this.hideTypingIndicator();\n    }\n  }\n\n  handleTrace(trace) {\n    console.log(\"Handling trace:\", trace);\n    if (trace.type === \"text\") {\n      this.addMessage(\"assistant\", trace.payload.message);\n      this.conversationHistory.push({\n        type: \"assistant\",\n        message: trace.payload.message,\n      });\n    } else if (trace.type === \"completion\") {\n      if (trace.payload.state === \"start\") {\n        this.showTypingIndicator(\"Sherpa Guide is typing...\");\n      } else if (trace.payload.state === \"content\") {\n        this.updateLatestMessage(trace.payload.content);\n        // Append to the last assistant message\n        const lastMessage =\n          this.conversationHistory[this.conversationHistory.length - 1];\n        if (lastMessage && lastMessage.type === \"assistant\") {\n          lastMessage.message += trace.payload.content;\n        }\n      } else if (trace.payload.state === \"end\") {\n        this.hideTypingIndicator();\n      }\n    } else if (trace.type === \"choice\") {\n      this.addButtons(trace.payload.buttons);\n      this.conversationHistory.push({\n        type: \"choice\",\n        buttons: trace.payload.buttons,\n      });\n    } else if (trace.type === \"carousel\") {\n      this.addCarousel(trace.payload);\n      this.conversationHistory.push({ type: \"carousel\", data: trace.payload });\n    } else if (\n      trace.type === \"visual\" &&\n      trace.payload.visualType === \"image\"\n    ) {\n      this.addVisualImage(trace.payload);\n      this.conversationHistory.push({ type: \"visual\", data: trace.payload });\n    } else if (trace.type === \"error\") {\n      this.addMessage(\n        \"assistant\",\n        \"An error occurred: \" + trace.payload.message\n      );\n    } else {\n      console.log(\"Unknown trace type:\", trace.type);\n    }\n    this.saveConversationToStorage();\n  }\n\n  addButtons(buttons) {\n    console.log(\"Adding buttons:\", buttons);\n    const buttonContainer = document.createElement(\"div\");\n    buttonContainer.classList.add(\"button-container\");\n\n    buttons.forEach((button) => {\n      const buttonElement = document.createElement(\"button\");\n      buttonElement.classList.add(\"button\");\n      buttonElement.textContent = button.name;\n      buttonElement.dataset.buttonData = JSON.stringify(button);\n      buttonContainer.appendChild(buttonElement);\n    });\n\n    if (this.messageContainer) {\n      this.messageContainer.appendChild(buttonContainer);\n      this.scrollToBottom();\n    } else {\n      console.error(\"Message container not found when adding buttons\");\n    }\n\n    this.conversationHistory.push({ type: \"buttons\", buttons });\n    this.saveConversationToStorage();\n  }\n\n  removeButtons() {\n    const buttonContainers =\n      this.messageContainer.querySelectorAll(\".button-container\");\n    buttonContainers.forEach((container) => container.remove());\n  }\n\n  async handleButtonClick(button) {\n    console.log(\"Button clicked:\", button);\n    this.removeButtons();\n    this.addMessage(\"user\", button.name);\n    this.conversationHistory.push({ type: \"user\", message: button.name });\n    this.saveConversationToStorage();\n\n    this.showTypingIndicator();\n    try {\n      await this.handleStreaming({\n        action: {\n          type: \"button_click\",\n          payload: button.request,\n        },\n        config: {\n          completion_events: true,\n        },\n      });\n    } catch (error) {\n      console.error(\"Error handling button click:\", error);\n      this.addMessage(\n        \"assistant\",\n        \"Sorry, something went wrong. Please try again.\"\n      );\n    }\n  }\n\n  addVisualImage(payload) {\n    console.log(\"Adding visual image:\", payload);\n    if (!this.messageContainer) {\n      console.error(\"Message container not set\");\n      return;\n    }\n\n    const imageWrapper = document.createElement(\"div\");\n    imageWrapper.classList.add(\"message-wrapper\", \"message-wrapper--assistant\");\n\n    const imageElement = document.createElement(\"img\");\n    imageElement.src = payload.image;\n    imageElement.alt = \"Visual content\";\n    imageElement.classList.add(\"chat-image\");\n\n    // Set dimensions if available\n    if (payload.dimensions) {\n      imageElement.width = payload.dimensions.width;\n      imageElement.height = payload.dimensions.height;\n    }\n\n    // Add loading and error handling\n    imageElement.loading = \"lazy\";\n    imageElement.onerror = () => {\n      console.error(\"Failed to load image:\", payload.image);\n      imageElement.alt = \"Failed to load image\";\n    };\n\n    imageWrapper.appendChild(imageElement);\n    this.messageContainer.appendChild(imageWrapper);\n    this.scrollToBottom();\n  }\n\n  addCarousel(carouselData) {\n    console.log(\"Adding carousel:\", carouselData);\n    const carouselElement = document.createElement(\"div\");\n    carouselElement.className = \"carousel\";\n    carouselElement.innerHTML = `\n      <div class=\"carousel__container\">\n        <!-- Carousel items will be dynamically added here -->\n      </div>\n      <button class=\"carousel__button carousel__button--left\" aria-label=\"Previous slide\">\n        🚀 <!-- Left Arrow SVG Placeholder -->\n      </button>\n      <button class=\"carousel__button carousel__button--right\" aria-label=\"Next slide\">\n        🚀 <!-- Right Arrow SVG Placeholder -->\n      </button>\n    `;\n\n    const carousel = new Carousel(carouselElement);\n\n    carouselData.cards.forEach((card, index) => {\n      const itemContent = `\n        <div class=\"carousel__item-wrapper\">\n          <div class=\"carousel__item-content\">\n            <img src=\"${card.imageUrl}\" alt=\"${card.title}\" class=\"carousel__item-image\">\n            <h6 class=\"carousel__item-title\">${card.title}</h6>\n            <p class=\"carousel__item-description\">${card.description.text}</p>\n            <button class=\"button carousel__item-button\" data-button-index=\"${index}\">${card.buttons[0].name}</button>\n          </div>\n        </div>\n      `;\n\n      carousel.addItem(itemContent);\n    });\n\n    const buttons = carouselElement.querySelectorAll(\".carousel__item-button\");\n    buttons.forEach((button, index) => {\n      button.addEventListener(\"click\", async () => {\n        const cardIndex = Math.floor(\n          index / carouselData.cards[0].buttons.length\n        );\n        const buttonIndex = index % carouselData.cards[0].buttons.length;\n        const buttonData = carouselData.cards[cardIndex].buttons[buttonIndex];\n        try {\n          // Remove the carousel element\n          carouselElement.remove();\n\n          // Save button click as a message\n          this.addMessage(\"user\", buttonData.name);\n          this.conversationHistory.push({\n            type: \"user\",\n            message: buttonData.name,\n          });\n          this.saveConversationToStorage();\n\n          await this.handleButtonClick(buttonData);\n        } catch (error) {\n          console.error(\"Error handling carousel button click:\", error);\n        }\n      });\n    });\n\n    if (this.messageContainer) {\n      this.messageContainer.appendChild(carouselElement);\n      this.scrollToBottom();\n    } else {\n      console.error(\"Message container not found when adding carousel\");\n    }\n  }\n\n  // Additional helper methods can be added here\n}\n\n// Carousel Class\nclass Carousel {\n  constructor(element) {\n    this.element = element;\n    this.container = element.querySelector(\".carousel__container\");\n    this.leftButton = element.querySelector(\".carousel__button--left\");\n    this.rightButton = element.querySelector(\".carousel__button--right\");\n    this.items = [];\n    this.currentIndex = 0;\n\n    this.mediaQuery = window.matchMedia(\"(min-width: 1000px)\");\n    this.isDesktop = this.mediaQuery.matches;\n\n    this.leftButton.addEventListener(\"click\", () => this.move(\"left\"));\n    this.rightButton.addEventListener(\"click\", () => this.move(\"right\"));\n\n    this.mediaQuery.addListener(this.handleMediaQueryChange.bind(this));\n  }\n\n  handleMediaQueryChange(e) {\n    this.isDesktop = e.matches;\n    this.currentIndex = 0;\n    this.updatePosition();\n    this.updateVisibility();\n  }\n\n  addItem(content) {\n    const item = document.createElement(\"div\");\n    item.className = \"carousel__item\";\n    item.innerHTML = content;\n    this.container.appendChild(item);\n    this.items.push(item);\n    this.updateVisibility();\n  }\n\n  move(direction) {\n    const itemsPerSlide = this.isDesktop ? 2 : 1;\n    if (direction === \"left\") {\n      this.currentIndex = Math.max(0, this.currentIndex - itemsPerSlide);\n    } else {\n      this.currentIndex = Math.min(\n        this.items.length - itemsPerSlide,\n        this.currentIndex + itemsPerSlide\n      );\n    }\n    this.updatePosition();\n    this.updateVisibility();\n  }\n\n  updatePosition() {\n    const itemsPerSlide = this.isDesktop ? 2 : 1;\n    const offset = -(this.currentIndex / itemsPerSlide) * 100;\n    this.container.style.transform = `translateX(${offset}%)`;\n  }\n\n  updateVisibility() {\n    const itemsPerSlide = this.isDesktop ? 2 : 1;\n    this.leftButton.style.display = this.currentIndex === 0 ? \"none\" : \"flex\";\n    this.rightButton.style.display =\n      this.currentIndex >= this.items.length - itemsPerSlide ? \"none\" : \"flex\";\n  }\n}\n"],"names":["has","prefix","Events","EE","fn","context","once","addListener","emitter","event","listener","evt","clearEvent","EventEmitter","names","events","name","handlers","i","l","ee","listeners","a1","a2","a3","a4","a5","len","args","length","j","module","ChatbotCore","config","userID","messageContainer","typingIndicator","drawerBody","buttonElement","buttonData","sender","content","messageWrapper","iconSvg","messageDiv","lastAssistantMessage","text","markdown","html","str","inList","line","para","message","error","payload","response","errorText","reader","decoder","buffer","done","value","boundary","eventStr","streamError","lines","eventType","data","trace","lastMessage","buttons","buttonContainer","button","container","imageWrapper","imageElement","carouselData","carouselElement","carousel","Carousel","card","index","itemContent","cardIndex","buttonIndex","element","item","direction","itemsPerSlide","offset"],"mappings":"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","x_google_ignoreList":[0]}