console.log("Recent changes check : 3");class i{constructor(t){console.log("ChatbotCore constructor called with config:",t),this.apiEndpoint=t.apiEndpoint,this.userID=this.loadUserID(),this.messageContainer=null,this.typingIndicator=null,this.drawerBody=null,this.sendMessage=this.sendMessage.bind(this),this.gadgetInteract=this.gadgetInteract.bind(this),this.addMessage=this.addMessage.bind(this),console.log("ChatbotCore instance created:",this)}loadUserID(){let t=localStorage.getItem("chatbotUserID");return t||(t=`user_${Math.floor(Math.random()*1e15)}`,localStorage.setItem("chatbotUserID",t)),console.log("ChatbotCore userID loaded:",t),t}setDOMElements(t,e,o){console.log("setDOMElements called:",{messageContainer:t,typingIndicator:e,drawerBody:o}),this.messageContainer=t,this.typingIndicator=e,this.drawerBody=o,console.log("DOM elements set:",this)}scrollToBottom(){this.drawerBody?setTimeout(()=>{this.drawerBody.scrollTop=this.drawerBody.scrollHeight},100):console.error("Drawer body element not found for scrolling")}async sendMessage(t){console.log("sendMessage called with:",t),console.log("this in sendMessage:",this);try{const e=await this.gadgetInteract({userAction:{type:"text",payload:t}});return console.log("gadgetInteract response:",e),this.hideTypingIndicator(),e}catch(e){throw console.error("Error sending message:",e),this.hideTypingIndicator(),e}}async sendLaunch(t={}){console.log("ChatbotCore sendLaunch called with payload:",t),this.showTypingIndicator();try{const e=await this.gadgetInteract(t);return console.log("Launch response:",e),e}catch(e){throw console.error("Error launching conversation:",e),e}finally{this.hideTypingIndicator()}}async gadgetInteract(t){console.log("Sending payload to Gadget:",t);const e={userID:this.userID,userAction:t.userAction||t},o=await fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok)throw new Error(`Gadget API error: ${o.status}`);return await o.json()}showTypingIndicator(){console.log("Showing typing indicator"),this.typingIndicator&&(this.typingIndicator.style.display="flex",this.typingIndicator.classList.add("active"),this.scrollToBottom())}hideTypingIndicator(){console.log("Hiding typing indicator"),this.typingIndicator&&(this.typingIndicator.style.display="none",this.typingIndicator.classList.remove("active"))}addMessage(t,e){if(console.log(`Adding message from ${t}: ${e}`),this.messageContainer){const o=document.createElement("div");o.classList.add("message",`message--${t}`),o.innerHTML=this.markdownToHtml(e),this.messageContainer.appendChild(o),this.scrollToBottom()}}markdownToHtml(t){return t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank">$1</a>').replace(/\n/g,"<br>")}addButtons(t){console.log("Adding buttons:",t);const e=document.createElement("div");e.classList.add("button-container"),t.forEach(o=>{const s=document.createElement("button");s.classList.add("button"),s.textContent=o.name,s.dataset.buttonData=JSON.stringify(o),e.appendChild(s)}),this.messageContainer?(this.messageContainer.appendChild(e),this.scrollToBottom()):console.error("Message container not found when adding buttons")}removeButtons(){this.messageContainer.querySelectorAll(".button-container").forEach(e=>e.remove())}async handleButtonClick(t){console.log("Button clicked:",t),this.removeButtons(),this.addMessage("user",t.name),this.showTypingIndicator();try{const e=await this.gadgetInteract({userID:this.userID,userAction:t.request});return this.hideTypingIndicator(),e}catch(e){throw console.error("Error handling button click:",e),this.hideTypingIndicator(),e}}}console.log("ChatbotCore module loaded");export{i as C};
//# sourceMappingURL=chatbot-core-file-GUDIJpp1.js.map
