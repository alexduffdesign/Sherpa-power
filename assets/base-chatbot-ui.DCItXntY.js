import"./vendor.DqvJXvYX.js";import{p as h}from"./markdown-util.DadijVe3.js";class p{constructor(e){if(!e.container)throw new Error("ChatbotUI requires a container element");if(!e.eventBus)throw new Error("ChatbotUI requires an event bus");this.container=e.container,this.eventBus=e.eventBus,this.type=e.type,this.currentAssistantMessage=null,this.setupUIElements(),this.setupEventListeners()}setupUIElements(){var n;const e=this.container.querySelectorAll(".message-container");this.messageContainer=e[0];const t=this.container.querySelectorAll(".chat-form");this.form=t[0];const s=this.container.querySelectorAll(".chatbot-input");this.input=s[0];const i=this.container.querySelectorAll(".chat-typing");if(this.typingIndicator=i[0],this.typingText=(n=this.typingIndicator)==null?void 0:n.querySelector(".typing-text"),this.chatMessages=this.container.querySelector(".chat-messages"),console.log("Container HTML:",this.container.innerHTML),!this.messageContainer||!this.form||!this.input){const o=[];throw this.messageContainer||o.push("message-container"),this.form||o.push("chat-form"),this.input||o.push("chatbot-input"),new Error(`Required UI elements not found: ${o.join(", ")}`)}}setupEventListeners(){this.form.addEventListener("submit",e=>{e.preventDefault();const t=this.input.value.trim();t&&(this.removeInteractiveElements(),this.showTypingIndicator("Sherpa Guide Thinking..."),this.addMessage("user",t,null,!1),this.eventBus.emit("userMessage",t),this.input.value="")}),this.eventBus.on("typing",({isTyping:e,message:t})=>{e?this.showTypingIndicator(t):this.hideTypingIndicator()}),this.eventBus.on("waitingText",({text:e})=>{this.showTypingIndicator(e)}),this.eventBus.on("buttonClicked",e=>{const t=e.label||"Button clicked";this.showTypingIndicator(),this.addMessage("user",t,null,!1),this.eventBus.emit("sendAction",e.action),this.removeInteractiveElements()}),this.eventBus.on("assistantMessageStreamed",({content:e})=>{this.handleAssistantStreamedMessage(e),console.log("assistnatmessageStreamed activated",e)}),this.eventBus.on("assistantMessageNonStreamed",({content:e,metadata:t})=>{this.handleAssistantNonStreamedMessage(e,t)}),this.eventBus.on("error",({message:e})=>{this.displayError(e)}),this.eventBus.on("choicePresented",({buttons:e})=>{this.addButtons(e)}),this.eventBus.on("carouselPresented",({items:e})=>{this.addCarousel(e)}),this.eventBus.on("end",()=>{this.currentAssistantMessage=null,this.hideTypingIndicator()}),this.eventBus.on("deviceSources",({sources:e})=>{this.addDeviceSources(e)})}handleAssistantStreamedMessage(e){this.currentAssistantMessage?this.currentAssistantMessage.appendHTMLContent(e):(this.currentAssistantMessage=this.createMessage("assistant","",null,!1,void 0,!0),this.messageContainer.appendChild(this.currentAssistantMessage),this.currentAssistantMessage.setAttribute("content",e),this.currentAssistantMessage.appendHTMLContent(e),this.scrollToBottom())}handleAssistantNonStreamedMessage(e,t){const s=h(e),i=this.createMessage("assistant",s,t,!0,4,!1);this.messageContainer.appendChild(i),this.hideTypingIndicator(),this.scrollToBottom()}createMessage(e,t,s=null,i=!0,n,o=!1){const a=document.createElement("message-component");return a.eventBus=this.eventBus,a.setAttribute("sender",e),a.setAttribute("content",t),o&&a.setAttribute("streaming",""),s&&a.setAttribute("metadata",JSON.stringify(s)),i||a.setAttribute("data-animate","false"),n&&a.setAttribute("data-animation-speed",n.toString()),a}addButtons(e,t=!1){if(!Array.isArray(e)){console.error("Invalid buttons data:",e);return}const s=document.createElement("div");s.className="button-group",e.forEach(i=>{const n=document.createElement("button-component");n.eventBus=this.eventBus,n.setAttribute("label",i.name),n.setAttribute("payload",JSON.stringify(i.request)),s.appendChild(n)}),this.messageContainer.appendChild(s),this.scrollToBottom()}addCarousel(e,t=!1){if(!Array.isArray(e)){console.error("Invalid carousel items:",e);return}const s=document.createElement("carousel-component");s.eventBus=this.eventBus,s.setAttribute("data-carousel",JSON.stringify({cards:e})),this.messageContainer.appendChild(s),this.scrollToBottom()}showTypingIndicator(e="Sherpa Guide Thinking"){this.typingIndicator&&(this.typingIndicator.style.display="flex",e&&this.typingText&&(this.typingText.textContent=e),this.scrollToBottom())}hideTypingIndicator(){this.typingIndicator&&(this.typingIndicator.style.display="none")}displayError(e){const t=document.createElement("div");t.classList.add("error-message"),t.textContent=e,this.messageContainer.appendChild(t),this.scrollToBottom()}removeInteractiveElements(){this.messageContainer.querySelectorAll("button-component, carousel-component, .button-group").forEach(t=>t.remove())}scrollToBottom(){var e,t;if(this.type==="main"){const s=(t=(e=this.container.closest("custom-drawer"))==null?void 0:e.shadowRoot)==null?void 0:t.querySelector('[part="body"]');s&&(s.scrollTop=s.scrollHeight)}else this.chatMessages.scrollTop=this.chatMessages.scrollHeight}destroy(){this.abortController&&this.abortController.abort(),this.eventBus.removeAllListeners()}addMessage(e,t,s=null,i=!1,n=!1){const o=e==="assistant"&&!n?h(t):t,a=e==="assistant"&&!i,c=i?2:void 0,l=this.createMessage(e,o,s,a,c,n);this.messageContainer.appendChild(l),this.scrollToBottom()}addDeviceSources(e){const t=document.createElement("div");t.className="device-sources";const s=document.createElement("h4");s.className="device-sources__title",s.textContent="Sources Used For Device Calculations",t.appendChild(s),e.forEach(i=>{const n=document.createElement("div");n.className="device-sources__section";const o=document.createElement("div");o.className="device-sources__device",o.textContent=i.name.charAt(0).toUpperCase()+i.name.slice(1),n.appendChild(o);const a=document.createElement("ul");a.className="device-sources__list",i.sources.forEach(c=>{const l=document.createElement("li"),r=document.createElement("a");r.href=c,r.target="_blank",r.rel="noopener noreferrer",r.textContent=new URL(c).hostname,l.appendChild(r),a.appendChild(l)}),n.appendChild(a),t.appendChild(n)}),this.messageContainer.appendChild(t),this.scrollToBottom()}}export{p as C};
//# sourceMappingURL=base-chatbot-ui.DCItXntY.js.map
