{"version":3,"file":"chatbot-components.DhHnUHM_.js","sources":["../frontend/utils/event-bus.js","../frontend/utils/event-constants.js","../frontend/core/chatbot-core.js","../frontend/ui/chatbot-main-ui.js","../frontend/components/ui/button-component.js","../frontend/components/ui/message-component.js","../frontend/components/ui/carousel-component.js","../frontend/components/ui/chatbot-components.js","../frontend/ui/chatbot-section-ui.js"],"sourcesContent":["// /assets/scripts/chatbot/utils/event-bus.js\n\nimport EventEmitter from \"eventemitter3\";\n\n/**\n * EventBus Class\n * Extends the EventEmitter from eventemitter3 to create a centralized event hub.\n */\nclass EventBus extends EventEmitter {}\n\n/**\n * Singleton instance of EventBus\n * Ensures that all modules import the same EventBus instance.\n */\nconst eventBus = new EventBus();\n\nexport default eventBus;\n","// /assets/scripts/chatbot/utils/event-constants.js\n\n/**\n * EVENTS Object\n * Defines all the event names used by the Main Chatbot and Section Chatbot.\n * Namespacing ensures that events are uniquely identified and do not conflict.\n */\nexport const EVENTS = {\n  MAIN_CHATBOT: {\n    MESSAGE_RECEIVED: \"mainChatbot:messageReceived\",\n    TYPING: \"mainChatbot:typing\",\n    CHOICE_PRESENTED: \"mainChatbot:choicePresented\",\n    CAROUSEL_PRESENTED: \"mainChatbot:carouselPresented\",\n    ERROR: \"mainChatbot:error\",\n    // Additional events can be added here as needed\n  },\n  SECTION_CHATBOT: {\n    MESSAGE_RECEIVED: \"sectionChatbot:messageReceived\",\n    DEVICE_ANSWER: \"sectionChatbot:deviceAnswer\",\n    CHOICE_PRESENTED: \"sectionChatbot:choicePresented\",\n    CAROUSEL_PRESENTED: \"sectionChatbot:carouselPresented\",\n    ERROR: \"sectionChatbot:error\",\n    // Additional events can be added here as needed\n  },\n};\n","// /assets/scripts/chatbot/core/chatbot-core.js\n\nimport eventBus from \"../utils/event-bus.js\";\nimport { EVENTS } from \"../utils/event-constants.js\";\n\n/**\n * ChatbotCore Class\n * Handles communication with Voiceflow API via Gadget API, processes incoming data,\n * manages Voiceflow variables, and emits events based on trace types.\n */\nclass ChatbotCore {\n  constructor({ userID, endpoint, chatbotType }) {\n    if (!userID) {\n      throw new Error(\"ChatbotCore requires a userID.\");\n    }\n    if (!endpoint) {\n      throw new Error(\"ChatbotCore requires an endpoint URL.\");\n    }\n    if (!chatbotType) {\n      throw new Error(\n        'ChatbotCore requires a chatbotType (\"main\" or \"section\").'\n      );\n    }\n\n    this.userID = userID;\n    this.endpoint = endpoint;\n    this.chatbotType = chatbotType; // 'main' or 'section'\n    this.eventPrefix =\n      chatbotType === \"main\" ? \"mainChatbot\" : \"sectionChatbot\";\n\n    this.abortController = null; // For aborting the fetch request if needed\n\n    this.initialize();\n  }\n\n  initialize() {\n    // Initial setup if needed\n  }\n\n  /**\n   * Sends a launch request to initiate the conversation.\n   */\n  sendLaunch(variables = {}) {\n    console.log(\"Constructing launch payload\");\n    const payload = {\n      action: {\n        type: \"launch\",\n      },\n    };\n    console.log(\"Final launch payload:\", payload);\n\n    return this.sendAction(payload);\n  }\n\n  /**\n   * Sends a user message to the chatbot.\n   * @param {string} message - The user's message.\n   */\n  sendMessage(message) {\n    console.log(\"Constructing message payload:\", message);\n    const payload = {\n      action: {\n        type: \"text\",\n        payload: message,\n      },\n    };\n    console.log(\"Final message payload:\", payload);\n\n    return this.sendAction(payload);\n  }\n\n  /**\n   * Sends an action (launch, message, etc.) to the Gadget API via POST and handles SSE response.\n   * @param {Object} actionPayload - The action payload to send.\n   */\n  async sendAction(actionPayload) {\n    this.abortController = new AbortController();\n    const { signal } = this.abortController;\n\n    try {\n      const response = await fetch(this.endpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          userID: this.userID,\n          action: actionPayload.action,\n          config: actionPayload.config,\n        }),\n        credentials: \"include\", // Include cookies if needed\n        signal: signal,\n      });\n\n      if (!response.ok) {\n        throw new Error(`Gadget API responded with status ${response.status}`);\n      }\n\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder(\"utf-8\");\n      let buffer = \"\";\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) {\n          eventBus.emit(`${this.eventPrefix}:end`, {});\n          break;\n        }\n\n        buffer += decoder.decode(value, { stream: true });\n        const events = buffer.split(\"\\n\\n\");\n        buffer = events.pop(); // Remaining partial event\n\n        events.forEach((eventStr) => {\n          if (eventStr.trim() === \"\") return;\n          try {\n            const lines = eventStr.split(\"\\n\");\n            const eventTypeLine = lines.find((line) =>\n              line.startsWith(\"event:\")\n            );\n            const dataLine = lines.find((line) => line.startsWith(\"data:\"));\n\n            const eventType = eventTypeLine\n              ? eventTypeLine.split(\":\")[1].trim()\n              : \"trace\";\n            const data = dataLine\n              ? JSON.parse(\n                  eventStr.substring(eventStr.indexOf(\"data:\") + 5).trim()\n                )\n              : null;\n\n            if (eventType === \"trace\") {\n              this.processTrace(data);\n            } else if (eventType === \"end\") {\n              eventBus.emit(`${this.eventPrefix}:end`, {});\n            }\n            // Handle other event types if necessary\n          } catch (error) {\n            console.error(\"Error parsing SSE event:\", error);\n          }\n        });\n      }\n    } catch (error) {\n      if (error.name === \"AbortError\") {\n        console.warn(\"SSE connection aborted\");\n      } else {\n        console.error(\"SSE connection error:\", error);\n        eventBus.emit(`${this.eventPrefix}:error`, { message: error.message });\n      }\n    } finally {\n      this.abortController = null;\n      eventBus.emit(`${this.eventPrefix}:end`, {});\n    }\n  }\n\n  /**\n   * Processes individual trace events and emits corresponding events via EventBus.\n   * @param {Object} trace - The trace object received from Voiceflow.\n   */\n  processTrace(trace) {\n    if (!trace.type) {\n      console.warn(\"Trace without type received:\", trace);\n      return;\n    }\n\n    switch (trace.type) {\n      case \"text\":\n        console.log(\"Text received trace:\", trace);\n        eventBus.emit(`${this.eventPrefix}:messageReceived`, {\n          content: trace.payload.message,\n          metadata: trace.payload.metadata || null, // Include metadata if available\n        });\n        break;\n      case \"choice\":\n        console.log(\"Choice received trace:\", trace);\n        eventBus.emit(`${this.eventPrefix}:choicePresented`, {\n          buttons: trace.payload.buttons,\n        });\n        break;\n      case \"carousel\":\n        console.log(\"Carousel received trace:\", trace);\n        eventBus.emit(`${this.eventPrefix}:carouselPresented`, {\n          carouselItems: trace.payload.cards,\n        });\n        break;\n      case \"speak\":\n        console.log(\"Speak received trace:\", trace);\n        // Handle speak traces if necessary\n        break;\n      case \"visual\":\n        console.log(\"Visual received trace:\", trace);\n        // Handle visual traces if necessary\n        break;\n      case \"no-reply\":\n        console.log(\"No-reply received trace:\", trace);\n        // Handle no-reply traces if necessary\n        break;\n      case \"end\":\n        console.log(\"End trace received:\", trace);\n        eventBus.emit(`${this.eventPrefix}:end`, {});\n        break;\n      case \"completion-events\":\n        console.log(\"Completion event trace received:\", trace);\n        // Handle completion events if necessary\n        break;\n      default:\n        console.warn(`Unhandled trace type: ${trace.type}`, trace);\n    }\n  }\n\n  /**\n   * Closes the SSE connection gracefully.\n   */\n  closeConnection() {\n    if (this.abortController) {\n      this.abortController.abort();\n      console.log(\"SSE connection closed.\");\n    }\n  }\n\n  /**\n   * Cleans up resources when the ChatbotCore instance is no longer needed.\n   */\n  destroy() {\n    this.closeConnection();\n    eventBus.removeAllListeners(`${this.eventPrefix}:messageReceived`);\n    eventBus.removeAllListeners(`${this.eventPrefix}:choicePresented`);\n    eventBus.removeAllListeners(`${this.eventPrefix}:carouselPresented`);\n    eventBus.removeAllListeners(`${this.eventPrefix}:deviceAnswer`);\n    eventBus.removeAllListeners(`${this.eventPrefix}:error`);\n    eventBus.removeAllListeners(`${this.eventPrefix}:typing`);\n    eventBus.removeAllListeners(`${this.eventPrefix}:end`);\n  }\n}\n\nexport default ChatbotCore;\n","// /assets/scripts/chatbot/main/main-chatbot-ui.js\n\nimport eventBus from \"../utils/event-bus.js\";\nimport { EVENTS } from \"../utils/event-constants.js\";\n\n/**\n * MainChatbotUI Class\n * Handles UI-specific functionalities for the Main Chatbot.\n */\nclass MainChatbotUI {\n  constructor(container) {\n    this.container = container;\n    this.form = this.container.querySelector(\".chat-form\");\n    this.input = this.container.querySelector(\"input[type='text']\");\n    this.messageContainer = this.container.querySelector(\".message-container\");\n\n    console.log(\"Chatbot UI Container:\", this.container);\n    console.log(\"Chat Form:\", this.form);\n    console.log(\"Chat Input:\", this.input);\n    console.log(\"Message Container:\", this.messageContainer);\n\n    if (!this.container) {\n      console.error(\"Main Chatbot UI container not found\");\n      return;\n    }\n\n    if (!this.form || !this.input) {\n      console.error(\"Main Chatbot form or input not found\");\n      return;\n    }\n\n    this.setupEventListeners();\n    this.setupUIEventListeners();\n  }\n\n  setupEventListeners() {\n    this.form.addEventListener(\"submit\", (e) => {\n      e.preventDefault();\n      const message = this.input.value.trim();\n      if (message) {\n        eventBus.emit(\"userMessage\", message);\n        this.input.value = \"\";\n        this.saveToHistory(\"user\", message);\n      }\n    });\n  }\n\n  setupUIEventListeners() {\n    // Set up event delegation for button clicks\n    this.container\n      .querySelector(\".chatbot-container\")\n      .addEventListener(\"click\", (e) => {\n        const button = e.target.closest(\"button.button\");\n        if (button) {\n          const payload = JSON.parse(button.getAttribute(\"data-button-data\"));\n          eventBus.emit(\"buttonClicked\", payload);\n          this.removeInteractiveElements();\n        }\n      });\n  }\n\n  onUserMessage(callback) {\n    eventBus.on(\"userMessage\", callback);\n  }\n\n  onButtonClick(callback) {\n    eventBus.on(\"buttonClicked\", callback);\n  }\n\n  /**\n   * Adds a message to the chatbot UI.\n   * @param {string} sender - 'user' or 'assistant'.\n   * @param {string} content - The message content.\n   * @param {Object} [metadata] - Additional metadata about the message.\n   */\n  addMessage(sender, content, metadata = null) {\n    if (!this.messageContainer) {\n      console.error(\"Message container not set\");\n      return;\n    }\n\n    const message = document.createElement(\"message-component\");\n    message.setAttribute(\"sender\", sender);\n    message.setAttribute(\"content\", content);\n    this.messageContainer.appendChild(message);\n    console.log(\"Message appended to messageContainer\"); // Debug log\n    this.scrollToBottom();\n    this.saveToHistory(sender, content, metadata);\n\n    // If metadata includes interactive elements, add them\n    if (sender === \"assistant\" && metadata) {\n      switch (metadata.type) {\n        case \"choice\":\n          this.addButtons(metadata.buttons);\n          break;\n        case \"carousel\":\n          this.addCarousel(metadata.carouselItems);\n          break;\n        // Add more cases as needed\n        default:\n          break;\n      }\n    }\n  }\n\n  /**\n   * Adds interactive buttons to the chatbot UI.\n   * @param {Array} buttons - Array of button data.\n   */\n  addButtons(buttons) {\n    console.log(\"addButtons called with:\", buttons); // Debug log\n\n    if (!Array.isArray(buttons)) {\n      console.error(\"addButtons expected an array but received:\", buttons);\n      return;\n    }\n\n    buttons.forEach((buttonData) => {\n      const button = document.createElement(\"button-component\");\n      button.setAttribute(\"label\", buttonData.name);\n      button.setAttribute(\"payload\", JSON.stringify(buttonData.request));\n      this.messageContainer.appendChild(button);\n      console.log(\"Button appended to messageContainer\"); // Debug log\n    });\n    this.scrollToBottom();\n  }\n\n  /**\n   * Adds a carousel to the chatbot UI.\n   * @param {Object} carouselData - Data for the carousel.\n   */\n  addCarousel(carouselData) {\n    console.log(\"Adding carousel:\", carouselData);\n    const carousel = document.createElement(\"carousel-component\");\n    carousel.setAttribute(\"data-carousel\", JSON.stringify(carouselData));\n    this.messageContainer.appendChild(carousel);\n    this.scrollToBottom();\n  }\n\n  showTypingIndicator() {\n    const typing = this.container.querySelector(\".chat-typing\");\n    if (typing) {\n      typing.style.display = \"flex\";\n      this.scrollToBottom();\n    }\n  }\n\n  hideTypingIndicator() {\n    const typing = this.container.querySelector(\".chat-typing\");\n    if (typing) {\n      typing.style.display = \"none\";\n    }\n  }\n\n  displayError(message) {\n    const errorDiv = document.createElement(\"div\");\n    errorDiv.classList.add(\"error-message\");\n    errorDiv.innerText = message;\n    this.messageContainer.appendChild(errorDiv);\n    this.scrollToBottom();\n  }\n\n  scrollToBottom() {\n    this.messageContainer.scrollTop = this.messageContainer.scrollHeight;\n  }\n\n  /**\n   * Saves a message to conversation history in localStorage.\n   * @param {string} sender - 'user' or 'assistant'.\n   * @param {string} message - The message content.\n   * @param {Object} [metadata] - Additional metadata about the entry.\n   */\n  saveToHistory(sender, message, metadata = null) {\n    const history =\n      JSON.parse(localStorage.getItem(\"mainChatbotHistory\")) || [];\n    history.push({ sender, message, metadata });\n    localStorage.setItem(\"mainChatbotHistory\", JSON.stringify(history));\n  }\n\n  /**\n   * Removes interactive elements (buttons, carousels) from the UI.\n   */\n  removeInteractiveElements() {\n    const interactiveElements = this.messageContainer.querySelectorAll(\n      \"button-component, carousel-component\"\n    );\n    interactiveElements.forEach((element) => element.remove());\n  }\n}\n\nexport default MainChatbotUI;\n","// /assets/scripts/chatbot/components/button-component.js\n\nimport eventBus from \"../../utils/event-bus.js\";\n\nexport class ButtonComponent extends HTMLElement {\n  constructor() {\n    super();\n    // Attach Shadow DOM to encapsulate styles\n    this.attachShadow({ mode: \"open\" });\n  }\n\n  connectedCallback() {\n    const label = this.getAttribute(\"label\");\n    const payload = this.getAttribute(\"payload\");\n\n    this.render(label, payload);\n  }\n\n  /**\n   * Renders the button with embedded styles.\n   * @param {string} label - The button label\n   * @param {string} payload - The button payload in JSON string format\n   */\n  render(label, payload) {\n    this.shadowRoot.innerHTML = `\n      <style>\n        .button-container {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 10px;\n          margin-bottom: var(--spacing-4);\n        }\n\n        .button {\n          padding: var(--spacing-3);\n          background-color: #FFFFFF;\n          border: none;\n          border-radius: var(--rounded);\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 14px;\n          transition: background-color 0.3s ease;\n        }\n\n        .button:hover {\n          background-color: #f0f0f0;\n        }\n\n        /* Additional styles as needed */\n      </style>\n      <div class=\"button-container\">\n        <button class=\"button\" data-button-data='${payload}' aria-label=\"${label}\">${label}</button>\n      </div>\n    `;\n\n    // Add event listener to the button\n    this.shadowRoot.querySelector(\".button\").addEventListener(\"click\", () => {\n      // Emit event via eventBus\n      try {\n        const parsedPayload = JSON.parse(payload);\n        eventBus.emit(\"buttonClicked\", parsedPayload);\n      } catch (error) {\n        console.error(\"Error parsing button payload:\", error);\n      }\n    });\n  }\n}\n","// /assets/scripts/chatbot/components/message-component.js\n\nexport class MessageComponent extends HTMLElement {\n  constructor() {\n    super();\n    // Attach Shadow DOM to encapsulate styles\n    this.attachShadow({ mode: \"open\" });\n  }\n\n  connectedCallback() {\n    const sender = this.getAttribute(\"sender\");\n    const content = this.getAttribute(\"content\");\n\n    this.render(sender, content);\n  }\n\n  /**\n   * Renders the message with appropriate styling based on the sender.\n   * @param {string} sender - 'user' or 'assistant'\n   * @param {string} content - The message content\n   */\n  render(sender, content) {\n    const isAssistant = sender === \"assistant\";\n    this.shadowRoot.innerHTML = `\n      <style>\n        .message-wrapper {\n          display: flex;\n          align-items: flex-end;\n          width: 100%;\n          margin-bottom: var(--spacing-6);\n          gap: var(--spacing-2);\n        }\n\n        .message-wrapper--assistant {\n          justify-content: flex-start;\n        }\n\n        .message-wrapper--user {\n          justify-content: flex-end;\n        }\n\n        .assistant-icon {\n          width: 30px;\n          height: 20px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          margin-right: var(--spacing-2);\n        }\n\n        .message {\n          max-width: 80%;\n          padding: var(--spacing-4);\n          border-radius: 20px;\n          word-wrap: break-word;\n          background-color: ${\n            isAssistant ? \"#FFFFFF\" : \"rgba(255, 255, 255, 0.1)\"\n          };\n          color: ${isAssistant ? \"#231F25\" : \"#FFFFFF\"};\n          border: ${isAssistant ? \"none\" : \"1px solid #FFFFFF\"};\n        }\n\n        .message--assistant {\n          background-color: #FFFFFF;\n          color: #231F25 !important;\n          border-bottom-left-radius: 4px;\n        }\n\n        .message--user {\n          background-color: rgba(255, 255, 255, 0.1);\n          border: 1px solid #FFFFFF;\n          color: white;\n        }\n\n        .message__content {\n          display: flex;\n          flex-direction: column;\n          gap: 1em;\n          flex-grow: 1;\n          font-family: inherit;\n        }\n      </style>\n      <div class=\"message-wrapper message-wrapper--${sender}\">\n        ${isAssistant ? `<div class=\"assistant-icon\">🚀</div>` : \"\"}\n        <div class=\"message message--${sender}\">\n          <div class=\"message__content\">${this.markdownToHtml(content)}</div>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Converts markdown to HTML.\n   * For simplicity, using basic line breaks. Integrate a markdown library if needed.\n   * @param {string} markdown - The markdown content\n   * @returns {string} - HTML content\n   */\n  markdownToHtml(markdown) {\n    if (!markdown) return \"\";\n    return markdown.replace(/\\n/g, \"<br>\");\n  }\n}\n","// /assets/scripts/chatbot/components/carousel-component.js\n\nimport eventBus from \"../../utils/event-bus.js\";\n\nexport class CarouselComponent extends HTMLElement {\n  constructor() {\n    super();\n    // Attach Shadow DOM to encapsulate styles\n    this.attachShadow({ mode: \"open\" });\n    this.currentIndex = 0;\n    this.isDesktop = window.matchMedia(\"(min-width: 1000px)\").matches;\n    this.itemsPerSlide = this.isDesktop ? 2 : 1;\n\n    // Bind methods\n    this.moveLeft = this.moveLeft.bind(this);\n    this.moveRight = this.moveRight.bind(this);\n    this.handleResize = this.handleResize.bind(this);\n    this.handleButtonClick = this.handleButtonClick.bind(this);\n  }\n\n  connectedCallback() {\n    const carouselData = JSON.parse(this.getAttribute(\"data-carousel\"));\n    this.renderCarousel(carouselData);\n  }\n\n  /**\n   * Renders the carousel with embedded styles and initializes functionality.\n   * @param {Object} carouselData - Data for the carousel\n   */\n  renderCarousel(carouselData) {\n    this.carouselData = carouselData;\n    this.shadowRoot.innerHTML = `\n      <style>\n        .carousel {\n          position: relative;\n          overflow: hidden;\n          width: 100%;\n          margin-bottom: var(--spacing-6);\n        }\n\n        .carousel__container {\n          display: flex;\n          transition: transform 0.3s ease-in-out;\n        }\n\n        .carousel__item {\n          min-width: 100%;\n          box-sizing: border-box;\n          padding: var(--spacing-2);\n        }\n\n        .carousel__item-image {\n          max-width: 100%;\n          height: auto;\n          border-radius: 8px;\n        }\n\n        .carousel__item-title {\n          margin: var(--spacing-2) 0 0 0;\n          font-size: 16px;\n          color: #231F25;\n        }\n\n        .carousel__item-description {\n          margin: var(--spacing-1) 0 0 0;\n          font-size: 14px;\n          color: #231F25;\n        }\n\n        .carousel__item-button {\n          margin-top: var(--spacing-2);\n          padding: var(--spacing-3);\n          background-color: #007BFF;\n          border: none;\n          border-radius: var(--rounded);\n          color: white;\n          cursor: pointer;\n          font-size: 14px;\n          transition: background-color 0.3s ease;\n        }\n\n        .carousel__item-button:hover {\n          background-color: #0056b3;\n        }\n\n        .carousel__button {\n          position: absolute;\n          top: 50%;\n          transform: translateY(-50%);\n          background-color: rgba(0, 0, 0, 0.5);\n          border: none;\n          color: white;\n          padding: 10px;\n          cursor: pointer;\n          border-radius: 50%;\n          font-size: 18px;\n          transition: background-color 0.3s ease;\n        }\n\n        .carousel__button:hover {\n          background-color: rgba(0, 0, 0, 0.7);\n        }\n\n        .carousel__button:disabled {\n          background-color: rgba(0, 0, 0, 0.2);\n          cursor: not-allowed;\n        }\n\n        /* Responsive adjustments */\n        @media (min-width: 1000px) {\n          .carousel__item {\n            min-width: 50%;\n          }\n        }\n      </style>\n      <div class=\"carousel\">\n        <div class=\"carousel__container\">\n          <!-- Carousel items will be dynamically added here -->\n        </div>\n        <button class=\"carousel__button carousel__button--left\" aria-label=\"Previous slide\">&#9664;</button>\n        <button class=\"carousel__button carousel__button--right\" aria-label=\"Next slide\">&#9654;</button>\n      </div>\n    `;\n\n    this.carouselContainer = this.shadowRoot.querySelector(\n      \".carousel__container\"\n    );\n    this.leftButton = this.shadowRoot.querySelector(\".carousel__button--left\");\n    this.rightButton = this.shadowRoot.querySelector(\n      \".carousel__button--right\"\n    );\n\n    // Add carousel items\n    this.carouselData.cards.forEach((card, index) => {\n      const item = document.createElement(\"div\");\n      item.classList.add(\"carousel__item\");\n      item.innerHTML = `\n        <img src=\"${card.imageUrl}\" alt=\"${card.title}\" class=\"carousel__item-image\">\n        <h6 class=\"carousel__item-title\">${card.title}</h6>\n        <p class=\"carousel__item-description\">${card.description.text}</p>\n        <button class=\"carousel__item-button\" data-button-index=\"${index}\">${card.buttons[0].name}</button>\n      `;\n      this.carouselContainer.appendChild(item);\n      this.items.push(item);\n    });\n\n    // Initialize Carousel Functionality\n    this.initCarousel();\n\n    // Add event listeners to carousel buttons\n    this.leftButton.addEventListener(\"click\", this.moveLeft);\n    this.rightButton.addEventListener(\"click\", this.moveRight);\n    window.addEventListener(\"resize\", this.handleResize);\n\n    // Add event listeners to carousel item buttons\n    this.shadowRoot\n      .querySelectorAll(\".carousel__item-button\")\n      .forEach((button) => {\n        button.addEventListener(\"click\", this.handleButtonClick);\n      });\n\n    this.updateVisibility();\n    this.updatePosition();\n  }\n\n  /**\n   * Initializes carousel settings based on screen size.\n   */\n  initCarousel() {\n    this.isDesktop = window.matchMedia(\"(min-width: 1000px)\").matches;\n    this.itemsPerSlide = this.isDesktop ? 2 : 1;\n    this.currentIndex = 0;\n    this.updateVisibility();\n    this.updatePosition();\n  }\n\n  /**\n   * Handles window resize events to adjust carousel settings.\n   */\n  handleResize(e) {\n    const newIsDesktop = e.matches;\n    if (newIsDesktop !== this.isDesktop) {\n      this.isDesktop = newIsDesktop;\n      this.itemsPerSlide = this.isDesktop ? 2 : 1;\n      this.currentIndex = 0;\n      this.updatePosition();\n      this.updateVisibility();\n    }\n  }\n\n  /**\n   * Moves the carousel to the left.\n   */\n  moveLeft() {\n    const itemsPerSlide = this.itemsPerSlide;\n    this.currentIndex = Math.max(0, this.currentIndex - itemsPerSlide);\n    this.updatePosition();\n    this.updateVisibility();\n  }\n\n  /**\n   * Moves the carousel to the right.\n   */\n  moveRight() {\n    const itemsPerSlide = this.itemsPerSlide;\n    this.currentIndex = Math.min(\n      this.items.length - itemsPerSlide,\n      this.currentIndex + itemsPerSlide\n    );\n    this.updatePosition();\n    this.updateVisibility();\n  }\n\n  /**\n   * Updates the carousel's position based on the current index.\n   */\n  updatePosition() {\n    const itemsPerSlide = this.itemsPerSlide;\n    const offset = -(this.currentIndex / itemsPerSlide) * 100;\n    this.carouselContainer.style.transform = `translateX(${offset}%)`;\n  }\n\n  /**\n   * Updates the visibility of navigation buttons based on the current index.\n   */\n  updateVisibility() {\n    const itemsPerSlide = this.itemsPerSlide;\n    this.leftButton.disabled = this.currentIndex === 0;\n    this.rightButton.disabled =\n      this.currentIndex >= this.items.length - itemsPerSlide;\n  }\n\n  /**\n   * Handles button clicks within carousel items.\n   * @param {Event} e - The click event\n   */\n  handleButtonClick(e) {\n    const button = e.target;\n    const buttonIndex = parseInt(button.getAttribute(\"data-button-index\"), 10);\n    const card = this.carouselData.cards[buttonIndex];\n\n    // Emit event with button payload\n    const payload = card.buttons[0].request;\n    eventBus.emit(\"carouselButtonClicked\", payload);\n\n    // Remove the carousel from the UI\n    this.remove();\n  }\n}\n","// frontend/components/ui/chatbot-components.js\nimport { ButtonComponent } from \"./button-component.js\";\nimport { MessageComponent } from \"./message-component.js\";\nimport { CarouselComponent } from \"./carousel-component.js\";\n\n// Register custom components\ncustomElements.define(\"button-component\", ButtonComponent);\ncustomElements.define(\"message-component\", MessageComponent);\ncustomElements.define(\"carousel-component\", CarouselComponent);\n","// /assets/scripts/chatbot/section/section-chatbot-ui.js\n\nimport eventBus from \"../utils/event-bus.js\";\nimport { EVENTS } from \"../utils/event-constants.js\";\n\n/**\n * SectionChatbotUI Class\n * Handles UI-specific functionalities for the Section Chatbot.\n */\nclass SectionChatbotUI {\n  /**\n   * Constructor initializes UI elements, extracts product details, and sets up event listeners.\n   * @param {HTMLElement} container - The section chatbot UI container.\n   */\n  constructor(container) {\n    this.container = container;\n    this.form = this.container.querySelector(\".chat-form\");\n    this.input = this.container.querySelector(\"input[type='text']\");\n    this.messageContainer = this.container.querySelector(\".message-container\");\n\n    if (!this.container) {\n      console.error(\"Section Chatbot UI container not found\");\n      return;\n    }\n\n    if (!this.form || !this.input) {\n      console.error(\"Section Chatbot form or input not found\");\n      return;\n    }\n\n    // Extract product details from container's data attributes\n    this.productTitle = this.container.dataset.productTitle;\n    this.productCapacity = this.container.dataset.productCapacity;\n    this.acOutputContinuousPower =\n      this.container.dataset.productAcOutputContinuousPower;\n    this.acOutputPeakPower = this.container.dataset.productAcOutputPeakPower;\n    this.dcOutputPower = this.container.dataset.productDcOutputPower;\n\n    this.startBlock = \"shopifySection\";\n    this.productDetails = {\n      title: this.productTitle,\n      capacity: this.productCapacity,\n      ac_output_continuous_power: this.acOutputContinuousPower,\n      ac_output_peak_power: this.acOutputPeakPower,\n      dc_output_power: this.dcOutputPower,\n    };\n\n    this.setupEventListeners();\n  }\n\n  /**\n   * Sets up event listeners for user interactions within the UI.\n   */\n  setupEventListeners() {\n    this.form.addEventListener(\"submit\", (e) => {\n      e.preventDefault();\n      const message = this.input.value.trim();\n      if (message) {\n        this.emit(\"userMessage\", message);\n        this.input.value = \"\";\n      }\n    });\n  }\n\n  /**\n   * Registers a callback for user message submissions.\n   * @param {Function} callback - Function to handle user messages.\n   */\n  onUserMessage(callback) {\n    eventBus.on(\"userMessage\", callback);\n  }\n\n  /**\n   * Registers a callback for button click interactions.\n   * @param {Function} callback - Function to handle button clicks.\n   */\n  onButtonClick(callback) {\n    eventBus.on(\"buttonClicked\", callback);\n  }\n\n  /**\n   * Emits custom events from the UI components.\n   * @param {string} eventName - Name of the event.\n   * @param {any} data - Data to pass with the event.\n   */\n  emit(eventName, data) {\n    const event = new CustomEvent(eventName, { detail: data });\n    this.container.dispatchEvent(event);\n  }\n\n  /**\n   * Adds a message to the chatbot UI.\n   * @param {string} sender - 'user' or 'assistant'.\n   * @param {string} content - The message content.\n   */\n  addMessage(sender, content) {\n    const message = document.createElement(\"message-component\");\n    message.setAttribute(\"sender\", sender);\n    message.setAttribute(\"content\", content);\n    this.messageContainer.appendChild(message);\n    this.scrollToBottom();\n  }\n\n  /**\n   * Adds interactive buttons to the chatbot UI.\n   * @param {Array} buttons - Array of button data.\n   */\n  addButtons(buttons) {\n    buttons.forEach((buttonData) => {\n      const button = document.createElement(\"button-component\");\n      button.setAttribute(\"label\", buttonData.name);\n      button.setAttribute(\"payload\", JSON.stringify(buttonData.request));\n      this.messageContainer.appendChild(button);\n    });\n    this.scrollToBottom();\n\n    // Set up event delegation for button clicks\n    this.messageContainer.addEventListener(\"click\", (e) => {\n      if (e.target.closest(\"button-component\")) {\n        const button = e.target.closest(\"button-component\");\n        const payload = JSON.parse(button.getAttribute(\"payload\"));\n        this.emit(\"buttonClicked\", payload);\n        this.removeInteractiveElements();\n      }\n    });\n  }\n\n  /**\n   * Adds a carousel to the chatbot UI.\n   * @param {Array} items - Array of carousel items.\n   */\n  addCarousel(items) {\n    const carousel = document.createElement(\"carousel-component\");\n    carousel.setAttribute(\"items\", JSON.stringify(items));\n    this.messageContainer.appendChild(carousel);\n    this.scrollToBottom();\n\n    // Set up event delegation for carousel interactions if necessary\n    // Implement similar to buttons if carousel items have interactive elements\n  }\n\n  /**\n   * Populates the applications grid with device information.\n   * @param {Array} devices - Array of device data.\n   */\n  populateApplicationsGrid(devices) {\n    const grid = document.querySelector(\".applications-grid\");\n    if (!grid) {\n      console.error(\"Applications grid not found\");\n      return;\n    }\n    devices.forEach((device) => {\n      const card = document.createElement(\"div\");\n      card.classList.add(\"application-card\", \"chatbot-card\");\n      card.innerHTML = `\n        <div class=\"application-card__image\">\n          <img src=\"${device.imageUrl}\" alt=\"${device.name}\" />\n        </div>\n        <div class=\"application-card__content\">\n          <div class=\"application-card__title\">${device.name}</div>\n          <div class=\"application-card__runtime\">${device.estimatedRuntime}</div>\n        </div>\n      `;\n      grid.appendChild(card);\n    });\n    this.scrollToBottom();\n  }\n\n  /**\n   * Displays an error message in the chatbot UI.\n   * @param {string} message - The error message.\n   */\n  displayError(message) {\n    const errorDiv = document.createElement(\"div\");\n    errorDiv.classList.add(\"error-message\");\n    errorDiv.innerText = message;\n    this.messageContainer.appendChild(errorDiv);\n    this.scrollToBottom();\n  }\n\n  /**\n   * Scrolls the chatbot container to the bottom.\n   */\n  scrollToBottom() {\n    this.container.scrollTop = this.container.scrollHeight;\n  }\n\n  /**\n   * Retrieves the value of a specified attribute from the chatbot container.\n   * @param {string} attrName - The name of the attribute.\n   * @returns {string|null} - The value of the attribute or null if not found.\n   */\n  getAttribute(attrName) {\n    return this.container.getAttribute(attrName);\n  }\n\n  /**\n   * Removes interactive elements (buttons, carousels) from the UI.\n   */\n  removeInteractiveElements() {\n    const interactiveElements = this.messageContainer.querySelectorAll(\n      \"button-component, carousel-component\"\n    );\n    interactiveElements.forEach((element) => element.remove());\n  }\n}\n\nexport default SectionChatbotUI;\n"],"names":["EventBus","EventEmitter","eventBus","EVENTS","ChatbotCore","userID","endpoint","chatbotType","variables","payload","message","actionPayload","signal","response","reader","decoder","buffer","done","value","events","eventStr","lines","eventTypeLine","line","dataLine","eventType","data","error","trace","MainChatbotUI","container","e","button","callback","sender","content","metadata","buttons","buttonData","carouselData","carousel","typing","errorDiv","history","element","ButtonComponent","label","parsedPayload","MessageComponent","isAssistant","markdown","CarouselComponent","card","index","item","newIsDesktop","itemsPerSlide","offset","buttonIndex","SectionChatbotUI","eventName","event","items","devices","grid","device","attrName"],"mappings":"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"}