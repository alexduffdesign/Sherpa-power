import{C as r}from"./base-chatbot.CJd4Fmlp.js";import{M as n}from"./chatbot-main-ui.CiouZ2AI.js";import"./vendor.DqvJXvYX.js";import"./base-chatbot-ui.DxQT9tG6.js";function c(i){const t=Date.now().toString(36)+Math.random().toString(36).substr(2,9);return`${i}-${t}`}class h{constructor(t){this.container=t,this.historyKey="mainChatbotHistory",this.launchKey="chatHasLaunched",this.isLaunched=this.hasLaunched(),this.initialize()}initialize(){let t=localStorage.getItem("mainChatbotUserId");t||(t=c("mainChatbot"),localStorage.setItem("mainChatbotUserId",t)),this.core=new r({type:"main",endpoint:"https://chatbottings--development.gadget.app/voiceflowAPI/voiceflow-streaming",userID:t}),this.ui=new n({container:this.container,eventBus:this.core.eventBus,type:"main"}),this.setupEventListeners(),this.loadHistory()}setupEventListeners(){this.core.eventBus.on("userMessage",t=>{this.saveToHistory("user",t)}),this.core.eventBus.on("messageReceived",({content:t,metadata:e})=>{this.saveToHistory("assistant",t,e)}),this.core.eventBus.on("buttonClicked",t=>{this.saveToHistory("user",t.label||"Button clicked")}),this.core.eventBus.on("mainMenu",()=>{this.core.sendAction({action:{type:"event",payload:{event:{name:"main_menu"}}}})})}hasLaunched(){return localStorage.getItem(this.launchKey)==="true"}setLaunched(){localStorage.setItem(this.launchKey,"true"),this.isLaunched=!0}async launch(){if(this.isLaunched){console.log("Chat already launched, skipping launch request");return}try{await this.core.sendLaunch(),this.setLaunched()}catch(t){console.error("Error launching chatbot:",t),this.ui.displayError("Failed to launch the chatbot. Please try again later.")}}saveToHistory(t,e,s=null){const o=JSON.parse(localStorage.getItem(this.historyKey))||[],a={sender:t,message:e,timestamp:Date.now(),isInteractive:!1};t==="assistant"&&s&&(s.type==="choice"?(a.isInteractive=!0,a.traceType="choice",a.traceData={buttons:s.buttons}):s.type==="carousel"&&(a.isInteractive=!0,a.traceType="carousel",a.traceData={cards:s.carouselItems})),o.push(a),localStorage.setItem(this.historyKey,JSON.stringify(o))}loadHistory(){const t=JSON.parse(localStorage.getItem(this.historyKey))||[];t.forEach((e,s)=>{if(e.isInteractive){s===t.length-1&&this.restoreInteractiveElement(e);return}e.message&&this.ui.addMessage(e.sender,e.message)})}restoreInteractiveElement(t){t.traceType==="choice"?this.ui.addButtons(t.traceData.buttons,!0):t.traceType==="carousel"&&this.ui.addCarousel(t.traceData.cards,!0)}clearHistory(){localStorage.removeItem(this.historyKey),localStorage.removeItem(this.launchKey),this.isLaunched=!1,this.ui.clearChat()}destroy(){this.core.destroy(),this.ui.destroy()}}window.MainChatbot=h;
//# sourceMappingURL=chatbot-main.Bue8OiDx.js.map
