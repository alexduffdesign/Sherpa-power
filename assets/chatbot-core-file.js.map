{"version":3,"file":"chatbot-core-file.js","sources":["../frontend/entrypoints/chatbot-core-file.js"],"sourcesContent":["// // chatbot-core.js\n// console.log(\"Recent changes check : 3\");\n\n// export class ChatbotCore {\n//   constructor(config) {\n//     console.log(\"ChatbotCore constructor called with config:\", config);\n//     this.apiEndpoint = config.apiEndpoint;\n//     this.userIDPrefix = config.userIDPrefix || \"chatbot\";\n//     this.userID = this.loadUserID();\n//     this.messageContainer = null;\n//     this.typingIndicator = null;\n//     this.drawerBody = null;\n\n//     // Bind methods\n//     this.sendMessage = this.sendMessage.bind(this);\n//     this.gadgetInteract = this.gadgetInteract.bind(this);\n//     this.addMessage = this.addMessage.bind(this);\n\n//     console.log(\"ChatbotCore instance created:\", this);\n//   }\n\n//   loadUserID() {\n//     const key = `${this.userIDPrefix}UserID`;\n//     let userID = localStorage.getItem(key);\n//     if (!userID) {\n//       userID = `${this.userIDPrefix}_${Math.floor(\n//         Math.random() * 1000000000000000\n//       )}`;\n//       localStorage.setItem(key, userID);\n//     }\n//     console.log(`${this.userIDPrefix} userID loaded:`, userID);\n//     return userID;\n//   }\n\n//   setDOMElements(messageContainer, typingIndicator, drawerBody) {\n//     console.log(\"setDOMElements called:\", {\n//       messageContainer,\n//       typingIndicator,\n//       drawerBody,\n//     });\n//     this.messageContainer = messageContainer;\n//     this.typingIndicator = typingIndicator;\n//     this.drawerBody = drawerBody;\n//     console.log(\"DOM elements set:\", this);\n//   }\n\n//   scrollToBottom() {\n//     if (this.drawerBody) {\n//       setTimeout(() => {\n//         this.drawerBody.scrollTop = this.drawerBody.scrollHeight;\n//       }, 100); // Small delay to ensure content has rendered\n//     } else {\n//       console.error(\"Drawer body element not found for scrolling\");\n//     }\n//   }\n\n//   async sendMessage(message) {\n//     console.log(\"sendMessage called with:\", message);\n//     console.log(\"this in sendMessage:\", this);\n//     try {\n//       const res = await this.gadgetInteract({\n//         userAction: {\n//           type: \"text\",\n//           payload: message,\n//         },\n//       });\n//       console.log(\"gadgetInteract response:\", res);\n//       this.hideTypingIndicator();\n//       return res;\n//     } catch (error) {\n//       console.error(\"Error sending message:\", error);\n//       this.hideTypingIndicator();\n//       throw error;\n//     }\n//   }\n\n//   async sendLaunch(payload = {}) {\n//     console.log(\"ChatbotCore sendLaunch called with payload:\", payload);\n//     this.showTypingIndicator();\n\n//     try {\n//       const res = await this.gadgetInteract(payload);\n//       console.log(\"Launch response:\", res);\n//       return res;\n//     } catch (error) {\n//       console.error(\"Error launching conversation:\", error);\n//       throw error;\n//     } finally {\n//       this.hideTypingIndicator();\n//     }\n//   }\n\n//   async gadgetInteract(payload) {\n//     console.log(\"Sending payload to Gadget:\", payload);\n//     const fullPayload = {\n//       userID: this.userID,\n//       userAction: payload.userAction || payload,\n//     };\n//     const response = await fetch(this.apiEndpoint, {\n//       method: \"POST\",\n//       headers: {\n//         \"Content-Type\": \"application/json\",\n//       },\n//       body: JSON.stringify(fullPayload),\n//     });\n//     if (!response.ok) {\n//       throw new Error(`Gadget API error: ${response.status}`);\n//     }\n//     return await response.json();\n//   }\n\n//   showTypingIndicator() {\n//     console.log(\"Showing typing indicator\");\n//     if (this.typingIndicator) {\n//       this.typingIndicator.style.display = \"flex\";\n//       this.typingIndicator.classList.add(\"active\");\n//       this.scrollToBottom();\n//     }\n//   }\n\n//   hideTypingIndicator() {\n//     console.log(\"Hiding typing indicator\");\n//     if (this.typingIndicator) {\n//       this.typingIndicator.style.display = \"none\";\n//       this.typingIndicator.classList.remove(\"active\");\n//     }\n//   }\n\n//   addMessage(sender, content) {\n//     console.log(`Adding message from ${sender}: ${content}`);\n//     if (this.messageContainer) {\n//       const messageWrapper = document.createElement(\"div\");\n//       messageWrapper.classList.add(\n//         \"message-wrapper\",\n//         `message-wrapper--${sender}`\n//       );\n\n//       if (sender === \"assistant\") {\n//         const iconSvg = document.createElement(\"svg\");\n//         iconSvg.classList.add(\"message-icon\");\n//         iconSvg.innerHTML = `\n//         <svg class=\"message-icon\" width=\"30\" height=\"20\" viewBox=\"0 0 30 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n//             <path d=\"M20.8566 0.0949741C20.5706 0.0327174 20.1796 -0.00878708 19.9985 0.00158904C19.8173 0.0119652 19.4741 0.0534703 19.2357 0.105351C18.9973 0.157232 18.5492 0.333624 18.2345 0.499642C17.8817 0.676036 15.6315 2.51261 12.4183 5.23115C10.1121 7.17766 8.14608 8.8729 7.4516 9.50931C7.26478 9.68051 7.23297 9.89295 7.36802 10.1074C7.56866 10.4259 7.91296 10.9361 8.2993 11.488C9.04301 12.5394 9.45301 13.0409 9.52929 12.9925C9.59603 12.951 11.9702 10.9588 14.802 8.57226C17.6338 6.18575 20.0461 4.18316 20.1606 4.13128C20.2845 4.0794 20.561 4.0379 20.7803 4.0379C21.0091 4.0379 21.3047 4.12091 21.4478 4.22467C21.5908 4.31805 22.7826 5.9056 24.0889 7.75255C26.0721 10.523 26.4821 11.1559 26.4821 11.4361C26.4916 11.6125 26.4154 11.8719 26.32 11.986C26.2247 12.1105 25.2044 13.0029 24.0507 13.9782C22.897 14.9432 21.8387 15.794 21.6861 15.8563C21.5145 15.9289 21.3429 15.9393 21.1617 15.8667C21.0091 15.8148 20.6754 15.4516 20.3512 14.9847C20.2856 14.8902 20.2209 14.7993 20.1594 14.715C19.8981 14.3568 19.5448 14.3315 19.2009 14.6114C19.0718 14.7164 18.9276 14.8362 18.778 14.964C18.2822 15.379 17.7959 15.7837 17.6815 15.8874C17.5638 15.9806 17.5395 16.1501 17.626 16.2729C18.6307 17.6989 19.1539 18.3732 19.4264 18.6994C19.722 19.0418 20.1606 19.4153 20.4275 19.5606C20.685 19.6955 21.1617 19.8615 21.4764 19.9134C21.8673 19.986 22.2296 19.9756 22.6205 19.903C22.9352 19.8407 23.4024 19.6747 23.6693 19.5294C23.9268 19.3842 25.2617 18.3154 26.6251 17.1637C28.4653 15.5969 29.1804 14.9224 29.3997 14.5489C29.5714 14.2791 29.7811 13.7707 29.867 13.4283C29.9814 12.9925 30.0195 12.5878 29.9909 12.0794C29.9623 11.6125 29.8669 11.1455 29.7144 10.7824C29.5714 10.44 28.2174 8.44775 26.3295 5.81222C24.6038 3.3842 23.021 1.2571 22.8112 1.07033C22.6015 0.883558 22.1915 0.61378 21.9054 0.468515C21.6194 0.323249 21.1426 0.157231 20.8566 0.0949741Z\" fill=\"white\"/>\n//             <path d=\"M9.51022 0.47889C9.00487 0.219487 8.74743 0.146855 8.12767 0.126103C7.67 0.105351 7.21234 0.157231 6.9835 0.229863C6.77374 0.312872 6.44955 0.458139 6.26839 0.5619C6.08723 0.665661 4.81911 1.6929 3.45563 2.84465C2.09216 3.99639 0.890782 5.07551 0.776364 5.24153C0.661947 5.40755 0.490321 5.72921 0.385438 5.95748C0.271021 6.18576 0.137534 6.65268 0.0707907 6.99509C-0.0150223 7.44127 -0.0245558 7.79405 0.0517223 8.24023C0.0993962 8.58264 0.223347 9.07032 0.32823 9.32972C0.433112 9.58912 1.8824 11.7059 3.54145 14.0509C5.21003 16.3959 6.7642 18.5126 7.0121 18.7616C7.26001 19.0106 7.75582 19.3738 8.12767 19.5709C8.65209 19.8407 8.9572 19.9341 9.55789 19.986C10.006 20.0171 10.54 19.9964 10.8451 19.9237C11.1311 19.8615 11.5983 19.6747 11.8653 19.5191C12.1418 19.3634 14.7257 17.2571 17.6052 14.8291C20.4943 12.401 22.8494 10.357 22.8494 10.2947C22.8589 10.2221 22.3536 9.45423 21.7338 8.60339C21.4117 8.14881 21.1108 7.73759 20.8915 7.45214C20.6737 7.16862 20.3983 7.15354 20.1216 7.38003C19.3039 8.04956 17.3858 9.65415 15.1834 11.5087C11.5411 14.58 9.79626 15.9912 9.57696 16.0327C9.41487 16.0638 9.11929 16.0431 8.93813 15.9808C8.75697 15.9186 8.53767 15.8044 8.45185 15.7318C8.36604 15.6592 7.27908 14.1857 6.03956 12.4426C4.7905 10.6994 3.70354 9.14295 3.62726 8.96655C3.50331 8.71753 3.49377 8.59301 3.57959 8.34399C3.65587 8.11571 4.3233 7.49315 5.98235 6.09237C7.79396 4.54633 8.3279 4.14166 8.55674 4.14166C8.70929 4.14166 8.91906 4.18316 9.00487 4.23504C9.10022 4.28692 9.41487 4.66047 9.70091 5.06514C9.98695 5.48018 10.2825 5.79146 10.3397 5.78109C10.4065 5.76033 10.9118 5.37642 11.4553 4.91987C11.7575 4.67041 12.0283 4.42714 12.2134 4.24762C12.3954 4.0712 12.4181 3.84719 12.2814 3.63385C12.1117 3.3692 11.8416 2.97785 11.5411 2.56449C11.0358 1.85891 10.5114 1.18447 10.3683 1.04958C10.2349 0.914687 9.85347 0.66566 9.51022 0.47889Z\" fill=\"white\"/>\n//           </svg>\n//         `;\n//         messageWrapper.appendChild(iconSvg);\n//       }\n\n//       const messageDiv = document.createElement(\"div\");\n//       messageDiv.classList.add(\"message\", `message--${sender}`);\n//       messageDiv.innerHTML = `<div class=\"message__content\">${this.markdownToHtml(\n//         content\n//       )}</div>`;\n\n//       messageWrapper.appendChild(messageDiv);\n//       this.messageContainer.appendChild(messageWrapper);\n//       this.scrollToBottom();\n//     }\n//   }\n\n//   markdownToHtml(markdown) {\n//     // Handle Headers\n//     // Replace '# Header' with <h6 class=\"h4\">Header</h6>\n//     markdown = markdown.replace(/^# (.*)$/gm, '<h6 class=\"h4\">$1</h6>');\n//     // Replace '## Header' with <h6 class=\"h5\">Header</h6>\n//     markdown = markdown.replace(/^## (.*)$/gm, '<h6 class=\"h5\">$1</h6>');\n//     // Replace '### Header' and beyond with <h6 class=\"h6\">Header</h6>\n//     markdown = markdown.replace(/^### (.*)$/gm, '<h6 class=\"h6\">$1</h6>');\n//     markdown = markdown.replace(/^####+ (.*)$/gm, '<h6 class=\"h6\">$1</h6>');\n\n//     // Handle Bold (**text**)\n//     markdown = markdown.replace(/\\*\\*(.*?)\\*\\*/g, \"<strong>$1</strong>\");\n\n//     // Handle Italic (*text*)\n//     markdown = markdown.replace(/\\*(.*?)\\*/g, \"<em>$1</em>\");\n\n//     // Handle Links [text](url)\n//     markdown = markdown.replace(\n//       /\\[(.*?)\\]\\((.*?)\\)/g,\n//       '<a href=\"$2\" target=\"_blank\">$1</a>'\n//     );\n\n//     // Handle Unordered Lists\n//     markdown = markdown.replace(/^\\s*-\\s+(.*)$/gm, \"<ul><li>$1</li></ul>\");\n\n//     // Handle Ordered Lists\n//     markdown = markdown.replace(/^\\s*\\d+\\.\\s+(.*)$/gm, \"<ol><li>$1</li></ol>\");\n\n//     // Replace multiple consecutive <ul> or <ol> tags with a single tag\n//     markdown = markdown.replace(/<\\/?ul>/g, \"\");\n//     markdown = markdown.replace(/<\\/?ol>/g, \"\");\n//     markdown = markdown.replace(/<li>(.*?)<\\/li>/g, \"<li>$1</li>\");\n//     markdown = markdown.replace(/<\\/li>\\s*<li>/g, \"</li><li>\");\n\n//     // Handle Line Breaks hope\n//     markdown = markdown.replace(/\\n/g, \"<br>\");\n\n//     return markdown;\n//   }\n\n//   addButtons(buttons) {\n//     console.log(\"Adding buttons:\", buttons);\n//     const buttonContainer = document.createElement(\"div\");\n//     buttonContainer.classList.add(\"button-container\");\n\n//     buttons.forEach((button) => {\n//       const buttonElement = document.createElement(\"button\");\n//       buttonElement.classList.add(\"button\");\n//       buttonElement.textContent = button.name;\n//       buttonElement.dataset.buttonData = JSON.stringify(button);\n//       buttonContainer.appendChild(buttonElement);\n//     });\n\n//     if (this.messageContainer) {\n//       this.messageContainer.appendChild(buttonContainer);\n//       this.scrollToBottom();\n//     } else {\n//       console.error(\"Message container not found when adding buttons\");\n//     }\n//   }\n\n//   removeButtons() {\n//     const buttonContainers =\n//       this.messageContainer.querySelectorAll(\".button-container\");\n//     buttonContainers.forEach((container) => container.remove());\n//   }\n\n//   async handleButtonClick(button) {\n//     console.log(\"Button clicked:\", button);\n//     this.removeButtons();\n//     this.addMessage(\"user\", button.name);\n\n//     this.showTypingIndicator();\n//     try {\n//       const response = await this.gadgetInteract({\n//         userID: this.userID,\n//         userAction: button.request,\n//       });\n//       this.hideTypingIndicator();\n//       return response; // Return the response instead of handling it here\n//     } catch (error) {\n//       console.error(\"Error handling button click:\", error);\n//       this.hideTypingIndicator();\n//       throw error;\n//     }\n//   }\n// }\n\n// console.log(\"ChatbotCore module loaded\");\n\n// chatbot-core-file.js test\n\n/**\n * ChatbotCore class responsible for handling core chatbot functionalities,\n * including sending messages, receiving responses, managing the typing indicator,\n * and rendering messages with Markdown support.\n */\nclass ChatbotCore {\n  constructor({ apiEndpoint, userIDPrefix }) {\n    this.apiEndpoint = apiEndpoint;\n    this.userID = `${userIDPrefix}_${this.generateUserID()}`;\n    this.messageContainer = null;\n    this.typingIndicator = null;\n    this.drawerBody = null;\n\n    // Bind methods if necessary\n    this.showTypingIndicator = this.showTypingIndicator.bind(this);\n    this.hideTypingIndicator = this.hideTypingIndicator.bind(this);\n  }\n\n  /**\n   * Generates a unique user ID.\n   */\n  generateUserID() {\n    return Math.random().toString(36).substr(2, 9);\n  }\n\n  /**\n   * Sets the necessary DOM elements for the chatbot.\n   * @param {HTMLElement} messageContainer - The container for chat messages.\n   * @param {HTMLElement} typingIndicator - The typing indicator element.\n   * @param {HTMLElement} drawerBody - The drawer body element.\n   */\n  setDOMElements(messageContainer, typingIndicator, drawerBody) {\n    this.messageContainer = messageContainer;\n    this.typingIndicator = typingIndicator;\n    this.drawerBody = drawerBody;\n    console.log(\"ChatbotCore: DOM elements set.\");\n  }\n\n  /**\n   * Converts Markdown-formatted text to sanitized HTML.\n   * @param {string} markdown - The Markdown text to convert.\n   * @returns {string} - The resulting HTML.\n   */\n  markdownToHtml(markdown) {\n    // Step 1: Replace double line breaks with a unique placeholder\n    markdown = markdown.replace(/\\n{2,}/g, \"[[DOUBLE_BREAK]]\");\n\n    // Step 2: Handle Headers\n    markdown = markdown.replace(/^# (.*)$/gm, '<h6 class=\"h4\">$1</h6>');\n    markdown = markdown.replace(/^## (.*)$/gm, '<h6 class=\"h5\">$1</h6>');\n    markdown = markdown.replace(/^### (.*)$/gm, '<h6 class=\"h6\">$1</h6>');\n    markdown = markdown.replace(/^####+ (.*)$/gm, '<h6 class=\"h6\">$1</h6>');\n\n    // Step 3: Handle Bold and Italic\n    markdown = markdown.replace(/\\*\\*(.*?)\\*\\*/g, \"<strong>$1</strong>\");\n    markdown = markdown.replace(/\\*(.*?)\\*/g, \"<em>$1</em>\");\n\n    // Step 4: Handle Links\n    markdown = markdown.replace(\n      /\\[(.*?)\\]\\((.*?)\\)/g,\n      '<a href=\"$2\" target=\"_blank\">$1</a>'\n    );\n\n    // Step 5: Handle Unordered Lists\n    markdown = markdown.replace(/^\\s*-\\s+(.*)$/gm, \"<ul><li>$1</li></ul>\");\n\n    // Step 6: Handle Ordered Lists\n    markdown = markdown.replace(/^\\s*\\d+\\.\\s+(.*)$/gm, \"<ol><li>$1</li></ol>\");\n\n    // Step 7: Remove redundant <ul> and <ol> tags\n    markdown = markdown.replace(/<\\/?ul>/g, \"\");\n    markdown = markdown.replace(/<\\/?ol>/g, \"\");\n    markdown = markdown.replace(/<li>(.*?)<\\/li>/g, \"<li>$1</li>\");\n    markdown = markdown.replace(/<\\/li>\\s*<li>/g, \"</li><li>\");\n\n    // Step 8: Restore double line breaks\n    markdown = markdown.replace(/\\[\\[DOUBLE_BREAK\\]\\]/g, \"<br>\");\n\n    // Step 9: Replace remaining single line breaks with <br>\n    markdown = markdown.replace(/\\n/g, \"<br>\");\n\n    // Step 10: Collapse multiple <br> tags into a single <br>\n    markdown = markdown.replace(/(<br>){2,}/g, \"<br>\");\n\n    return markdown;\n  }\n\n  /**\n   * Sanitizes HTML to prevent XSS attacks.\n   * Note: For this to work, you need to include a library like DOMPurify.\n   * If not using DOMPurify, ensure that the markdownToHtml function does not introduce XSS vulnerabilities.\n   * @param {string} html - The HTML string to sanitize.\n   * @returns {string} - The sanitized HTML.\n   */\n  sanitizeHtml(html) {\n    // If using DOMPurify, uncomment the following lines and ensure DOMPurify is imported\n    // return DOMPurify.sanitize(html);\n\n    // If not using DOMPurify, return the HTML as is (not recommended)\n    return html;\n  }\n\n  /**\n   * Converts Markdown to sanitized HTML.\n   * @param {string} markdown - The Markdown text to convert.\n   * @returns {string} - The sanitized HTML.\n   */\n  convertMarkdownToHtml(markdown) {\n    const html = this.markdownToHtml(markdown);\n    return this.sanitizeHtml(html);\n  }\n\n  /**\n   * Shows the typing indicator.\n   */\n  showTypingIndicator() {\n    if (this.typingIndicator) {\n      this.typingIndicator.style.display = \"block\";\n      console.log(\"ChatbotCore: Typing indicator shown.\");\n    }\n  }\n\n  /**\n   * Hides the typing indicator.\n   */\n  hideTypingIndicator() {\n    if (this.typingIndicator) {\n      this.typingIndicator.style.display = \"none\";\n      console.log(\"ChatbotCore: Typing indicator hidden.\");\n    }\n  }\n\n  /**\n   * Adds a message to the chat interface.\n   * @param {string} sender - 'user' or 'assistant'.\n   * @param {string} message - The message content in Markdown.\n   */\n  addMessage(sender, message) {\n    if (!this.messageContainer) {\n      console.error(\"ChatbotCore: Message container not set.\");\n      return;\n    }\n\n    const messageWrapper = document.createElement(\"div\");\n    messageWrapper.classList.add(\n      \"message-wrapper\",\n      `message-wrapper--${sender}`\n    );\n\n    if (sender === \"assistant\") {\n      const iconSvg = document.createElement(\"svg\");\n      iconSvg.classList.add(\"message-icon\");\n      iconSvg.setAttribute(\"width\", \"24\");\n      iconSvg.setAttribute(\"height\", \"24\");\n      iconSvg.setAttribute(\"viewBox\", \"0 0 24 24\");\n      iconSvg.setAttribute(\"fill\", \"none\");\n      iconSvg.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n      iconSvg.innerHTML = `\n        <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"#007bff\" stroke-width=\"2\"/>\n        <path d=\"M8 12H16\" stroke=\"#007bff\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n        <path d=\"M12 8V16\" stroke=\"#007bff\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n      `;\n      messageWrapper.appendChild(iconSvg);\n    }\n\n    const messageDiv = document.createElement(\"div\");\n    messageDiv.classList.add(\"message\", `message--${sender}`);\n    const htmlContent = this.convertMarkdownToHtml(message);\n    messageDiv.innerHTML = `<div class=\"message__content\">${htmlContent}</div>`;\n\n    messageWrapper.appendChild(messageDiv);\n    this.messageContainer.appendChild(messageWrapper);\n    this.scrollToBottom();\n  }\n\n  /**\n   * Adds buttons to the chat interface.\n   * @param {Array} buttons - Array of button objects with 'name' and 'request' properties.\n   */\n  addButtons(buttons) {\n    if (!this.messageContainer) {\n      console.error(\"ChatbotCore: Message container not set.\");\n      return;\n    }\n\n    const buttonsWrapper = document.createElement(\"div\");\n    buttonsWrapper.classList.add(\"button-container\");\n\n    buttons.forEach((button) => {\n      const buttonElement = document.createElement(\"button\");\n      buttonElement.textContent = button.name;\n      buttonElement.dataset.buttonData = JSON.stringify(button);\n      buttonsWrapper.appendChild(buttonElement);\n    });\n\n    const messageWrapper = document.createElement(\"div\");\n    messageWrapper.classList.add(\n      \"message-wrapper\",\n      \"message-wrapper--assistant\"\n    );\n    messageWrapper.appendChild(buttonsWrapper);\n    this.messageContainer.appendChild(messageWrapper);\n    this.scrollToBottom();\n  }\n\n  /**\n   * Sends a message to the Voiceflow API.\n   * @param {string} message - The user's message.\n   * @returns {Promise<Array>} - The response traces from Voiceflow.\n   */\n  async sendMessage(message) {\n    this.showTypingIndicator();\n\n    try {\n      const response = await fetch(this.apiEndpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          userID: this.userID,\n          message: message,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! Status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      console.log(\"ChatbotCore: Received response:\", data);\n      return data.traces || [];\n    } catch (error) {\n      console.error(\"ChatbotCore: Error sending message:\", error);\n      this.addMessage(\n        \"assistant\",\n        \"Sorry, something went wrong. Please try again.\"\n      );\n      return [];\n    } finally {\n      this.hideTypingIndicator();\n    }\n  }\n\n  /**\n   * Sends a launch request to the Voiceflow API.\n   * @param {Object} payload - The launch payload.\n   * @returns {Promise<Array>} - The response traces from Voiceflow.\n   */\n  async sendLaunch(payload = {}) {\n    this.showTypingIndicator();\n\n    try {\n      const response = await fetch(this.apiEndpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          userID: this.userID,\n          action: \"launch\",\n          ...payload,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! Status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      console.log(\"ChatbotCore: Received launch response:\", data);\n      return data.traces || [];\n    } catch (error) {\n      console.error(\"ChatbotCore: Error sending launch:\", error);\n      this.addMessage(\n        \"assistant\",\n        \"Sorry, something went wrong during initialization.\"\n      );\n      return [];\n    } finally {\n      this.hideTypingIndicator();\n    }\n  }\n\n  /**\n   * Handles button clicks and sends appropriate requests to Voiceflow.\n   * @param {Object} buttonData - The data associated with the clicked button.\n   * @returns {Promise<Array>} - The response traces from Voiceflow.\n   */\n  async handleButtonClick(buttonData) {\n    this.showTypingIndicator();\n\n    try {\n      const response = await fetch(this.apiEndpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          userID: this.userID,\n          action: buttonData.request.type,\n          payload: buttonData.request.payload,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! Status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      console.log(\"ChatbotCore: Received button click response:\", data);\n      return data.traces || [];\n    } catch (error) {\n      console.error(\"ChatbotCore: Error handling button click:\", error);\n      this.addMessage(\n        \"assistant\",\n        \"Sorry, something went wrong. Please try again.\"\n      );\n      return [];\n    } finally {\n      this.hideTypingIndicator();\n    }\n  }\n\n  /**\n   * Handles generic interactions with Voiceflow.\n   * @param {Object} interactPayload - The interaction payload.\n   * @returns {Promise<Array>} - The response traces from Voiceflow.\n   */\n  async gadgetInteract(interactPayload) {\n    this.showTypingIndicator();\n\n    try {\n      const response = await fetch(this.apiEndpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          userID: this.userID,\n          ...interactPayload,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! Status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      console.log(\"ChatbotCore: Received gadget interaction response:\", data);\n      return data.traces || [];\n    } catch (error) {\n      console.error(\"ChatbotCore: Error in gadgetInteract:\", error);\n      this.addMessage(\n        \"assistant\",\n        \"Sorry, something went wrong. Please try again.\"\n      );\n      return [];\n    } finally {\n      this.hideTypingIndicator();\n    }\n  }\n\n  /**\n   * Scrolls the chat container to the bottom.\n   */\n  scrollToBottom() {\n    if (this.messageContainer) {\n      this.messageContainer.scrollTop = this.messageContainer.scrollHeight;\n      console.log(\"ChatbotCore: Scrolled to bottom.\");\n    }\n  }\n}\n\nexport { ChatbotCore };\n"],"names":["ChatbotCore","apiEndpoint","userIDPrefix","messageContainer","typingIndicator","drawerBody","markdown","html","sender","message","messageWrapper","iconSvg","messageDiv","htmlContent","buttons","buttonsWrapper","button","buttonElement","response","data","error","payload","buttonData","interactPayload"],"mappings":"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"}