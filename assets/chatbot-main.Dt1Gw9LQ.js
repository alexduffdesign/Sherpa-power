import{e as n,g as l,C as d,E as r}from"./user-id-generator.Df9BxPRd.js";import"./chatbot-core-file.DqvJXvYX.js";class u{constructor(t){if(this.container=t,this.form=this.container.querySelector("#main-chatbot-form"),this.input=this.container.querySelector("#main-chatbot-input"),!this.form||!this.input){console.error("Main Chatbot form or input not found");return}this.setupEventListeners()}setupEventListeners(){this.form.addEventListener("submit",t=>{t.preventDefault();const e=this.input.value.trim();e&&(this.emit("userMessage",e),this.input.value="",this.saveToHistory("user",e))})}onUserMessage(t){n.on("userMessage",t)}onButtonClick(t){n.on("buttonClicked",t)}emit(t,e){const o=new CustomEvent(t,{detail:e});this.container.dispatchEvent(o)}addMessage(t,e){const o=document.createElement("message-component");o.setAttribute("sender",t),o.setAttribute("content",e),this.container.querySelector(".chatbot-container").appendChild(o),this.scrollToBottom(),this.saveToHistory(t,e)}addButtons(t){t.forEach(e=>{const o=document.createElement("button-component");o.setAttribute("label",e.name),o.setAttribute("payload",JSON.stringify(e.request)),this.container.querySelector(".chatbot-container").appendChild(o)}),this.scrollToBottom(),this.container.querySelector(".chatbot-container").addEventListener("click",e=>{if(e.target.closest("button-component")){const o=e.target.closest("button-component"),s=JSON.parse(o.getAttribute("payload"));this.emit("buttonClicked",s),this.removeInteractiveElements()}})}addCarousel(t){const e=document.createElement("carousel-component");e.setAttribute("items",JSON.stringify(t)),this.container.querySelector(".chatbot-container").appendChild(e),this.scrollToBottom()}showTypingIndicator(){const t=document.createElement("div");t.classList.add("typing-indicator"),t.innerText="Assistant is typing...",this.container.querySelector(".chatbot-container").appendChild(t),this.scrollToBottom()}hideTypingIndicator(){const t=this.container.querySelector(".typing-indicator");t&&t.remove()}displayError(t){const e=document.createElement("div");e.classList.add("error-message"),e.innerText=t,this.container.querySelector(".chatbot-container").appendChild(e),this.scrollToBottom()}scrollToBottom(){this.container.scrollTop=this.container.scrollHeight}saveToHistory(t,e){const o=JSON.parse(localStorage.getItem("mainChatbotHistory"))||[];o.push({sender:t,message:e}),localStorage.setItem("mainChatbotHistory",JSON.stringify(o))}removeInteractiveElements(){this.container.querySelectorAll("button-component, carousel-component").forEach(e=>e.remove())}}class m{constructor(t,e){this.core=t,this.ui=e,this.historyKey="mainChatbotHistory",this.isLaunched=!1,this.setupEventListeners()}setupEventListeners(){n.on(r.MAIN_CHATBOT.MESSAGE_RECEIVED,t=>{this.ui.addMessage("assistant",t.content)}),n.on(r.MAIN_CHATBOT.CHOICE_PRESENTED,t=>{this.ui.addButtons(t.choices)}),n.on(r.MAIN_CHATBOT.CAROUSEL_PRESENTED,t=>{this.ui.addCarousel(t.carouselItems)}),n.on(r.MAIN_CHATBOT.ERROR,t=>{this.ui.displayError(t.message)})}launch(){this.isLaunched||(this.core.sendLaunch(),this.isLaunched=!0)}sendMessage(t){this.core.sendMessage(t),this.ui.addMessage("user",t),this.saveToHistory("user",t)}loadHistory(){const t=JSON.parse(localStorage.getItem(this.historyKey))||[];t.forEach(e=>{this.ui.addMessage(e.sender,e.message)}),t.length>0&&t[t.length-1].sender}saveToHistory(t,e){const o=JSON.parse(localStorage.getItem(this.historyKey))||[];o.push({sender:t,message:e}),localStorage.setItem(this.historyKey,JSON.stringify(o))}}document.addEventListener("DOMContentLoaded",()=>{const i=document.getElementById("main-chatbot-ui");if(!i){console.error("Main Chatbot UI container not found");return}let t=localStorage.getItem("mainChatbotUserId");t||(t=l("mainChatbot"),localStorage.setItem("mainChatbotUserId",t));const e=new d({userID:t,endpoint:"https://chatbottings--development.gadget.app/voiceflowAPI/voiceflow-streaming",chatbotType:"main"}),o=new u(i),s=new m(e,o);s.loadHistory(),o.onUserMessage(a=>{s.sendMessage(a)}),o.onButtonClick(a=>{s.sendMessage(JSON.stringify(a))});let c=!1;const h=document.getElementById("header-ai-trigger");h?h.addEventListener("click",()=>{c||(s.launch(),c=!0)}):console.error("Chatbot drawer element not found")});export{m as M};
//# sourceMappingURL=chatbot-main.Dt1Gw9LQ.js.map
