{"version":3,"file":"chatbot-core.08-Miedt.js","sources":["../frontend/utils/event-bus.js","../frontend/utils/event-constants.js","../frontend/core/chatbot-core.js","../frontend/ui/chatbot-main-ui.js","../frontend/utils/user-id-generator.js","../frontend/entrypoints/chatbot-main.js","../frontend/ui/chatbot-section-ui.js","../frontend/entrypoints/chatbot-section.js","../frontend/components/ui/button-component.js","../frontend/components/ui/message-component.js","../frontend/components/ui/carousel-component.js","../frontend/components/ui/chatbot-components.js"],"sourcesContent":["// /assets/scripts/chatbot/utils/event-bus.js\n\nimport EventEmitter from \"eventemitter3\";\n\n/**\n * EventBus Class\n * Extends the EventEmitter from eventemitter3 to create a centralized event hub.\n */\nclass EventBus extends EventEmitter {}\n\n/**\n * Singleton instance of EventBus\n * Ensures that all modules import the same EventBus instance.\n */\nconst eventBus = new EventBus();\n\nexport default eventBus;\n","// /assets/scripts/chatbot/utils/event-constants.js\n\n/**\n * EVENTS Object\n * Defines all the event names used by the Main Chatbot and Section Chatbot.\n * Namespacing ensures that events are uniquely identified and do not conflict.\n */\nexport const EVENTS = {\n  MAIN_CHATBOT: {\n    MESSAGE_RECEIVED: \"mainChatbot:messageReceived\",\n    TYPING: \"mainChatbot:typing\",\n    CHOICE_PRESENTED: \"mainChatbot:choicePresented\",\n    CAROUSEL_PRESENTED: \"mainChatbot:carouselPresented\",\n    ERROR: \"mainChatbot:error\",\n    MAIN_MENU_CLICKED: \"mainChatbot:mainMenuClicked\", // Add this new event\n    // Additional events can be added here as needed\n  },\n  SECTION_CHATBOT: {\n    MESSAGE_RECEIVED: \"sectionChatbot:messageReceived\",\n    DEVICE_ANSWER: \"sectionChatbot:deviceAnswer\",\n    CHOICE_PRESENTED: \"sectionChatbot:choicePresented\",\n    CAROUSEL_PRESENTED: \"sectionChatbot:carouselPresented\",\n    ERROR: \"sectionChatbot:error\",\n    // Additional events can be added here as needed\n  },\n};\n","// /assets/scripts/chatbot/core/chatbot-core.js\n\nimport eventBus from \"../utils/event-bus.js\";\nimport { EVENTS } from \"../utils/event-constants.js\";\n\n/**\n * ChatbotCore Class\n * Handles communication with Voiceflow API via Gadget API, processes incoming data,\n * manages Voiceflow variables, and emits events based on trace types.\n */\nclass ChatbotCore {\n  constructor({ userID, endpoint, chatbotType }) {\n    if (!userID) {\n      throw new Error(\"ChatbotCore requires a userID.\");\n    }\n    if (!endpoint) {\n      throw new Error(\"ChatbotCore requires an endpoint URL.\");\n    }\n    if (!chatbotType) {\n      throw new Error(\n        'ChatbotCore requires a chatbotType (\"main\" or \"section\").'\n      );\n    }\n\n    this.userID = userID;\n    this.endpoint = endpoint;\n    this.chatbotType = chatbotType; // 'main' or 'section'\n    this.eventPrefix =\n      chatbotType === \"main\" ? \"mainChatbot\" : \"sectionChatbot\";\n\n    this.abortController = null; // For aborting the fetch request if needed\n\n    this.initialize();\n  }\n\n  initialize() {\n    // Initial setup if needed\n  }\n\n  /**\n   * Sends a launch request to initiate the conversation.\n   */\n  sendLaunch(variables = {}) {\n    console.log(\"Constructing launch payload\");\n    const payload = {\n      action: {\n        type: \"launch\",\n      },\n    };\n    console.log(\"Final launch payload:\", payload);\n\n    return this.sendAction(payload);\n  }\n\n  /**\n   * Sends a user message to the chatbot.\n   * @param {string | Object} message - The user's message or button payload\n   */\n  sendMessage(message) {\n    console.log(\"Constructing message payload:\", message);\n\n    // If message is an object (button payload), use it directly\n    const payload = {\n      action: {\n        type: \"text\",\n        payload: typeof message === \"object\" ? message : message,\n      },\n    };\n\n    console.log(\"Final message payload:\", payload);\n    return this.sendAction(payload);\n  }\n\n  /**\n   * Sends an action (launch, message, etc.) to the Gadget API via POST and handles SSE response.\n   * @param {Object} actionPayload - The action payload to send.\n   */\n  async sendAction(actionPayload) {\n    this.abortController = new AbortController();\n    const { signal } = this.abortController;\n\n    try {\n      console.log(\"Sending action to Gadget API:\", actionPayload);\n\n      // Show typing indicator before sending request\n      eventBus.emit(`${this.eventPrefix}:typing`, { isTyping: true });\n\n      const response = await fetch(this.endpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          userID: this.userID,\n          action: actionPayload.action,\n        }),\n        credentials: \"include\",\n        signal: signal,\n      });\n\n      if (!response.ok) {\n        throw new Error(`Gadget API responded with status ${response.status}`);\n      }\n\n      const reader = response.body.getReader();\n      const decoder = new TextDecoder(\"utf-8\");\n      let buffer = \"\";\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) {\n          eventBus.emit(`${this.eventPrefix}:end`, {});\n          break;\n        }\n\n        buffer += decoder.decode(value, { stream: true });\n        const events = buffer.split(\"\\n\\n\");\n        buffer = events.pop(); // Remaining partial event\n\n        events.forEach((eventStr) => {\n          if (eventStr.trim() === \"\") return;\n          try {\n            const lines = eventStr.split(\"\\n\");\n            const eventTypeLine = lines.find((line) =>\n              line.startsWith(\"event:\")\n            );\n            const dataLine = lines.find((line) => line.startsWith(\"data:\"));\n\n            const eventType = eventTypeLine\n              ? eventTypeLine.split(\":\")[1].trim()\n              : \"trace\";\n            const data = dataLine\n              ? JSON.parse(\n                  eventStr.substring(eventStr.indexOf(\"data:\") + 5).trim()\n                )\n              : null;\n\n            if (eventType === \"trace\") {\n              this.processTrace(data);\n            } else if (eventType === \"end\") {\n              eventBus.emit(`${this.eventPrefix}:end`, {});\n            }\n            // Handle other event types if necessary\n          } catch (error) {\n            console.error(\"Error parsing SSE event:\", error);\n          }\n        });\n      }\n    } catch (error) {\n      // Hide typing indicator on error\n      eventBus.emit(`${this.eventPrefix}:typing`, { isTyping: false });\n\n      if (error.name === \"AbortError\") {\n        console.warn(\"SSE connection aborted\");\n      } else {\n        console.error(\"SSE connection error:\", error);\n        eventBus.emit(`${this.eventPrefix}:error`, { message: error.message });\n      }\n    } finally {\n      this.abortController = null;\n      eventBus.emit(`${this.eventPrefix}:end`, {});\n      // Hide typing indicator when everything is done\n      eventBus.emit(`${this.eventPrefix}:typing`, { isTyping: false });\n    }\n  }\n\n  /**\n   * Processes individual trace events and emits corresponding events via EventBus.\n   * @param {Object} trace - The trace object received from Voiceflow.\n   */\n  processTrace(trace) {\n    if (!trace.type) {\n      console.warn(\"Trace without type received:\", trace);\n      return;\n    }\n\n    // Hide typing indicator when we receive any trace\n    eventBus.emit(`${this.eventPrefix}:typing`, { isTyping: false });\n\n    switch (trace.type) {\n      case \"text\":\n        console.log(\"Text received trace:\", trace);\n        eventBus.emit(`${this.eventPrefix}:messageReceived`, {\n          content: trace.payload.message,\n          metadata: trace.payload.metadata || null, // Include metadata if available\n        });\n        break;\n      case \"choice\":\n        console.log(\"Choice received trace:\", trace);\n        eventBus.emit(`${this.eventPrefix}:choicePresented`, {\n          type: \"choice\",\n          buttons: trace.payload.buttons,\n        });\n        break;\n\n      case \"carousel\":\n        console.log(\"Carousel received trace:\", trace);\n        eventBus.emit(`${this.eventPrefix}:carouselPresented`, {\n          type: \"carousel\",\n          carouselItems: trace.payload.cards,\n        });\n        break;\n      case \"speak\":\n        console.log(\"Speak received trace:\", trace);\n        // Handle speak traces if necessary\n        break;\n      case \"visual\":\n        console.log(\"Visual received trace:\", trace);\n        // Handle visual traces if necessary\n        break;\n      case \"no-reply\":\n        console.log(\"No-reply received trace:\", trace);\n        // Handle no-reply traces if necessary\n        break;\n      case \"end\":\n        console.log(\"End trace received:\", trace);\n        eventBus.emit(`${this.eventPrefix}:end`, {});\n        break;\n      case \"completion-events\":\n        console.log(\"Completion event trace received:\", trace);\n        // Handle completion events if necessary\n        break;\n      default:\n        console.warn(`Unhandled trace type: ${trace.type}`, trace);\n    }\n  }\n\n  /**\n   * Closes the SSE connection gracefully.\n   */\n  closeConnection() {\n    if (this.abortController) {\n      this.abortController.abort();\n      console.log(\"SSE connection closed.\");\n    }\n  }\n\n  /**\n   * Cleans up resources when the ChatbotCore instance is no longer needed.\n   */\n  destroy() {\n    this.closeConnection();\n    eventBus.removeAllListeners(`${this.eventPrefix}:messageReceived`);\n    eventBus.removeAllListeners(`${this.eventPrefix}:choicePresented`);\n    eventBus.removeAllListeners(`${this.eventPrefix}:carouselPresented`);\n    eventBus.removeAllListeners(`${this.eventPrefix}:deviceAnswer`);\n    eventBus.removeAllListeners(`${this.eventPrefix}:error`);\n    eventBus.removeAllListeners(`${this.eventPrefix}:typing`);\n    eventBus.removeAllListeners(`${this.eventPrefix}:end`);\n  }\n}\n\nexport default ChatbotCore;\n","// /assets/scripts/chatbot/main/main-chatbot-ui.js\n\nimport eventBus from \"../utils/event-bus.js\";\nimport { EVENTS } from \"../utils/event-constants.js\";\n\n/**\n * MainChatbotUI Class\n * Handles UI-specific functionalities for the Main Chatbot.\n */\nclass MainChatbotUI {\n  constructor(container) {\n    this.container = container;\n    this.form = this.container.querySelector(\".chat-form\");\n    this.input = this.container.querySelector(\"input[type='text']\");\n    this.messageContainer = this.container.querySelector(\".message-container\");\n    this.typingIndicator = this.container.querySelector(\".chat-typing\");\n\n    console.log(\"Chatbot UI Container:\", this.container);\n    console.log(\"Chat Form:\", this.form);\n    console.log(\"Chat Input:\", this.input);\n    console.log(\"Message Container:\", this.messageContainer);\n    console.log(\"Typing Indicator:\", this.typingIndicator);\n\n    if (!this.container) {\n      console.error(\"Main Chatbot UI container not found\");\n      return;\n    }\n\n    if (!this.form || !this.input) {\n      console.error(\"Main Chatbot form or input not found\");\n      return;\n    }\n\n    this.setupEventListeners();\n  }\n\n  setupEventListeners() {\n    // Handle form submission\n    this.form.addEventListener(\"submit\", (e) => {\n      e.preventDefault();\n      const message = this.input.value.trim();\n      if (message) {\n        eventBus.emit(\"userMessage\", message);\n        this.input.value = \"\";\n      }\n    });\n\n    // Listen for typing events from ChatbotCore\n    eventBus.on(`${EVENTS.MAIN_CHATBOT.PREFIX}:typing`, (data) => {\n      if (data.isTyping) {\n        this.showTypingIndicator();\n      } else {\n        this.hideTypingIndicator();\n      }\n    });\n\n    // Set up event delegation for button clicks within messages\n    this.messageContainer.addEventListener(\"click\", (e) => {\n      const button = e.target.closest(\"button-component\");\n      if (button) {\n        const payload = JSON.parse(button.getAttribute(\"payload\") || \"{}\");\n        const label = button.getAttribute(\"label\");\n        if (label) {\n          eventBus.emit(\"buttonClicked\", {\n            type: payload.type,\n            payload,\n            label,\n          });\n          this.removeInteractiveElements();\n        }\n      }\n    });\n\n    // Listen at the custom-drawer level\n    document.querySelector(\"custom-drawer\")?.addEventListener(\"click\", (e) => {\n      const menuButton = e.target.closest(\".main-menu\");\n      if (menuButton) {\n        e.preventDefault();\n        eventBus.emit(\"buttonClicked\", {\n          type: \"event\",\n          payload: {\n            event: {\n              name: \"main_menu\",\n            },\n          },\n          label: \"Back to Menu\",\n        });\n      }\n    });\n  }\n\n  /**\n   * Adds a message to the chatbot UI.\n   * @param {string} sender - 'user' or 'assistant'.\n   * @param {string} content - The message content.\n   * @param {Object} [metadata] - Additional metadata about the message.\n   * @param {boolean} [isHistory] - Whether this message is being loaded from history\n   */\n  addMessage(sender, content, metadata = null, isHistory = false) {\n    if (!this.messageContainer) {\n      console.error(\"Message container not set\");\n      return;\n    }\n\n    // Only remove interactive elements if this isn't from history loading\n    // and the current message isn't interactive\n    if (!isHistory && (!metadata || !metadata.isInteractive)) {\n      this.removeInteractiveElements();\n    }\n\n    const message = document.createElement(\"message-component\");\n    message.setAttribute(\"sender\", sender);\n    message.setAttribute(\"content\", content);\n\n    // Add image URL if available in metadata\n    if (metadata?.imageUrl) {\n      message.setAttribute(\"image-url\", metadata.imageUrl);\n    }\n\n    this.messageContainer.appendChild(message);\n    console.log(\"Message appended to messageContainer\");\n    this.scrollToBottom();\n\n    // If metadata includes interactive elements, add them\n    if (sender === \"assistant\" && metadata) {\n      switch (metadata.type) {\n        case \"choice\":\n          this.addButtons(metadata.buttons, isHistory);\n          break;\n        case \"carousel\":\n          this.addCarousel(metadata.carouselItems, isHistory);\n          break;\n        default:\n          break;\n      }\n    }\n  }\n\n  /**\n   * Adds interactive buttons to the chatbot UI.\n   * @param {Array} buttons - Array of button data.\n   * @param {boolean} [isHistory] - Whether these buttons are being loaded from history\n   */\n  addButtons(buttons, isHistory = false) {\n    console.log(\"addButtons called with:\", buttons);\n\n    if (!Array.isArray(buttons)) {\n      console.error(\"addButtons expected an array but received:\", buttons);\n      return;\n    }\n\n    // Only remove existing interactive elements if not loading from history\n    if (!isHistory) {\n      this.removeInteractiveElements();\n      this.storeInteractiveState(\"choice\", buttons);\n    }\n\n    buttons.forEach((buttonData) => {\n      const button = document.createElement(\"button-component\");\n      button.setAttribute(\"label\", buttonData.name);\n      button.setAttribute(\"payload\", JSON.stringify(buttonData.request));\n      this.messageContainer.appendChild(button);\n      console.log(\"Button appended to messageContainer\");\n    });\n    this.scrollToBottom();\n  }\n\n  addCarousel(carouselItems, isHistory = false) {\n    console.log(\"Adding carousel with items:\", carouselItems);\n\n    if (!Array.isArray(carouselItems)) {\n      console.error(\n        \"addCarousel expected an array but received:\",\n        carouselItems\n      );\n      return;\n    }\n\n    // Only remove existing interactive elements if not loading from history\n    if (!isHistory) {\n      this.removeInteractiveElements();\n      this.storeInteractiveState(\"carousel\", carouselItems);\n    }\n\n    const carouselData = { cards: carouselItems };\n    const carousel = document.createElement(\"carousel-component\");\n    carousel.setAttribute(\"data-carousel\", JSON.stringify(carouselData));\n    this.messageContainer.appendChild(carousel);\n    this.scrollToBottom();\n  }\n\n  /**\n   * Stores the state of the last interactive element\n   * @param {string} type - The type of interactive element ('choice' or 'carousel')\n   * @param {Array} data - The data for the interactive element\n   */\n  storeInteractiveState(type, data) {\n    const interactiveState = {\n      type,\n      data,\n      timestamp: Date.now(),\n    };\n    localStorage.setItem(\n      \"lastInteractiveElement\",\n      JSON.stringify(interactiveState)\n    );\n  }\n\n  /**\n   * Restores the last interactive element if it exists\n   */\n  restoreInteractiveElement() {\n    const savedState = localStorage.getItem(\"lastInteractiveElement\");\n    if (savedState) {\n      try {\n        const state = JSON.parse(savedState);\n        if (state.type === \"choice\") {\n          this.addButtons(state.data, true);\n        } else if (state.type === \"carousel\") {\n          this.addCarousel(state.data, true);\n        }\n      } catch (error) {\n        console.error(\"Error restoring interactive element:\", error);\n      }\n    }\n  }\n\n  showTypingIndicator() {\n    if (this.typingIndicator) {\n      this.typingIndicator.style.display = \"flex\";\n      this.scrollToBottom();\n    }\n  }\n\n  hideTypingIndicator() {\n    if (this.typingIndicator) {\n      this.typingIndicator.style.display = \"none\";\n    }\n  }\n\n  displayError(message) {\n    const errorDiv = document.createElement(\"div\");\n    errorDiv.classList.add(\"error-message\");\n    errorDiv.innerText = message;\n    this.messageContainer.appendChild(errorDiv);\n    this.scrollToBottom();\n  }\n\n  scrollToBottom() {\n    this.messageContainer.scrollTop = this.messageContainer.scrollHeight;\n  }\n\n  /**\n   * Removes interactive elements (buttons, carousels) from the UI.\n   */\n  removeInteractiveElements() {\n    const interactiveElements = this.messageContainer.querySelectorAll(\n      \"button-component, carousel-component\"\n    );\n    interactiveElements.forEach((element) => element.remove());\n    // Clear the stored interactive state\n    localStorage.removeItem(\"lastInteractiveElement\");\n  }\n}\n\nexport default MainChatbotUI;\n","/**\n * Generates a unique user ID with the specified prefix.\n * @param {string} prefix - The prefix indicating the chatbot type ('mainChatbot' or 'sectionChatbot').\n * @returns {string} - The generated unique user ID.\n */\nexport function generateUserId(prefix) {\n  const uniquePart =\n    Date.now().toString(36) + Math.random().toString(36).substr(2, 9);\n  return `${prefix}-${uniquePart}`;\n}\n","// /assets/scripts/chatbot/chatbot-main.js\n\nimport ChatbotCore from \"../core/chatbot-core.js\";\nimport MainChatbotUI from \"../ui/chatbot-main-ui.js\";\nimport eventBus from \"../utils/event-bus.js\";\nimport { EVENTS } from \"../utils/event-constants.js\";\nimport { generateUserId } from \"../utils/user-id-generator.js\";\n\n/**\n * MainChatbot Class\n * Manages the Main Chatbot's interactions, conversation history, and UI updates.\n */\nclass MainChatbot {\n  constructor(core, ui) {\n    this.core = core;\n    this.ui = ui;\n    this.historyKey = \"mainChatbotHistory\";\n    this.launchKey = \"chatHasLaunched\";\n    this.isLaunched = this.hasLaunched();\n    this.setupEventListeners();\n  }\n\n  hasLaunched() {\n    return localStorage.getItem(this.launchKey) === \"true\";\n  }\n\n  setLaunched() {\n    localStorage.setItem(this.launchKey, \"true\");\n    this.isLaunched = true;\n  }\n\n  setupEventListeners() {\n    // Listen to messageReceived events\n    eventBus.on(EVENTS.MAIN_CHATBOT.MESSAGE_RECEIVED, (data) => {\n      this.ui.addMessage(\"assistant\", data.content, data.metadata);\n      this.saveToHistory(\"assistant\", data.content, data.metadata);\n    });\n\n    // Listen to user messages\n    eventBus.on(\"userMessage\", (message) => {\n      this.ui.addMessage(\"user\", message);\n      this.saveToHistory(\"user\", message);\n      this.core.sendMessage(message);\n    });\n\n    // Listen to button clicks\n    eventBus.on(\"buttonClicked\", (data) => {\n      if (!data || !data.label) {\n        console.error(\"Invalid button data:\", data);\n        return;\n      }\n\n      // Display the button's label as the user's message\n      this.ui.addMessage(\"user\", data.label);\n      this.saveToHistory(\"user\", data.label);\n\n      // Send the button payload to Voiceflow\n      const actionPayload = {\n        action: {\n          type: data.type,\n        },\n      };\n\n      // Only add payload if it exists and has content\n      if (data.payload && Object.keys(data.payload).length > 0) {\n        actionPayload.action.payload = data.payload;\n      }\n\n      this.core.sendAction(actionPayload);\n    });\n\n    // Listen to choicePresented events\n    eventBus.on(EVENTS.MAIN_CHATBOT.CHOICE_PRESENTED, (data) => {\n      this.ui.addButtons(data.buttons);\n      // Save to history with metadata, but without message\n      this.saveToHistory(\"assistant\", \"\", {\n        type: \"choice\",\n        buttons: data.buttons,\n      });\n    });\n\n    // Listen to carouselPresented events\n    eventBus.on(EVENTS.MAIN_CHATBOT.CAROUSEL_PRESENTED, (data) => {\n      this.ui.addCarousel(data.carouselItems);\n      // Save to history with metadata, but without message\n      this.saveToHistory(\"assistant\", \"\", {\n        type: \"carousel\",\n        carouselItems: data.carouselItems,\n      });\n    });\n\n    // Listen to error events\n    eventBus.on(EVENTS.MAIN_CHATBOT.ERROR, (error) => {\n      this.ui.displayError(error.message);\n    });\n\n    // Listen to typing events\n    eventBus.on(EVENTS.MAIN_CHATBOT.TYPING, (data) => {\n      if (data.isTyping) {\n        this.ui.showTypingIndicator();\n      } else {\n        this.ui.hideTypingIndicator();\n      }\n    });\n\n    // Listen for chatbot launch event\n    document.addEventListener(\"chatbotLaunch\", () => {\n      this.launch();\n    });\n\n    // Handle carousel button clicks\n    eventBus.on(\"carouselButtonClicked\", (data) => {\n      if (!data || !data.action) {\n        console.error(\"Invalid carousel button data:\", data);\n        return;\n      }\n\n      // Add the button text as a user message\n      this.ui.addMessage(\"user\", data.label);\n      this.saveToHistory(\"user\", data.label);\n\n      // Send the action to Voiceflow\n      this.core.sendAction({\n        action: data.action,\n      });\n    });\n  }\n\n  launch() {\n    if (this.isLaunched) {\n      console.log(\"Chat already launched, skipping launch request\");\n      return;\n    }\n\n    this.core\n      .sendLaunch()\n      .then(() => {\n        console.log(\"Chatbot launched successfully.\");\n        this.setLaunched();\n      })\n      .catch((error) => {\n        console.error(\"Error launching chatbot:\", error);\n        this.ui.displayError(\n          \"Failed to launch the chatbot. Please try again later.\"\n        );\n      });\n  }\n\n  sendMessage(message) {\n    const sanitizedMessage = this.sanitizeInput(message);\n\n    this.ui.addMessage(\"user\", sanitizedMessage, { type: \"message\" });\n    this.saveToHistory(\"user\", sanitizedMessage, { type: \"message\" });\n\n    this.core.sendMessage(sanitizedMessage).catch((error) => {\n      console.error(\"Error sending message:\", error);\n      this.ui.displayError(\"Failed to send your message. Please try again.\");\n    });\n  }\n\n  sendAction(actionPayload) {\n    if (!actionPayload || typeof actionPayload !== \"object\") {\n      console.error(\"Invalid action payload:\", actionPayload);\n      this.ui.displayError(\"Invalid action triggered.\");\n      return;\n    }\n\n    this.core\n      .sendAction({\n        action: actionPayload,\n        config: {},\n      })\n      .then(() => {\n        console.log(\"Action sent successfully:\", actionPayload);\n        this.ui.addMessage(\"user\", actionPayload.label || \"Action executed.\", {\n          type: \"action\",\n        });\n        this.saveToHistory(\"user\", JSON.stringify(actionPayload), {\n          type: \"action\",\n        });\n      })\n      .catch((error) => {\n        console.error(\"Error sending action:\", error);\n        this.ui.displayError(\n          \"An error occurred while processing your request.\"\n        );\n      });\n  }\n\n  saveToHistory(sender, message, metadata = null) {\n    const history = JSON.parse(localStorage.getItem(this.historyKey)) || [];\n\n    // Create history entry with additional trace data for interactive elements\n    const historyEntry = {\n      sender,\n      message,\n      timestamp: Date.now(),\n      isInteractive: false, // Add flag for interactive elements\n    };\n\n    // If this is an assistant message with choice or carousel, store the trace\n    if (sender === \"assistant\" && metadata) {\n      if (metadata.type === \"choice\") {\n        historyEntry.isInteractive = true;\n        historyEntry.traceType = \"choice\";\n        historyEntry.traceData = { buttons: metadata.buttons };\n      } else if (metadata.type === \"carousel\") {\n        historyEntry.isInteractive = true;\n        historyEntry.traceType = \"carousel\";\n        historyEntry.traceData = { cards: metadata.carouselItems };\n      }\n    }\n\n    history.push(historyEntry);\n    localStorage.setItem(this.historyKey, JSON.stringify(history));\n  }\n\n  loadHistory() {\n    const history = JSON.parse(localStorage.getItem(this.historyKey)) || [];\n\n    // Process all messages\n    history.forEach((entry, index) => {\n      // If it's an interactive element\n      if (entry.isInteractive) {\n        // Only restore interactive element if it's the last entry\n        if (index === history.length - 1) {\n          if (entry.traceType === \"choice\") {\n            this.ui.addButtons(entry.traceData.buttons, true);\n          } else if (entry.traceType === \"carousel\") {\n            this.ui.addCarousel(entry.traceData.cards, true);\n          }\n        }\n        // Skip adding message for interactive elements since they should have empty messages\n        return;\n      }\n\n      // For non-interactive messages, display them normally\n      if (entry.message) {\n        this.ui.addMessage(entry.sender, entry.message);\n      }\n    });\n  }\n\n  restoreInteractiveElement(historyEntry) {\n    if (historyEntry.traceType === \"choice\") {\n      this.ui.addButtons(historyEntry.traceData.buttons, true);\n    } else if (historyEntry.traceType === \"carousel\") {\n      this.ui.addCarousel(historyEntry.traceData.cards, true);\n    }\n  }\n\n  sanitizeInput(input) {\n    const div = document.createElement(\"div\");\n    div.textContent = input;\n    return div.innerHTML;\n  }\n}\n\n// Initialize Main Chatbot on DOMContentLoaded\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  const mainChatbotContainer = document.getElementById(\"main-chatbot-ui\");\n\n  if (!mainChatbotContainer) {\n    console.error(\"Main Chatbot UI container not found\");\n    return;\n  }\n\n  // Generate or retrieve existing userID for Main Chatbot\n  let mainUserId = localStorage.getItem(\"mainChatbotUserId\");\n  if (!mainUserId) {\n    mainUserId = generateUserId(\"mainChatbot\");\n    localStorage.setItem(\"mainChatbotUserId\", mainUserId);\n  }\n\n  // Initialize ChatbotCore with the generated userID\n  const mainChatbotCore = new ChatbotCore({\n    userID: mainUserId,\n    endpoint:\n      \"https://chatbottings--development.gadget.app/voiceflowAPI/voiceflow-streaming\", // Update to your actual endpoint\n    chatbotType: \"main\",\n  });\n\n  // Initialize MainChatbotUI\n  const mainChatbotUI = new MainChatbotUI(mainChatbotContainer);\n\n  // Initialize MainChatbot\n  const mainChatbot = new MainChatbot(mainChatbotCore, mainChatbotUI);\n\n  // Load conversation history\n  mainChatbot.loadHistory();\n});\n\nexport default MainChatbot;\n","// /assets/scripts/chatbot/section/section-chatbot-ui.js\n\nimport eventBus from \"../utils/event-bus.js\";\nimport { EVENTS } from \"../utils/event-constants.js\";\n\n/**\n * SectionChatbotUI Class\n * Handles all UI-specific functionalities for the Section Chatbot.\n * Manages message display, interactive elements, and product details.\n *\n * @class\n * @property {HTMLElement} container - The main container element for the chatbot UI\n * @property {HTMLFormElement} form - The form element for user input\n * @property {HTMLInputElement} input - The text input element\n * @property {HTMLElement} messageContainer - Container for chat messages\n * @property {Object} productDetails - Product information from data attributes\n */\nclass SectionChatbotUI {\n  /**\n   * Creates a new SectionChatbotUI instance.\n   * Initializes UI elements and extracts product details from container attributes.\n   *\n   * @param {HTMLElement} container - The section chatbot UI container\n   * @throws {Error} If required UI elements are not found\n   */\n  constructor(container) {\n    if (!container) {\n      throw new Error(\"SectionChatbotUI requires a container element\");\n    }\n\n    this.container = container;\n    this.form = this.container.querySelector(\".chat-form\");\n    this.input = this.container.querySelector(\"input[type='text']\");\n    this.messageContainer = this.container.querySelector(\".message-container\");\n    this.typingIndicator = this.container.querySelector(\".typing-indicator\");\n\n    if (!this.form || !this.input || !this.messageContainer) {\n      throw new Error(\"Required UI elements not found in container\");\n    }\n\n    this.initializeProductDetails();\n    this.setupEventListeners();\n  }\n\n  /**\n   * Initializes product details from container data attributes.\n   *\n   * @private\n   */\n  initializeProductDetails() {\n    this.productDetails = {\n      title: this.getAttribute(\"product-title\"),\n      capacity: this.getAttribute(\"product-capacity\"),\n      ac_output_continuous_power: this.getAttribute(\n        \"product-ac_output_continuous_power\"\n      ),\n      ac_output_peak_power: this.getAttribute(\"product-ac_output_peak_power\"),\n      dc_output_power: this.getAttribute(\"product-dc_output_power\"),\n    };\n\n    console.log(\"Initialized product details:\", this.productDetails);\n  }\n\n  /**\n   * Sets up event listeners for user interactions within the UI.\n   *\n   * @private\n   */\n  setupEventListeners() {\n    // Handle form submissions\n    this.form.addEventListener(\"submit\", (e) => {\n      e.preventDefault();\n      const message = this.input.value.trim();\n      if (message) {\n        eventBus.emit(\"userMessage\", message);\n        this.input.value = \"\";\n      }\n    });\n\n    // Handle button clicks through event delegation\n    this.messageContainer.addEventListener(\"click\", (e) => {\n      const button = e.target.closest(\"button-component\");\n      if (button) {\n        const payload = this.getButtonPayload(button);\n        if (payload) {\n          eventBus.emit(\"buttonClicked\", payload);\n          this.removeInteractiveElements();\n        }\n      }\n    });\n\n    // Handle carousel interactions\n    this.messageContainer.addEventListener(\"click\", (e) => {\n      const carousel = e.target.closest(\"carousel-component\");\n      if (carousel) {\n        const button = e.target.closest(\".carousel-button\");\n        if (button) {\n          const payload = this.getButtonPayload(button);\n          if (payload) {\n            eventBus.emit(\"carouselButtonClicked\", payload);\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * Gets the payload data from a button element.\n   *\n   * @private\n   * @param {HTMLElement} button - The button element\n   * @returns {Object|null} The button's payload data or null if invalid\n   */\n  getButtonPayload(button) {\n    try {\n      return JSON.parse(button.getAttribute(\"payload\") || \"null\");\n    } catch (error) {\n      console.error(\"Error parsing button payload:\", error);\n      return null;\n    }\n  }\n\n  /**\n   * Adds a message to the chatbot UI.\n   *\n   * @public\n   * @param {string} sender - 'user' or 'assistant'\n   * @param {string} content - The message content\n   * @param {Object} [metadata] - Optional metadata for the message\n   */\n  addMessage(sender, content, metadata = null) {\n    const message = document.createElement(\"message-component\");\n    message.setAttribute(\"sender\", sender);\n    message.setAttribute(\"content\", content);\n\n    if (metadata) {\n      message.setAttribute(\"metadata\", JSON.stringify(metadata));\n    }\n\n    this.messageContainer.appendChild(message);\n    this.scrollToBottom();\n  }\n\n  /**\n   * Adds interactive buttons to the chatbot UI.\n   *\n   * @public\n   * @param {Array} buttons - Array of button data\n   */\n  addButtons(buttons) {\n    if (!Array.isArray(buttons)) {\n      console.error(\"Invalid buttons data:\", buttons);\n      return;\n    }\n\n    const buttonsContainer = document.createElement(\"div\");\n    buttonsContainer.className = \"buttons-container\";\n\n    buttons.forEach((buttonData) => {\n      const button = document.createElement(\"button-component\");\n      button.setAttribute(\"label\", buttonData.name);\n      button.setAttribute(\"payload\", JSON.stringify(buttonData.request));\n      buttonsContainer.appendChild(button);\n    });\n\n    this.messageContainer.appendChild(buttonsContainer);\n    this.scrollToBottom();\n  }\n\n  /**\n   * Adds a carousel to the chatbot UI.\n   *\n   * @public\n   * @param {Array} items - Array of carousel items\n   */\n  addCarousel(items) {\n    if (!Array.isArray(items)) {\n      console.error(\"Invalid carousel items:\", items);\n      return;\n    }\n\n    const carousel = document.createElement(\"carousel-component\");\n    carousel.setAttribute(\"items\", JSON.stringify(items));\n    this.messageContainer.appendChild(carousel);\n    this.scrollToBottom();\n  }\n\n  /**\n   * Shows the typing indicator.\n   *\n   * @public\n   */\n  showTypingIndicator() {\n    if (this.typingIndicator) {\n      this.typingIndicator.style.display = \"flex\";\n      this.scrollToBottom();\n    }\n  }\n\n  /**\n   * Hides the typing indicator.\n   *\n   * @public\n   */\n  hideTypingIndicator() {\n    if (this.typingIndicator) {\n      this.typingIndicator.style.display = \"none\";\n    }\n  }\n\n  /**\n   * Displays an error message in the chatbot UI.\n   *\n   * @public\n   * @param {string} message - The error message\n   */\n  displayError(message) {\n    const errorDiv = document.createElement(\"div\");\n    errorDiv.classList.add(\"error-message\");\n    errorDiv.innerText = message;\n    this.messageContainer.appendChild(errorDiv);\n    this.scrollToBottom();\n  }\n\n  /**\n   * Scrolls the message container to the bottom.\n   *\n   * @private\n   */\n  scrollToBottom() {\n    this.messageContainer.scrollTop = this.messageContainer.scrollHeight;\n  }\n\n  /**\n   * Retrieves the value of a specified attribute from the chatbot container.\n   *\n   * @private\n   * @param {string} attrName - The name of the attribute\n   * @returns {string|null} The value of the attribute or null if not found\n   */\n  getAttribute(attrName) {\n    return this.container.getAttribute(attrName);\n  }\n\n  /**\n   * Removes all interactive elements from the UI.\n   *\n   * @public\n   */\n  removeInteractiveElements() {\n    const elements = this.messageContainer.querySelectorAll(\n      \"button-component, carousel-component, .buttons-container\"\n    );\n    elements.forEach((element) => element.remove());\n  }\n}\n\nexport default SectionChatbotUI;\n","// /assets/scripts/chatbot/section/section-chatbot.js\n\nimport ChatbotCore from \"../core/chatbot-core.js\";\nimport SectionChatbotUI from \"../ui/chatbot-section-ui.js\";\nimport eventBus from \"../utils/event-bus.js\";\nimport { EVENTS } from \"../utils/event-constants.js\";\nimport { generateUserId } from \"../utils/user-id-generator.js\";\n\n/**\n * SectionChatbot Class\n * Manages the Section Chatbot's interactions, handles product details, and updates the UI.\n * Does not maintain conversation history, focuses on immediate interactions.\n *\n * @class\n * @property {ChatbotCore} core - Instance of ChatbotCore handling API communications\n * @property {SectionChatbotUI} ui - Instance of SectionChatbotUI handling UI updates\n * @property {boolean} isLaunched - Tracks whether the chatbot has been launched\n */\nclass SectionChatbot {\n  /**\n   * Creates a new SectionChatbot instance.\n   * Initializes the core functionality and UI components.\n   *\n   * @param {ChatbotCore} core - ChatbotCore instance for API communication\n   * @param {SectionChatbotUI} ui - SectionChatbotUI instance for UI management\n   */\n  constructor(core, ui) {\n    if (!core || !ui) {\n      throw new Error(\"SectionChatbot requires both core and ui instances\");\n    }\n\n    this.core = core;\n    this.ui = ui;\n    this.isLaunched = false;\n\n    this.validateProductDetails();\n    this.setupEventListeners();\n  }\n\n  /**\n   * Validates that all required product details are present.\n   * Displays an error message if required fields are missing.\n   *\n   * @private\n   */\n  validateProductDetails() {\n    const requiredFields = [\"title\", \"capacity\"];\n    const missingFields = requiredFields.filter(\n      (field) => !this.ui.productDetails[field]\n    );\n\n    if (missingFields.length > 0) {\n      console.error(\n        `Missing required product details: ${missingFields.join(\", \")}`\n      );\n      this.ui.displayError(\n        \"Some product information is missing. Chat functionality may be limited.\"\n      );\n    }\n  }\n\n  /**\n   * Sets up event listeners for all chatbot interactions.\n   * Handles message reception, user interactions, and error states.\n   *\n   * @private\n   */\n  setupEventListeners() {\n    // Message handling with typing indicators\n    eventBus.on(EVENTS.SECTION_CHATBOT.MESSAGE_RECEIVED, (data) => {\n      this.ui.hideTypingIndicator();\n      this.ui.addMessage(\"assistant\", data.content, data.metadata);\n    });\n\n    // Typing indicator management\n    eventBus.on(EVENTS.SECTION_CHATBOT.TYPING, (data) => {\n      if (data.isTyping) {\n        this.ui.showTypingIndicator();\n      } else {\n        this.ui.hideTypingIndicator();\n      }\n    });\n\n    // Button choice handling\n    eventBus.on(EVENTS.SECTION_CHATBOT.CHOICE_PRESENTED, (data) => {\n      this.ui.hideTypingIndicator();\n      this.ui.addButtons(data.buttons);\n    });\n\n    // Carousel handling\n    eventBus.on(EVENTS.SECTION_CHATBOT.CAROUSEL_PRESENTED, (data) => {\n      this.ui.hideTypingIndicator();\n      this.ui.addCarousel(data.carouselItems);\n    });\n\n    // Error handling\n    eventBus.on(EVENTS.SECTION_CHATBOT.ERROR, (error) => {\n      this.ui.hideTypingIndicator();\n      this.ui.displayError(error.message);\n    });\n\n    // User message handling\n    eventBus.on(\"userMessage\", (message) => {\n      this.sendMessage(message);\n    });\n\n    // Button click handling\n    eventBus.on(\"buttonClicked\", (payload) => {\n      this.handleButtonClick(payload);\n    });\n\n    // Carousel button click handling\n    eventBus.on(\"carouselButtonClicked\", (payload) => {\n      this.handleButtonClick(payload);\n    });\n\n    // Handle page cleanup\n    window.addEventListener(\"unload\", () => {\n      this.destroy();\n    });\n  }\n\n  /**\n   * Launches the chatbot with product details.\n   * Only launches if not already launched.\n   *\n   * @public\n   */\n  launch() {\n    if (this.isLaunched) {\n      console.log(\"Section chatbot already launched\");\n      return;\n    }\n\n    const sanitizedDetails = this.sanitizeProductDetails(\n      this.ui.productDetails\n    );\n    const interactPayload = {\n      action: {\n        type: \"launch\",\n        payload: {\n          startBlock: \"shopifySection\",\n          productDetails: sanitizedDetails,\n        },\n      },\n    };\n\n    console.log(\"Launching section chatbot with payload:\", interactPayload);\n    this.ui.showTypingIndicator();\n    this.core.sendLaunch(interactPayload);\n    this.isLaunched = true;\n  }\n\n  /**\n   * Sanitizes product details before sending to the API.\n   *\n   * @private\n   * @param {Object} details - Raw product details\n   * @returns {Object} Sanitized product details\n   */\n  sanitizeProductDetails(details) {\n    return Object.entries(details).reduce((acc, [key, value]) => {\n      acc[key] = value ? String(value).trim() : \"\";\n      return acc;\n    }, {});\n  }\n\n  /**\n   * Sends a user message to the chatbot.\n   *\n   * @public\n   * @param {string} message - User's message to send\n   */\n  sendMessage(message) {\n    if (!message.trim()) return;\n\n    this.ui.showTypingIndicator();\n    this.core.sendMessage(message);\n    this.ui.addMessage(\"user\", message);\n  }\n\n  /**\n   * Handles button click interactions.\n   *\n   * @public\n   * @param {Object} payload - Button click payload\n   */\n  handleButtonClick(payload) {\n    if (!payload) return;\n\n    this.ui.showTypingIndicator();\n    this.core.sendAction({\n      action: payload,\n    });\n    this.ui.removeInteractiveElements();\n  }\n\n  /**\n   * Cleans up resources and event listeners.\n   *\n   * @public\n   */\n  destroy() {\n    this.core.closeConnection();\n    eventBus.removeAllListeners(`${EVENTS.SECTION_CHATBOT.PREFIX}:`);\n    eventBus.removeAllListeners(\"userMessage\");\n    eventBus.removeAllListeners(\"buttonClicked\");\n    eventBus.removeAllListeners(\"carouselButtonClicked\");\n  }\n}\n\n// Initialize Section Chatbot on DOMContentLoaded\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  const sectionChatbotContainer = document.getElementById(\"section-chatbot-ui\");\n\n  if (!sectionChatbotContainer) {\n    console.error(\"Section Chatbot UI container not found\");\n    return;\n  }\n\n  // Generate or retrieve existing userID for Section Chatbot\n  let sectionUserId = localStorage.getItem(\"sectionChatbotUserId\");\n  if (!sectionUserId) {\n    sectionUserId = generateUserId(\"sectionChatbot\");\n    localStorage.setItem(\"sectionChatbotUserId\", sectionUserId);\n  }\n\n  // Initialize ChatbotCore with the generated userID\n  const sectionChatbotCore = new ChatbotCore({\n    userID: sectionUserId,\n    endpoint:\n      \"https://chatbottings--development.gadget.app/voiceflowAPI/voiceflow-streaming\",\n    chatbotType: \"section\",\n  });\n\n  // Initialize SectionChatbotUI\n  const sectionChatbotUI = new SectionChatbotUI(sectionChatbotContainer);\n\n  // Initialize SectionChatbot\n  const sectionChatbot = new SectionChatbot(\n    sectionChatbotCore,\n    sectionChatbotUI\n  );\n\n  // Handle launch event on first focus of the input field\n  const sectionInput = sectionChatbotContainer.querySelector(\n    \"#section-chatbot-input\"\n  );\n\n  if (sectionInput) {\n    sectionInput.addEventListener(\"focus\", () => {\n      if (!sectionChatbot.isLaunched) {\n        sectionChatbot.launch();\n      }\n    });\n  } else {\n    console.error(\"Section Chatbot input field not found\");\n  }\n});\n\nexport default SectionChatbot;\n","// /assets/scripts/chatbot/components/button-component.js\n\nimport eventBus from \"../../utils/event-bus.js\";\n\nexport class ButtonComponent extends HTMLElement {\n  constructor() {\n    super();\n    // Attach Shadow DOM to encapsulate styles\n    this.attachShadow({ mode: \"open\" });\n  }\n\n  connectedCallback() {\n    const label = this.getAttribute(\"label\");\n    const payload = this.getAttribute(\"payload\");\n\n    this.render(label, payload);\n  }\n\n  /**\n   * Renders the button with embedded styles.\n   * @param {string} label - The button label\n   * @param {string} payload - The button payload in JSON string format\n   */\n  render(label, payload) {\n    this.shadowRoot.innerHTML = `\n      <style>\n        .button-container {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 10px;\n          margin-bottom: var(--spacing-4);\n        }\n\n        .button {\n          padding: var(--spacing-3);\n          background-color: #FFFFFF;\n          border: none;\n          border-radius: var(--rounded);\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 14px;\n          transition: background-color 0.3s ease;\n        }\n\n        .button:hover {\n          background-color: #f0f0f0;\n        }\n\n        /* Additional styles as needed */\n      </style>\n      <div class=\"button-container\">\n        <button class=\"button\" data-button-data='${payload}' aria-label=\"${label}\">${label}</button>\n      </div>\n    `;\n\n    // Add event listener to the button\n    this.shadowRoot.querySelector(\".button\").addEventListener(\"click\", () => {\n      // Emit event via eventBus\n      try {\n        const parsedPayload = JSON.parse(payload);\n        eventBus.emit(\"buttonClicked\", parsedPayload);\n      } catch (error) {\n        console.error(\"Error parsing button payload:\", error);\n      }\n    });\n  }\n}\n","// /assets/scripts/chatbot/components/message-component.js\n\nexport class MessageComponent extends HTMLElement {\n  constructor() {\n    super();\n    // Attach Shadow DOM to encapsulate styles\n    this.attachShadow({ mode: \"open\" });\n  }\n\n  connectedCallback() {\n    const sender = this.getAttribute(\"sender\");\n    const content = this.getAttribute(\"content\");\n\n    this.render(sender, content);\n  }\n\n  /**\n   * Renders the message with appropriate styling based on the sender.\n   * @param {string} sender - 'user' or 'assistant'\n   * @param {string} content - The message content\n   */\n  render(sender, content) {\n    const isAssistant = sender === \"assistant\";\n    this.shadowRoot.innerHTML = `\n      <style>\n        message-component {\n          width: 100%;\n        }\n        .message-wrapper {\n          display: flex;\n          align-items: flex-end;\n          width: 100%;\n          margin-bottom: var(--spacing-6);\n          gap: var(--spacing-2);\n        }\n\n        .message-wrapper--assistant {\n          justify-content: flex-start;\n        }\n\n        .message-wrapper--user {\n          justify-content: flex-end;\n        }\n\n        .assistant-icon {\n          width: 30px;\n          height: 20px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          margin-right: var(--spacing-2);\n        }\n\n        .message {\n          max-width: 80%;\n          padding: var(--spacing-4);\n          border-radius: 20px;\n          word-wrap: break-word;\n          background-color: ${\n            isAssistant ? \"#FFFFFF\" : \"rgba(255, 255, 255, 0.1)\"\n          };\n          color: ${isAssistant ? \"#231F25\" : \"#FFFFFF\"};\n          border: ${isAssistant ? \"none\" : \"1px solid #FFFFFF\"};\n        }\n\n        .message--assistant {\n          background-color: #FFFFFF;\n          color: #231F25 !important;\n          border-bottom-left-radius: 4px;\n        }\n\n        .message--user {\n          background-color: rgba(255, 255, 255, 0.1);\n          border: 1px solid #FFFFFF;\n          color: white;\n        }\n\n        .message__content {\n          display: flex;\n          flex-direction: column;\n          gap: 1em;\n          flex-grow: 1;\n          font-family: inherit;\n        }\n      </style>\n      <div class=\"message-wrapper message-wrapper--${sender}\">\n        ${isAssistant ? `<div class=\"assistant-icon\">ðŸš€</div>` : \"\"}\n        <div class=\"message message--${sender}\">\n          <div class=\"message__content\">${this.markdownToHtml(content)}</div>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Converts markdown to HTML.\n   * For simplicity, using basic line breaks. Integrate a markdown library if needed.\n   * @param {string} markdown - The markdown content\n   * @returns {string} - HTML content\n   */\n  markdownToHtml(markdown) {\n    if (!markdown) return \"\";\n    return markdown.replace(/\\n/g, \"<br>\");\n  }\n}\n","// /assets/scripts/chatbot/components/carousel-component.js\n\nimport eventBus from \"../../utils/event-bus.js\";\n\n/**\n * CarouselComponent Class\n * Renders a carousel of cards with images, titles, descriptions, and action buttons.\n */\nexport class CarouselComponent extends HTMLElement {\n  constructor() {\n    super();\n    // Attach Shadow DOM to encapsulate styles and markup\n    this.attachShadow({ mode: \"open\" });\n\n    // Initialize properties\n    this.items = []; // To store carousel items\n    this.currentIndex = 0; // Current slide index\n    this.isDesktop = window.matchMedia(\"(min-width: 1000px)\").matches;\n    this.itemsPerSlide = this.isDesktop ? 2 : 1;\n\n    // Bind methods to maintain context\n    this.moveLeft = this.moveLeft.bind(this);\n    this.moveRight = this.moveRight.bind(this);\n    this.handleResize = this.handleResize.bind(this);\n    this.handleButtonClick = this.handleButtonClick.bind(this);\n  }\n\n  /**\n   * Lifecycle method called when the component is added to the DOM.\n   */\n  connectedCallback() {\n    const dataAttr = this.getAttribute(\"data-carousel\");\n    if (!dataAttr) {\n      console.error(\n        \"No data-carousel attribute found. Cannot render carousel.\"\n      );\n      return;\n    }\n\n    let carouselData;\n    try {\n      carouselData = JSON.parse(dataAttr);\n    } catch (err) {\n      console.error(\"Failed to parse carousel data:\", err);\n      return;\n    }\n\n    // Ensure carouselData.cards is an array\n    if (!carouselData || !Array.isArray(carouselData.cards)) {\n      console.error(\"carouselData.cards is not defined or not an array\");\n      return;\n    }\n\n    this.renderCarousel(carouselData);\n  }\n\n  /**\n   * Renders the carousel with embedded styles and initializes functionality.\n   * @param {Object} carouselData - Data for the carousel containing a 'cards' array.\n   */\n  renderCarousel(carouselData) {\n    this.carouselData = carouselData;\n    this.shadowRoot.innerHTML = `\n      <style>\n        /* Custom Carousel Styling */\n\n        h6 {\n            font-family: var(--heading-font-family);\n            font-weight: var(--heading-font-weight);\n            font-style: var(--heading-font-style);\n            letter-spacing: var(--heading-letter-spacing);\n            text-transform: var(--heading-text-transform);\n            overflow-wrap: anywhere;\n            font-size: var(--text-sm);\n        }\n\n        .button {\n          --button-background: var(--button-background-primary) /\n            var(--button-background-opacity, 1);\n          --button-text-color: var(--button-text-primary);\n          --button-outline-color: white;\n          -webkit-appearance: none;\n          appearance: none;\n          border-color: white;\n          border-radius: 8px;\n          border-width: 1px;\n          background-color: rgb(var(--button-background));\n          color: rgb(var(--button-text-color));\n          text-align: center;\n          font-size: var(--text-h6);\n          letter-spacing: var(--text-letter-spacing);\n          padding-block-start: var(--spacing-2-5);\n          padding-block-end: var(--spacing-2-5);\n          padding-inline-start: var(--spacing-5);\n          padding-inline-end: var(--spacing-5);\n          font-weight: bold;\n          line-height: 1.6;\n          transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out,\n            box-shadow 0.15s ease-in-out;\n          display: inline-block;\n          position: relative;\n        }\n\n        .carousel {\n          position: relative;\n          width: 100%;\n          overflow: hidden;\n          margin-bottom: var(--spacing-4);\n          box-sizing: border-box;\n        }\n\n        .carousel__container {\n          display: flex;\n          transition: transform 0.3s ease-out;\n          max-width: 100%;\n        }\n\n        .carousel__item {\n          flex: 0 0 100%;\n          display: flex;\n          gap: var(--spacing-4);\n          box-sizing: border-box;\n          max-width: 100%;\n          align-items: flex-start;\n        }\n\n        .carousel__item-wrapper {\n          flex: 0 0 100%;\n          max-width: 100%;\n          min-width: 0;\n        }\n\n        .carousel__button {\n          position: absolute;\n          top: 50%;\n          transform: translateY(-50%);\n          background: rgba(255, 255, 255, 0.8);\n          border: solid 1px #403545;\n          width: 40px;\n          height: 40px;\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          cursor: pointer;\n          z-index: 2;\n          margin-block-start: var(--spacing-0) !important;\n        }\n\n        .carousel__button--left {\n          left: 10px;\n        }\n\n        .carousel__button--right {\n          right: 10px;\n        }\n\n        .carousel__item-button {\n        font-size: var(--text-sm);\n        }\n\n        .carousel__item-content {\n          background: #FFFFFF;\n          border-radius: 8px;\n          padding: var(--spacing-4);\n          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n          height: 100%;\n          display: flex;\n          flex-direction: column;\n        }\n\n        .carousel__item-image {\n          width: 100%;\n          height: auto;\n          border-radius: 8px;\n          margin-bottom: var(--spacing-2);\n          object-fit: cover;\n        }\n\n        .carousel__item-title {\n          font-weight: bold;\n          margin-bottom: var(--spacing-0);\n          margin-top: var(--spacing-0);\n          font-size: var(--text-base);\n        }\n\n        .carousel__item-description {\n          margin-bottom: var(--spacing-4);\n          margin-top: var(--spacing-0);\n          font-size: var(--text-sm);\n          color: #403545 !important;\n          flex-grow: 1;\n        }\n\n        @media (min-width: 1000px) {\n          .carousel__item {\n            flex: 0 0 50%;\n            max-width: 50%;\n          }\n\n          .carousel__item-wrapper {\n            flex: 0 0 calc(100% - var(--spacing-2));\n            max-width: calc(100% - var(--spacing-2));\n          }\n        }\n      </style>\n      <div class=\"carousel\">\n        <div class=\"carousel__container\">\n          <!-- Carousel items will be dynamically added here -->\n        </div>\n        <button class=\"carousel__button carousel__button--left\" aria-label=\"Previous slide\">\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n               xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M15 18L9 12L15 6\" stroke=\"currentColor\" stroke-width=\"2\"\n                  stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        </button>\n        <button class=\"carousel__button carousel__button--right\" aria-label=\"Next slide\">\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n               xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M9 18L15 12L9 6\" stroke=\"currentColor\" stroke-width=\"2\"\n                  stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        </button>\n      </div>\n    `;\n\n    // Reference to carousel container and navigation buttons\n    this.carouselContainer = this.shadowRoot.querySelector(\n      \".carousel__container\"\n    );\n    this.leftButton = this.shadowRoot.querySelector(\".carousel__button--left\");\n    this.rightButton = this.shadowRoot.querySelector(\n      \".carousel__button--right\"\n    );\n\n    // Add carousel items\n    this.carouselData.cards.forEach((card, index) => {\n      const item = document.createElement(\"div\");\n      item.classList.add(\"carousel__item\");\n\n      const itemWrapper = document.createElement(\"div\");\n      itemWrapper.classList.add(\"carousel__item-wrapper\");\n\n      const itemContent = document.createElement(\"div\");\n      itemContent.classList.add(\"carousel__item-content\");\n\n      // Image\n      if (card.imageUrl) {\n        const img = document.createElement(\"img\");\n        img.src = card.imageUrl;\n        img.alt = card.title || \"\";\n        img.classList.add(\"carousel__item-image\");\n        itemContent.appendChild(img);\n      }\n\n      // Title\n      if (card.title) {\n        const title = document.createElement(\"h6\");\n        title.classList.add(\"carousel__item-title\");\n        title.textContent = card.title;\n        itemContent.appendChild(title);\n      }\n\n      // Description\n      if (card.description && card.description.text) {\n        const description = document.createElement(\"p\");\n        description.classList.add(\"carousel__item-description\");\n        description.textContent = card.description.text;\n        itemContent.appendChild(description);\n      }\n\n      // Button\n      if (card.buttons && card.buttons.length > 0) {\n        const buttonData = card.buttons[0];\n        const button = document.createElement(\"button\");\n        button.classList.add(\"button\", \"carousel__item-button\");\n        button.setAttribute(\"data-button-index\", index);\n        button.setAttribute(\n          \"data-button-payload\",\n          JSON.stringify(buttonData.request)\n        );\n        button.setAttribute(\"data-button-text\", buttonData.name);\n        button.textContent = buttonData.name || \"Select\";\n        itemContent.appendChild(button);\n\n        // Add event listener for button click\n        button.addEventListener(\"click\", this.handleButtonClick);\n      }\n\n      // Assemble the item structure\n      itemWrapper.appendChild(itemContent);\n      item.appendChild(itemWrapper);\n      this.carouselContainer.appendChild(item);\n      this.items.push(item);\n    });\n\n    // Initialize Carousel Functionality\n    this.initCarousel();\n\n    // Add event listeners to navigation buttons\n    this.leftButton.addEventListener(\"click\", this.moveLeft);\n    this.rightButton.addEventListener(\"click\", this.moveRight);\n\n    // Add event listener for window resize to adjust carousel\n    window.addEventListener(\"resize\", this.handleResize);\n\n    this.updateVisibility();\n    this.updatePosition();\n  }\n\n  /**\n   * Initializes carousel settings based on screen size.\n   */\n  initCarousel() {\n    this.isDesktop = window.matchMedia(\"(min-width: 1000px)\").matches;\n    this.itemsPerSlide = this.isDesktop ? 2 : 1;\n    this.currentIndex = 0;\n    this.updateVisibility();\n    this.updatePosition();\n  }\n\n  /**\n   * Handles window resize events to adjust carousel settings.\n   */\n  handleResize() {\n    this.isDesktop = window.matchMedia(\"(min-width: 1000px)\").matches;\n    this.itemsPerSlide = this.isDesktop ? 2 : 1;\n    this.currentIndex = 0;\n    this.updatePosition();\n    this.updateVisibility();\n  }\n\n  /**\n   * Moves the carousel to the left.\n   */\n  moveLeft() {\n    const itemsPerSlide = this.itemsPerSlide;\n    this.currentIndex = Math.max(0, this.currentIndex - itemsPerSlide);\n    this.updatePosition();\n    this.updateVisibility();\n  }\n\n  /**\n   * Moves the carousel to the right.\n   */\n  moveRight() {\n    const itemsPerSlide = this.itemsPerSlide;\n    this.currentIndex = Math.min(\n      this.items.length - itemsPerSlide,\n      this.currentIndex + itemsPerSlide\n    );\n    this.updatePosition();\n    this.updateVisibility();\n  }\n\n  /**\n   * Updates the carousel's position based on the current index.\n   */\n  updatePosition() {\n    const itemsPerSlide = this.itemsPerSlide;\n    const offset = -(this.currentIndex / itemsPerSlide) * 100;\n    this.carouselContainer.style.transform = `translateX(${offset}%)`;\n  }\n\n  /**\n   * Updates the visibility of navigation buttons based on the current index.\n   */\n  updateVisibility() {\n    const itemsPerSlide = this.itemsPerSlide;\n    this.leftButton.disabled = this.currentIndex === 0;\n    this.rightButton.disabled =\n      this.currentIndex >= this.items.length - itemsPerSlide;\n  }\n\n  /**\n   * Handles button clicks within carousel items.\n   * @param {Event} e - The click event\n   */\n  handleButtonClick(e) {\n    const button = e.target;\n    const buttonIndex = parseInt(button.getAttribute(\"data-button-index\"), 10);\n    const card = this.carouselData.cards[buttonIndex];\n\n    if (!card || !card.buttons || card.buttons.length === 0) {\n      console.warn(\"No button data found for this card.\");\n      return;\n    }\n\n    const buttonData = card.buttons[0];\n    console.log(\"Original button data:\", buttonData);\n\n    // Access the title from the payload\n    const productTitle = buttonData.request.payload.title;\n    const displayLabel = productTitle\n      ? `Selected ${productTitle}`\n      : \"Selected Power Station\";\n\n    eventBus.emit(\"carouselButtonClicked\", {\n      action: buttonData.request, // Keep the original request structure\n      label: displayLabel, // Use our new descriptive label with fallback\n    });\n\n    // Remove the carousel after interaction\n    this.remove();\n  }\n}\n","// frontend/components/ui/chatbot-components.js\nimport { ButtonComponent } from \"./button-component.js\";\nimport { MessageComponent } from \"./message-component.js\";\nimport { CarouselComponent } from \"./carousel-component.js\";\n\n// Register custom components\ncustomElements.define(\"button-component\", ButtonComponent);\ncustomElements.define(\"message-component\", MessageComponent);\ncustomElements.define(\"carousel-component\", CarouselComponent);\n"],"names":["EventBus","EventEmitter","eventBus","EVENTS","ChatbotCore","userID","endpoint","chatbotType","variables","payload","message","actionPayload","signal","response","reader","decoder","buffer","done","value","events","eventStr","lines","eventTypeLine","line","dataLine","eventType","data","error","trace","MainChatbotUI","container","button","label","_a","sender","content","metadata","isHistory","buttons","buttonData","carouselItems","carouselData","carousel","type","interactiveState","savedState","state","errorDiv","element","generateUserId","prefix","uniquePart","MainChatbot","core","ui","sanitizedMessage","history","historyEntry","entry","index","input","div","mainChatbotContainer","mainUserId","mainChatbotCore","mainChatbotUI","SectionChatbotUI","e","buttonsContainer","items","attrName","SectionChatbot","missingFields","field","interactPayload","details","acc","key","sectionChatbotContainer","sectionUserId","sectionChatbotCore","sectionChatbotUI","sectionChatbot","sectionInput","ButtonComponent","parsedPayload","MessageComponent","isAssistant","markdown","CarouselComponent","dataAttr","err","card","item","itemWrapper","itemContent","img","title","description","itemsPerSlide","offset","buttonIndex","productTitle","displayLabel"],"mappings":"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"}