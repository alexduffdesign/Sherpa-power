import{C as r}from"./chatbot-base.Bk8b2nYJ.js";import{H as h}from"./chatbot-history.PsHLWNuA.js";import"./chatbot-api.BmWGMfIO.js";import"./chatbot-ui.YIUijLAA.js";import"./chatbot-stream.2Ew4cAx-.js";import"./chatbot-trace.BEMxCePC.js";class b extends r{constructor(t,e){console.log("MainChatbot constructor called with config:",e),super(e),this.element=t,this.history=new h,this.history.hasHistory()&&(this.history.loadFromStorage(),this.displaySavedConversation()),this.initializeElements(),this.setupEventListeners()}initializeElements(){this.messageContainer=this.element.querySelector(".message-container"),this.typingIndicator=this.element.querySelector(".typing-indicator"),this.drawerBody=this.element.querySelector(".drawer-body"),this.chatInput=this.element.querySelector(".chat-input"),this.sendButton=this.element.querySelector(".send-button"),this.backToStartButton=this.element.querySelector(".back-to-start-button"),this.setDOMElements(this.messageContainer,this.typingIndicator,this.drawerBody)}setupEventListeners(){if(this.chatInput&&this.sendButton){const t=this.chatInput.closest("form");t&&t.addEventListener("submit",e=>{e.preventDefault(),this.handleUserInput()}),this.chatInput.addEventListener("keypress",e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),this.handleUserInput())}),this.sendButton.addEventListener("click",e=>{e.preventDefault(),this.handleUserInput()})}this.backToStartButton&&this.backToStartButton.addEventListener("click",()=>{this.jumpToMainMenu()}),this.messageContainer&&this.messageContainer.addEventListener("click",async t=>{const e=t.target.closest(".chat-button");if(e){const s=JSON.parse(e.dataset.buttonData);await this.handleButtonClick(s)}})}async handleUserInput(){const t=this.chatInput.value.trim();if(t){this.chatInput.value="",this.chatInput.disabled=!0;try{this.ui.addMessage("user",t),this.history.updateHistory({type:"user",message:t}),await this.sendMessage(t)}catch(e){console.error("Error sending message:",e),this.ui.addMessage("assistant","Sorry, there was an error sending your message. Please try again.")}finally{this.chatInput.disabled=!1,this.chatInput.focus()}}}async handleSpecialTrace(t){var e,s,a,i,o;switch(console.log("Main chatbot handling special trace:",t),t.type){case"text":(e=t.payload)!=null&&e.message&&this.history.updateHistory({type:"assistant",message:t.payload.message});break;case"choice":(s=t.payload)!=null&&s.buttons&&this.history.updateHistory({type:"choice",buttons:t.payload.buttons});break;case"carousel":t.payload&&this.history.updateHistory({type:"carousel",data:t.payload});break;case"visual":((a=t.payload)==null?void 0:a.visualType)==="image"&&this.history.updateHistory({type:"visual",data:t.payload});break;case"RedirectToProduct":const n=(o=(i=t.payload)==null?void 0:i.body)==null?void 0:o.productHandle;n&&this.handleProductRedirect(n);break}}async jumpToMainMenu(){console.log("MainChatbot jumpToMainMenu called"),this.history.clearHistory(),this.messageContainer.innerHTML="",await this.sendMessage("start")}handleProductRedirect(t){t&&(window.location.href=`/products/${t}`)}displaySavedConversation(){this.history.getHistory().forEach(e=>{switch(e.type){case"user":case"assistant":this.ui.addMessage(e.type,e.message);break;case"choice":this.ui.addButtons(e.buttons);break;case"carousel":this.ui.addCarousel(e.data);break;case"visual":this.ui.addVisualImage(e.data);break}})}}console.log("MainChatbot module loaded");export{b as M};
//# sourceMappingURL=chatbot-main.C0L9ZE4q.js.map
