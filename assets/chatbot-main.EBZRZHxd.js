import{B as r,g as n}from"./base-chatbot.5yo_lTNg.js";import{M as c}from"./chatbot-main-ui.BDU8vwN8.js";import{M as o}from"./event-bus.CuQuEjt-.js";import"./vendor.DqvJXvYX.js";import"./base-chatbot-ui.VFY9Qhos.js";class h extends r{constructor(){super(),this.historyKey="mainChatbotHistory",this.launchKey="chatHasLaunched",this.isLaunched=this.hasLaunched()}connectedCallback(){super.connectedCallback();let t=localStorage.getItem("mainChatbotUserId");t||(t=n("mainChatbot"),localStorage.setItem("mainChatbotUserId",t)),this.userID=t,this.loadHistory()}initializeUI(){this.ui=new c(this.shadowRoot,this.eventBus),this.setupMainChatbotEventListeners(),this.loadHistory()}setupMainChatbotEventListeners(){this.eventBus.on(o.BUTTON_CLICK,t=>{this.sendAction(t)}),this.eventBus.on(o.CAROUSEL_BUTTON_CLICK,t=>{this.sendAction(t)}),this.eventBus.on("userMessage",t=>{this.saveToHistory("user",t),this.sendMessage(t)}),this.eventBus.on("messageReceived",({content:t,metadata:e})=>{this.saveToHistory("assistant",t,e)})}hasLaunched(){return localStorage.getItem(this.launchKey)==="true"}setLaunched(){localStorage.setItem(this.launchKey,"true"),this.isLaunched=!0}saveToHistory(t,e,s=null){const i=JSON.parse(localStorage.getItem(this.historyKey))||[],a={sender:t,message:e,timestamp:Date.now(),isInteractive:!1};t==="assistant"&&s&&(s.type==="choice"?(a.isInteractive=!0,a.traceType="choice",a.traceData={buttons:s.buttons}):s.type==="carousel"&&(a.isInteractive=!0,a.traceType="carousel",a.traceData={cards:s.carouselItems})),i.push(a),localStorage.setItem(this.historyKey,JSON.stringify(i))}loadHistory(){const t=JSON.parse(localStorage.getItem(this.historyKey))||[];t.forEach((e,s)=>{if(e.isInteractive){s===t.length-1&&this.restoreInteractiveElement(e);return}e.message&&this.ui.addMessage(e.sender,e.message)})}restoreInteractiveElement(t){t.traceType==="choice"?this.ui.addButtons(t.traceData.buttons,!0):t.traceType==="carousel"&&this.ui.addCarousel(t.traceData.cards,!0)}clearHistory(){localStorage.removeItem(this.historyKey),localStorage.removeItem(this.launchKey),this.isLaunched=!1}sanitizeInput(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}customElements.define("main-chatbot",h);
//# sourceMappingURL=chatbot-main.EBZRZHxd.js.map
