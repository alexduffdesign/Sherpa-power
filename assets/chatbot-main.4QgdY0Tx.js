import{g as h,B as u}from"./base-chatbot.CihohfVD.js";import{M as r}from"./chatbot-main-ui.BDU8vwN8.js";import{M as n}from"./event-bus.CuQuEjt-.js";import"./vendor.DqvJXvYX.js";import"./base-chatbot-ui.VFY9Qhos.js";class c extends u{constructor(){super(),this.historyKey="mainChatbotHistory",this.launchKey="chatHasLaunched",this.isLaunched=this.hasLaunched()}initializeUI(){this.ui=new r(this.shadowRoot,this.eventBus),this.setupMainChatbotEventListeners(),this.loadHistory()}setupMainChatbotEventListeners(){this.eventBus.on(n.BUTTON_CLICK,t=>{this.sendAction(t)}),this.eventBus.on(n.CAROUSEL_BUTTON_CLICK,t=>{this.sendAction(t)}),this.eventBus.on("userMessage",t=>{this.saveToHistory("user",t),this.sendMessage(t)}),this.eventBus.on("messageReceived",({content:t,metadata:e})=>{this.saveToHistory("assistant",t,e)})}hasLaunched(){return localStorage.getItem(this.launchKey)==="true"}setLaunched(){localStorage.setItem(this.launchKey,"true"),this.isLaunched=!0}saveToHistory(t,e,s=null){const i=JSON.parse(localStorage.getItem(this.historyKey))||[],a={sender:t,message:e,timestamp:Date.now(),isInteractive:!1};t==="assistant"&&s&&(s.type==="choice"?(a.isInteractive=!0,a.traceType="choice",a.traceData={buttons:s.buttons}):s.type==="carousel"&&(a.isInteractive=!0,a.traceType="carousel",a.traceData={cards:s.carouselItems})),i.push(a),localStorage.setItem(this.historyKey,JSON.stringify(i))}loadHistory(){const t=JSON.parse(localStorage.getItem(this.historyKey))||[];t.forEach((e,s)=>{if(e.isInteractive){s===t.length-1&&this.restoreInteractiveElement(e);return}e.message&&this.ui.addMessage(e.sender,e.message)})}restoreInteractiveElement(t){t.traceType==="choice"?this.ui.addButtons(t.traceData.buttons,!0):t.traceType==="carousel"&&this.ui.addCarousel(t.traceData.cards,!0)}clearHistory(){localStorage.removeItem(this.historyKey),localStorage.removeItem(this.launchKey),this.isLaunched=!1}sanitizeInput(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}document.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("main-chatbot-ui");if(!o){console.error("Main Chatbot UI container not found");return}let t=localStorage.getItem("mainChatbotUserId");t||(t=h("mainChatbot"),localStorage.setItem("mainChatbotUserId",t));const e=new ChatbotCore({userID:t,endpoint:"https://chatbottings--development.gadget.app/voiceflowAPI/voiceflow-streaming",chatbotType:"main"}),s=new r(o);new c(e,s).loadHistory()});console.log("Main chatbot script loading...");customElements.define("main-chatbot",c);console.log("Main chatbot component registered");
//# sourceMappingURL=chatbot-main.4QgdY0Tx.js.map
