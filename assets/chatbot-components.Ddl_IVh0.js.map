{"version":3,"file":"chatbot-components.Ddl_IVh0.js","sources":["../frontend/utils/animation-util.js","../frontend/components/ui/button-component.js","../frontend/components/ui/message-component.js","../frontend/components/ui/carousel-component.js","../frontend/components/ui/chatbot-components.js"],"sourcesContent":["export function animateText(element, text, animationSpeed = 2) {\n  return new Promise((resolve) => {\n    let index = 0;\n    element.textContent = \"\"; // Clear existing content\n    let lastTime = performance.now();\n\n    const animate = (currentTime) => {\n      const deltaTime = currentTime - lastTime;\n      if (deltaTime >= animationSpeed) {\n        if (index < text.length) {\n          element.textContent += text[index];\n          index++;\n          lastTime = currentTime;\n        }\n      }\n      if (index < text.length) {\n        requestAnimationFrame(animate);\n      } else {\n        resolve();\n      }\n    };\n    requestAnimationFrame(animate);\n  });\n}\n\nexport async function animateHTMLContent(container, htmlContent, speed = 2) {\n  // Create a temporary container to parse HTML\n  const temp = document.createElement(\"div\");\n  temp.innerHTML = htmlContent;\n\n  // Clear the target container\n  container.innerHTML = \"\";\n\n  // Animate each element sequentially\n  for (const node of temp.childNodes) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      // Only create a span for non-empty text nodes\n      if (node.textContent.trim()) {\n        const span = document.createElement(\"span\");\n        container.appendChild(span);\n        await animateText(span, node.textContent, speed);\n      }\n    } else if (node.nodeType === Node.ELEMENT_NODE) {\n      // Clone the element without its content\n      const el = node.cloneNode(false);\n      container.appendChild(el);\n      // Animate its content\n      await animateHTMLContent(el, node.innerHTML, speed);\n    }\n  }\n}\n","// /assets/scripts/chatbot/components/button-component.js\n\nexport class ButtonComponent extends HTMLElement {\n  constructor() {\n    super();\n    this.attachShadow({ mode: \"open\" });\n    this._eventBus = null; // Will be set via setter\n  }\n\n  set eventBus(bus) {\n    this._eventBus = bus;\n  }\n\n  connectedCallback() {\n    const label = this.getAttribute(\"label\");\n    const payload = this.getAttribute(\"payload\");\n    this.render(label, payload);\n  }\n\n  /**\n   * Renders the button with embedded styles.\n   * @param {string} label - The button label\n   * @param {string} payload - The button payload in JSON string format\n   */\n  render(label, payload) {\n    this.shadowRoot.innerHTML = `\n      <style>\n        .button {\n          padding: var(--spacing-3);\n          background-color: #FFFFFF;\n          border: none;\n          border-radius: var(--rounded);\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 14px;\n          transition: background-color 0.3s ease;\n        }\n\n        .button:hover {\n          background-color: #f0f0f0;\n        }\n      </style>\n      <button class=\"button\" data-button-data='${payload}' aria-label=\"${label}\">${label}</button>\n    `;\n\n    this.shadowRoot.querySelector(\".button\").addEventListener(\"click\", () => {\n      if (!this._eventBus) {\n        console.error(\"No eventBus assigned to ButtonComponent\");\n        return;\n      }\n\n      try {\n        const parsedPayload = JSON.parse(payload);\n        this._eventBus.emit(\"buttonClicked\", {\n          action: parsedPayload,\n          label: label,\n        });\n      } catch (error) {\n        console.error(\"Error parsing button payload:\", error);\n      }\n    });\n  }\n}\n","// /assets/scripts/chatbot/components/message-component.js\n\nimport { parseMarkdown } from \"../../utils/markdown-util.js\";\nimport { animateHTMLContent } from \"../../utils/animation-util.js\";\nimport { StreamingMarkdownParser } from \"../../utils/streaming-markdown-parser.js\";\n\nexport class MessageComponent extends HTMLElement {\n  constructor() {\n    super();\n    this.attachShadow({ mode: \"open\" });\n    this.isStreaming = false;\n    this.animationFrameId = null; // For character-by-character animation\n    this.defaultAnimationSpeed = 5; // ms per character\n    this.currentAnimationSpeed = this.defaultAnimationSpeed;\n    this.streamingParser = null;\n    this.contentInitialized = false; // Add this flag\n  }\n\n  connectedCallback() {\n    // Only initialize content once\n    if (this.contentInitialized) {\n      return;\n    }\n\n    const sender = this.getAttribute(\"sender\");\n    const content = this.getAttribute(\"content\") || \"\";\n    this.isStreaming = this.hasAttribute(\"streaming\");\n    const animate = this.getAttribute(\"data-animate\") !== \"false\";\n    this.currentAnimationSpeed = parseInt(\n      this.getAttribute(\"data-animation-speed\") || this.defaultAnimationSpeed,\n      5\n    );\n\n    this.render(sender, content);\n\n    const messageContent = this.shadowRoot.querySelector(\".message__content\");\n    if (!messageContent) return;\n\n    if (!this.isStreaming && content) {\n      const isHTML = /<[a-z][\\s\\S]*>/i.test(content);\n\n      if (isHTML) {\n        // Normalize the HTML content\n        const normalizedContent = content\n          .replace(/>\\s+</g, \"><\") // Remove whitespace between tags\n          .replace(/\\n\\s*/g, \"\") // Remove newlines and following spaces\n          .trim();\n\n        if (animate) {\n          animateHTMLContent(\n            messageContent,\n            normalizedContent,\n            this.currentAnimationSpeed\n          );\n        } else {\n          messageContent.innerHTML = normalizedContent;\n        }\n      } else {\n        // Content is markdown, parse it\n        this.streamingParser = new StreamingMarkdownParser((htmlSegment) => {\n          if (!this.tempContent) this.tempContent = \"\";\n          this.tempContent += htmlSegment;\n        });\n\n        this.streamingParser.appendText(content);\n        this.streamingParser.end();\n\n        if (animate) {\n          animateHTMLContent(\n            messageContent,\n            this.tempContent,\n            this.currentAnimationSpeed\n          );\n        } else {\n          messageContent.innerHTML = this.tempContent;\n        }\n      }\n\n      this.scrollToBottom();\n    } else if (this.isStreaming) {\n      this.streamingParser = new StreamingMarkdownParser((htmlSegment) => {\n        // Normalize streaming segments too\n        const normalizedSegment = htmlSegment\n          .replace(/>\\s+</g, \"><\")\n          .replace(/\\n\\s*/g, \"\")\n          .trim();\n        this.appendHTMLContent(normalizedSegment);\n      });\n      this.streamingParser.appendText(content);\n    }\n\n    this.contentInitialized = true; // Mark content as initialized\n  }\n\n  /**\n   * Append new content for streamed messages.\n   * @param {string} newChunk - The new chunk of content.\n   */\n  appendContent(newChunk) {\n    console.log(\"appendContent:\", newChunk);\n    if (this.streamingParser) {\n      this.streamingParser.appendText(newChunk);\n    } else {\n      // Fallback to simple markdown parsing if parser isn't initialized\n      const html = parseMarkdown(newChunk);\n      this.appendHTMLContent(html);\n    }\n  }\n\n  /**\n   * Append HTML content directly to the message.\n   * @param {string} htmlSegment - The HTML segment to append.\n   */\n  appendHTMLContent(htmlSegment) {\n    const messageContent = this.shadowRoot.querySelector(\".message__content\");\n    if (messageContent) {\n      const tempDiv = document.createElement(\"div\");\n      tempDiv.innerHTML = htmlSegment;\n\n      // Normalize any text nodes to remove extra whitespace\n      const normalizeNode = (node) => {\n        if (node.nodeType === 3) {\n          // Text node\n          node.textContent = node.textContent.replace(/\\s+/g, \" \").trim();\n        }\n        node.childNodes.forEach(normalizeNode);\n      };\n\n      normalizeNode(tempDiv);\n\n      while (tempDiv.firstChild) {\n        messageContent.appendChild(tempDiv.firstChild);\n      }\n      this.scrollToBottom();\n    }\n  }\n\n  /**\n   * Finalizes the content of a streamed message by parsing remaining markdown and updating the UI.\n   */\n  finalizeContentAndAnimate() {\n    console.log(\"finalizeContentAndAnimate called\");\n    if (this.streamingParser) {\n      this.streamingParser.end();\n      this.streamingParser = null;\n    }\n  }\n\n  render(sender, content) {\n    const isAssistant = sender === \"assistant\";\n    this.shadowRoot.innerHTML = `\n      <style>\n        h1, h2, h3, h4, h5, h6 {\n          font-family: var(--heading-font-family);\n          font-weight: var(--heading-font-weight);\n        }\n        :host {\n          display: block;\n          width: 100%;\n        }\n        p {\n          margin-top: var(--spacing-1);\n          margin-bottom: var(--spacing-1);\n        }\n        \n        .message-wrapper {\n          display: flex;\n          align-items: flex-end;\n          width: 100%;\n          margin-bottom: var(--spacing-6);\n          gap: var(--spacing-2);\n        }\n\n        .message-wrapper--assistant {\n          justify-content: flex-start;\n        }\n\n        .message-wrapper--user {\n          justify-content: flex-end;\n        }\n\n        .assistant-icon {\n          width: 30px;\n          height: 30px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 1.2em;\n          line-height: 1;\n        }\n\n        .message {\n          display: flex;\n          max-width: 80%;\n          padding: var(--spacing-4);\n          border-radius: 20px;\n          word-wrap: break-word;\n          background-color: ${\n            isAssistant ? \"#FFFFFF\" : \"rgba(255, 255, 255, 0.1)\"\n          };\n          color: ${isAssistant ? \"#231F25\" : \"#FFFFFF\"};\n          border: ${isAssistant ? \"none\" : \"1px solid #FFFFFF\"};\n          overflow: hidden;\n          font-family: inherit;\n          position: relative;\n          opacity: 1;\n          transition: opacity 0.3s ease-in-out;\n          white-space: pre-wrap; /* Preserve newlines and spaces */\n        }\n\n        .message.fade-out {\n          opacity: 0;\n        }\n\n        .message__content.fade-in {\n          animation: fadeIn 0.5s ease-in-out;\n        }\n\n        @keyframes fadeIn {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n\n        .message--assistant {\n          background-color: #FFFFFF;\n          color: #231F25 !important;\n          border-bottom-left-radius: 4px;\n        }\n\n        .message--user {\n          background-color: rgba(255, 255, 255, 0.1);\n          border: 1px solid #FFFFFF;\n          color: white;\n        }\n\n        .message__content {\n          display: flex;\n          flex-direction: column;\n          grid-gap: 0.2rem;\n          font-family: inherit;\n          word-break: break-word;\n        }\n\n        /* Markdown styling */\n        .message__content h1,\n        .message__content h2,\n        .message__content h3,\n        .message__content h4,\n        .message__content h5,\n        .message__content h6 {\n          margin: 1em 0 0.5em 0;\n          line-height: 1.2;\n        }\n\n        .message__content h1:first-child,\n        .message__content h2:first-child,\n        .message__content h3:first-child,\n        .message__content h4:first-child,\n        .message__content h5:first-child,\n        .message__content h6:first-child {\n          margin-top: 0;\n        }\n\n        .message__content h1 { font-size: 1.6em; }\n        .message__content h2 { font-size: 1.4em; }\n        .message__content h3 { font-size: 1.2em; }\n        .message__content h4 { font-size: 1.1em; }\n        .message__content h5 { font-size: 1em; }\n        .message__content h6 { font-size: 0.9em; }\n\n        .message__content a {\n          color: #0066cc;\n          text-decoration: none;\n        }\n\n        .message__content a:hover {\n          text-decoration: underline;\n        }\n\n        .message__content p {\n          margin: 0.5em 0;\n          line-height: 1.4;\n        }\n\n        .message__content ul,\n        .message__content ol {\n          margin: 0.5em 0;\n          padding-left: 2em;\n        }\n\n        .message__content li {\n          margin: 0.25em 0;\n          line-height: 1.4;\n        }\n\n        .message__content code {\n          background-color: rgba(0, 0, 0, 0.05);\n          padding: 0.2em 0.4em;\n          border-radius: 3px;\n          font-family: monospace;\n        }\n\n        .message__content pre {\n          background-color: rgba(0, 0, 0, 0.05);\n          padding: 1em;\n          border-radius: 4px;\n          overflow-x: auto;\n          margin: 0.5em 0;\n        }\n\n        .message__content pre code {\n          background-color: transparent;\n          padding: 0;\n          border-radius: 0;\n        }\n\n        .message__content blockquote {\n          margin: 0.5em 0;\n          padding-left: 1em;\n          border-left: 4px solid rgba(0, 0, 0, 0.1);\n          color: rgba(0, 0, 0, 0.7);\n        }\n\n        .message__content img {\n          max-width: 100%;\n          height: auto;\n        }\n\n        .message__content table {\n          border-collapse: collapse;\n          margin: 0.5em 0;\n          width: 100%;\n        }\n\n        .message__content th,\n        .message__content td {\n          border: 1px solid rgba(0, 0, 0, 0.1);\n          padding: 0.4em 0.8em;\n          text-align: left;\n        }\n\n        .message__content th {\n          background-color: rgba(0, 0, 0, 0.05);\n        }\n\n        .message__content ul li:first-child,\n        .message__content ol li:first-child {\n          margin-top: 0;\n        }\n\n        .message__content ul li:last-child,\n        .message__content ol li:last-child {\n          margin-bottom: 0;\n        }\n\n        .message__content p + ul,\n        .message__content p + ol {\n          margin-top: 0.25em;\n        }\n\n        .message__content ul + p,\n        .message__content ol + p {\n          margin-top: 0.25em;\n        }\n      </style>\n      <div class=\"message-wrapper message-wrapper--${sender}\">\n        ${\n          isAssistant\n            ? `<img class=\"assistant-icon\" src=\"https://cdn.shopify.com/s/files/1/0641/4290/1439/files/sherpa-icon.svg?v=1736167714\">`\n            : \"\"\n        }\n        <div class=\"message message--${sender}\">\n          <div class=\"message__content\"></div>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Scroll the message container to the bottom.\n   * @private\n   */\n  scrollToBottom() {\n    if (this.parentElement) {\n      this.parentElement.scrollTop = this.parentElement.scrollHeight;\n    }\n  }\n\n  /**\n   * Clean up any ongoing animations when the component is disconnected.\n   */\n  disconnectedCallback() {\n    if (this.animationFrameId) {\n      cancelAnimationFrame(this.animationFrameId);\n    }\n    if (this.streamingParser) {\n      this.streamingParser.end();\n      this.streamingParser = null;\n    }\n  }\n}\n","// /assets/scripts/chatbot/components/carousel-component.js\n\nexport class CarouselComponent extends HTMLElement {\n  constructor() {\n    super();\n    this.attachShadow({ mode: \"open\" });\n    this._eventBus = null;\n\n    // Initialize properties\n    this.items = [];\n    this.currentIndex = 0;\n    this.mediaQuery = window.matchMedia(\"(min-width: 1000px)\");\n    this.isDesktop = this.mediaQuery.matches;\n\n    // Bind methods\n    this.moveLeft = this.moveLeft.bind(this);\n    this.moveRight = this.moveRight.bind(this);\n    this.handleMediaQueryChange = this.handleMediaQueryChange.bind(this);\n    this.handleButtonClick = this.handleButtonClick.bind(this);\n  }\n\n  set eventBus(bus) {\n    this._eventBus = bus;\n  }\n\n  connectedCallback() {\n    const dataAttr = this.getAttribute(\"data-carousel\");\n    if (!dataAttr) {\n      console.error(\n        \"No data-carousel attribute found. Cannot render carousel.\"\n      );\n      return;\n    }\n\n    let carouselData;\n    try {\n      carouselData = JSON.parse(dataAttr);\n    } catch (err) {\n      console.error(\"Failed to parse carousel data:\", err);\n      return;\n    }\n\n    if (!carouselData || !Array.isArray(carouselData.cards)) {\n      console.error(\"carouselData.cards is not defined or not an array\");\n      return;\n    }\n\n    this.renderCarousel(carouselData);\n    this.mediaQuery.addEventListener(\"change\", this.handleMediaQueryChange);\n  }\n\n  disconnectedCallback() {\n    this.mediaQuery.removeEventListener(\"change\", this.handleMediaQueryChange);\n  }\n  /**\n   * Renders the carousel with embedded styles and initializes functionality.\n   * @param {Object} carouselData - Data for the carousel containing a 'cards' array.\n   */\n  renderCarousel(carouselData) {\n    this.carouselData = carouselData;\n    this.shadowRoot.innerHTML = `\n      <style>\n        h6 {\n          font-family: var(--heading-font-family);\n          font-weight: var(--heading-font-weight);\n          font-style: var(--heading-font-style);\n          letter-spacing: var(--heading-letter-spacing);\n          text-transform: var(--heading-text-transform);\n          overflow-wrap: anywhere;\n          font-size: var(--text-sm);\n        }\n\n        .button {\n          --button-background: var(--button-background-primary) /\n            var(--button-background-opacity, 1);\n          --button-text-color: var(--button-text-primary);\n          --button-outline-color: white;\n          -webkit-appearance: none;\n          appearance: none;\n          border-color: white;\n          border-radius: 8px;\n          border-width: 1px;\n          background-color: rgb(var(--button-background));\n          color: rgb(var(--button-text-color));\n          text-align: center;\n          font-size: var(--text-h6);\n          letter-spacing: var(--text-letter-spacing);\n          padding-block-start: var(--spacing-2-5);\n          padding-block-end: var(--spacing-2-5);\n          font-weight: bold;\n          line-height: 1.6;\n          transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n          display: inline-block;\n          position: relative;\n        }\n\n        .carousel {\n          position: relative;\n          width: 100%;\n          overflow: hidden;\n          margin-bottom: var(--spacing-4);\n          box-sizing: border-box;\n        }\n\n        .carousel__container {\n          display: flex;\n          flex-wrap: nowrap;\n          transition: transform 0.3s ease-out;\n          width: 100%;\n          overflow: visible;\n        }\n\n         .carousel__item {\n          flex: 0 0 100%;\n          display: block;\n          box-sizing: border-box;\n          max-width: 100%;\n          align-items: flex-start;\n        }\n\n        .carousel__item-wrapper {\n          flex: 0 0 100%;\n          max-width: 100%;\n          min-width: 0;\n        }\n\n        .carousel__button {\n          position: absolute;\n          top: 50%;\n          transform: translateY(-50%);\n          background: rgba(255, 255, 255, 0.8);\n          border: solid 1px #403545;\n          width: 40px;\n          height: 40px;\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          cursor: pointer;\n          z-index: 2;\n          margin-block-start: var(--spacing-0) !important;\n        }\n\n         .carousel__button[disabled] {\n          opacity: 0;\n          pointer-events: none;\n        }\n\n        .carousel__button--left {\n          left: 10px;\n        }\n\n        .carousel__button--right {\n          right: 20px;\n        }\n\n        .carousel__item-button {\n          font-size: var(--text-sm);\n        }\n\n        .carousel__item-content {\n          background: #FFFFFF;\n          border-radius: 8px;\n          padding: var(--spacing-4);\n          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n          height: 100%;\n          display: flex;\n          flex-direction: column;\n        }\n\n        .carousel__item-image {\n          width: 100%;\n          height: auto;\n          border-radius: 8px;\n          margin-bottom: var(--spacing-2);\n          object-fit: cover;\n        }\n\n        .carousel__item-title {\n          font-weight: bold;\n          margin-bottom: var(--spacing-0);\n          margin-top: var(--spacing-0);\n          font-size: var(--text-base);\n        }\n\n        .carousel__item-description {\n          margin-bottom: var(--spacing-4);\n          margin-top: var(--spacing-0);\n          font-size: var(--text-sm);\n          color: #403545 !important;\n          flex-grow: 1;\n        }\n\n        @media (min-width: 1000px) {\n          .carousel__item {\n            flex: 0 0 50%;\n            max-width: 50%;\n          }\n\n          .carousel__item-wrapper {\n            flex: 0 0 calc(100% - var(--spacing-2));\n            max-width: calc(100% - var(--spacing-2));\n          }\n        }\n      </style>\n      <div class=\"carousel\">\n        <div class=\"carousel__container\">\n          <!-- Items appended here -->\n        </div>\n        <button class=\"carousel__button carousel__button--left\" aria-label=\"Previous slide\">\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n               xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M15 18L9 12L15 6\" stroke=\"currentColor\" stroke-width=\"2\"\n                  stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        </button>\n        <button class=\"carousel__button carousel__button--right\" aria-label=\"Next slide\">\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n               xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M9 18L15 12L9 6\" stroke=\"currentColor\" stroke-width=\"2\"\n                  stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        </button>\n      </div>\n    `;\n\n    this.carouselContainer = this.shadowRoot.querySelector(\n      \".carousel__container\"\n    );\n    this.leftButton = this.shadowRoot.querySelector(\".carousel__button--left\");\n    this.rightButton = this.shadowRoot.querySelector(\n      \".carousel__button--right\"\n    );\n\n    // Add items to carousel\n    this.carouselData.cards.forEach((card, index) => {\n      const item = document.createElement(\"div\");\n      item.classList.add(\"carousel__item\");\n\n      item.innerHTML = `\n        <div class=\"carousel__item-wrapper\">\n          <div class=\"carousel__item-content\">\n            ${\n              card.imageUrl\n                ? `<img src=\"${card.imageUrl}\" alt=\"${\n                    card.title || \"\"\n                  }\" class=\"carousel__item-image\">`\n                : \"\"\n            }\n            ${\n              card.title\n                ? `<h6 class=\"carousel__item-title\">${card.title}</h6>`\n                : \"\"\n            }\n            ${\n              card.description\n                ? `<p class=\"carousel__item-description\">${card.description.text}</p>`\n                : \"\"\n            }\n            ${\n              card.buttons && card.buttons.length > 0\n                ? `<button class=\"button carousel__item-button\" data-button-index=\"${index}\">${card.buttons[0].name}</button>`\n                : \"\"\n            }\n          </div>\n        </div>\n      `;\n\n      if (card.buttons && card.buttons.length > 0) {\n        const button = item.querySelector(\".carousel__item-button\");\n        button.addEventListener(\"click\", this.handleButtonClick);\n      }\n\n      this.carouselContainer.appendChild(item);\n      this.items.push(item);\n    });\n\n    // Set up event listeners\n    this.leftButton.addEventListener(\"click\", this.moveLeft);\n    this.rightButton.addEventListener(\"click\", this.moveRight);\n\n    this.updateVisibility();\n    this.updatePosition();\n  }\n\n  handleMediaQueryChange(e) {\n    this.isDesktop = e.matches;\n    this.currentIndex = 0;\n    this.updatePosition();\n    this.updateVisibility();\n  }\n\n  moveLeft() {\n    const itemsPerSlide = this.isDesktop ? 2 : 1;\n    this.currentIndex = Math.max(0, this.currentIndex - itemsPerSlide);\n    this.updatePosition();\n    this.updateVisibility();\n  }\n\n  moveRight() {\n    const itemsPerSlide = this.isDesktop ? 2 : 1;\n    this.currentIndex = Math.min(\n      this.items.length - itemsPerSlide,\n      this.currentIndex + itemsPerSlide\n    );\n    this.updatePosition();\n    this.updateVisibility();\n  }\n\n  updatePosition() {\n    const itemsPerSlide = this.isDesktop ? 2 : 1;\n    const offset = -(this.currentIndex / itemsPerSlide) * 100;\n    this.carouselContainer.style.transform = `translateX(${offset}%)`;\n  }\n\n  updateVisibility() {\n    const itemsPerSlide = this.isDesktop ? 2 : 1;\n    this.leftButton.style.display = this.currentIndex === 0 ? \"none\" : \"flex\";\n    this.rightButton.style.display =\n      this.currentIndex >= this.items.length - itemsPerSlide ? \"none\" : \"flex\";\n  }\n\n  handleButtonClick(e) {\n    if (!this._eventBus) {\n      console.error(\"No eventBus assigned to CarouselComponent\");\n      return;\n    }\n\n    const button = e.target;\n    const buttonIndex = parseInt(button.getAttribute(\"data-button-index\"), 10);\n    const card = this.carouselData.cards[buttonIndex];\n\n    if (!card || !card.buttons || card.buttons.length === 0) {\n      console.warn(\"No button data found for this card.\");\n      return;\n    }\n\n    const buttonData = card.buttons[0];\n    const productTitle = buttonData.request.payload.title;\n    const displayLabel = productTitle\n      ? `Selected ${productTitle}`\n      : \"Selected Power Station\";\n\n    this._eventBus.emit(\"buttonClicked\", {\n      action: buttonData.request,\n      label: displayLabel,\n    });\n\n    this.remove();\n  }\n}\n","// frontend/components/ui/chatbot-components.js\nimport { ButtonComponent } from \"./button-component.js\";\nimport { MessageComponent } from \"./message-component.js\";\nimport { CarouselComponent } from \"./carousel-component.js\";\n\n// Register custom components\ncustomElements.define(\"button-component\", ButtonComponent);\ncustomElements.define(\"message-component\", MessageComponent);\ncustomElements.define(\"carousel-component\", CarouselComponent);\nconsole.log(\"MessageComponent defined\");\nconsole.log(\"ButtonComponent defined\");\nconsole.log(\"CarouselComponent defined\");\n"],"names":["animateText","element","text","animationSpeed","resolve","index","lastTime","animate","currentTime","animateHTMLContent","container","htmlContent","speed","temp","node","span","el","ButtonComponent","bus","label","payload","parsedPayload","error","MessageComponent","sender","content","messageContent","normalizedContent","StreamingMarkdownParser","htmlSegment","normalizedSegment","newChunk","html","parseMarkdown","tempDiv","normalizeNode","isAssistant","CarouselComponent","dataAttr","carouselData","err","card","item","e","itemsPerSlide","offset","button","buttonIndex","buttonData","productTitle","displayLabel"],"mappings":"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"}