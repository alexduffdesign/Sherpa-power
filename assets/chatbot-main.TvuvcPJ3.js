import{e as o,g as c,C as h,E as i}from"./user-id-generator.C4djdQVl.js";import"./chatbot-core-file.DqvJXvYX.js";class l{constructor(t){if(this.container=t,this.form=this.container.querySelector(".chat-form"),this.input=this.container.querySelector("input[type='text']"),this.messageContainer=this.container.querySelector(".message-container"),!this.container){console.error("Main Chatbot UI container not found");return}if(!this.form||!this.input){console.error("Main Chatbot form or input not found");return}this.setupEventListeners()}setupEventListeners(){this.form.addEventListener("submit",t=>{t.preventDefault();const e=this.input.value.trim();e&&(this.emit("userMessage",e),this.input.value="",this.saveToHistory("user",e))})}onUserMessage(t){o.on("userMessage",t)}onButtonClick(t){o.on("buttonClicked",t)}emit(t,e){const s=new CustomEvent(t,{detail:e});this.container.dispatchEvent(s)}addMessage(t,e){const s=document.createElement("message-component");s.setAttribute("sender",t),s.setAttribute("content",e),this.container.querySelector(".chatbot-container").appendChild(s),this.scrollToBottom(),this.saveToHistory(t,e)}addButtons(t){t.forEach(e=>{const s=document.createElement("button-component");s.setAttribute("label",e.name),s.setAttribute("payload",JSON.stringify(e.request)),this.container.querySelector(".chatbot-container").appendChild(s)}),this.scrollToBottom(),this.container.querySelector(".chatbot-container").addEventListener("click",e=>{if(e.target.closest("button-component")){const s=e.target.closest("button-component"),n=JSON.parse(s.getAttribute("payload"));this.emit("buttonClicked",n),this.removeInteractiveElements()}})}addCarousel(t){const e=document.createElement("carousel-component");e.setAttribute("items",JSON.stringify(t)),this.container.querySelector(".chatbot-container").appendChild(e),this.scrollToBottom()}showTypingIndicator(){const t=document.createElement("div");t.classList.add("typing-indicator"),t.innerText="Assistant is typing...",this.container.querySelector(".chatbot-container").appendChild(t),this.scrollToBottom()}hideTypingIndicator(){const t=this.container.querySelector(".typing-indicator");t&&t.remove()}displayError(t){const e=document.createElement("div");e.classList.add("error-message"),e.innerText=t,this.container.querySelector(".chatbot-container").appendChild(e),this.scrollToBottom()}scrollToBottom(){this.container.scrollTop=this.container.scrollHeight}saveToHistory(t,e){const s=JSON.parse(localStorage.getItem("mainChatbotHistory"))||[];s.push({sender:t,message:e}),localStorage.setItem("mainChatbotHistory",JSON.stringify(s))}removeInteractiveElements(){this.container.querySelectorAll("button-component, carousel-component").forEach(e=>e.remove())}}class u{constructor(t,e){this.core=t,this.ui=e,this.historyKey="mainChatbotHistory",this.isLaunched=!1,this.setupEventListeners()}setupEventListeners(){o.on(i.MAIN_CHATBOT.MESSAGE_RECEIVED,t=>{this.ui.addMessage("assistant",t.content)}),o.on(i.MAIN_CHATBOT.CHOICE_PRESENTED,t=>{this.ui.addButtons(t.choices)}),o.on(i.MAIN_CHATBOT.CAROUSEL_PRESENTED,t=>{this.ui.addCarousel(t.carouselItems)}),o.on(i.MAIN_CHATBOT.ERROR,t=>{this.ui.displayError(t.message)}),o.on(i.MAIN_CHATBOT.TYPING,t=>{t.isTyping?this.ui.showTypingIndicator():this.ui.hideTypingIndicator()}),document.addEventListener("chatbotLaunch",()=>{this.launch()})}launch(){this.isLaunched||(this.core.sendLaunch(),this.isLaunched=!0)}sendMessage(t){const e=this.sanitizeInput(t);this.core.sendMessage(e),this.ui.addMessage("user",e),this.saveToHistory("user",e)}loadHistory(){const t=JSON.parse(localStorage.getItem(this.historyKey))||[];t.forEach(e=>{this.ui.addMessage(e.sender,e.message)}),t.length>0&&t[t.length-1].sender}saveToHistory(t,e){const s=JSON.parse(localStorage.getItem(this.historyKey))||[];s.push({sender:t,message:e}),localStorage.setItem(this.historyKey,JSON.stringify(s))}sanitizeInput(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("main-chatbot-ui");if(!a){console.error("Main Chatbot UI container not found");return}let t=localStorage.getItem("mainChatbotUserId");t||(t=c("mainChatbot"),localStorage.setItem("mainChatbotUserId",t));const e=new h({userID:t,endpoint:"https://chatbottings--development.gadget.app/voiceflowAPI/voiceflow-streaming",chatbotType:"main"}),s=new l(a),n=new u(e,s);n.loadHistory(),s.onUserMessage(r=>{n.sendMessage(r)}),s.onButtonClick(r=>{n.sendMessage(JSON.stringify(r))})});export{u as M};
//# sourceMappingURL=chatbot-main.TvuvcPJ3.js.map
