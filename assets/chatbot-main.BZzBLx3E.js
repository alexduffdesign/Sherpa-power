import{e as n,g as l,C as d,E as a}from"./user-id-generator.Df9BxPRd.js";import"./chatbot-core-file.DqvJXvYX.js";class m{constructor(t){if(this.container=t,this.form=this.container.querySelector(".chat-form"),this.input=this.container.querySelector("input[type='text']"),this.messageContainer=this.container.querySelector(".message-container"),!this.container){console.error("Main Chatbot UI container not found");return}if(!this.form||!this.input){console.error("Main Chatbot form or input not found");return}this.setupEventListeners()}setupEventListeners(){this.form.addEventListener("submit",t=>{t.preventDefault();const e=this.input.value.trim();e&&(this.emit("userMessage",e),this.input.value="",this.saveToHistory("user",e))})}onUserMessage(t){n.on("userMessage",t)}onButtonClick(t){n.on("buttonClicked",t)}emit(t,e){const s=new CustomEvent(t,{detail:e});this.container.dispatchEvent(s)}addMessage(t,e){const s=document.createElement("message-component");s.setAttribute("sender",t),s.setAttribute("content",e),this.messageContainer.appendChild(s),this.scrollToBottom(),this.saveToHistory(t,e)}addButtons(t){t.forEach(e=>{const s=document.createElement("button-component");s.setAttribute("label",e.name),s.setAttribute("payload",JSON.stringify(e.request)),this.messageContainer.appendChild(s)}),this.scrollToBottom(),this.messageContainer.addEventListener("click",e=>{if(e.target.closest("button-component")){const s=e.target.closest("button-component"),o=JSON.parse(s.getAttribute("payload"));this.emit("buttonClicked",o),this.removeInteractiveElements()}})}addCarousel(t){const e=document.createElement("carousel-component");e.setAttribute("items",JSON.stringify(t)),this.messageContainer.appendChild(e),this.scrollToBottom()}showTypingIndicator(){const t=document.createElement("div");t.classList.add("typing-indicator"),t.innerText="Assistant is typing...",this.messageContainer.appendChild(t),this.scrollToBottom()}hideTypingIndicator(){const t=this.messageContainer.querySelector(".typing-indicator");t&&t.remove()}displayError(t){const e=document.createElement("div");e.classList.add("error-message"),e.innerText=t,this.messageContainer.appendChild(e),this.scrollToBottom()}scrollToBottom(){this.container.scrollTop=this.container.scrollHeight}saveToHistory(t,e){const s=JSON.parse(localStorage.getItem("mainChatbotHistory"))||[];s.push({sender:t,message:e}),localStorage.setItem("mainChatbotHistory",JSON.stringify(s))}removeInteractiveElements(){this.messageContainer.querySelectorAll("button-component, carousel-component").forEach(e=>e.remove())}}class u{constructor(t,e){this.core=t,this.ui=e,this.historyKey="mainChatbotHistory",this.isLaunched=!1,this.setupEventListeners()}setupEventListeners(){n.on(a.MAIN_CHATBOT.MESSAGE_RECEIVED,t=>{this.ui.addMessage("assistant",t.content)}),n.on(a.MAIN_CHATBOT.CHOICE_PRESENTED,t=>{this.ui.addButtons(t.choices)}),n.on(a.MAIN_CHATBOT.CAROUSEL_PRESENTED,t=>{this.ui.addCarousel(t.carouselItems)}),n.on(a.MAIN_CHATBOT.ERROR,t=>{this.ui.displayError(t.message)})}launch(){this.isLaunched||(this.core.sendLaunch(),this.isLaunched=!0)}sendMessage(t){this.core.sendMessage(t),this.ui.addMessage("user",t),this.saveToHistory("user",t)}loadHistory(){const t=JSON.parse(localStorage.getItem(this.historyKey))||[];t.forEach(e=>{this.ui.addMessage(e.sender,e.message)}),t.length>0&&t[t.length-1].sender}saveToHistory(t,e){const s=JSON.parse(localStorage.getItem(this.historyKey))||[];s.push({sender:t,message:e}),localStorage.setItem(this.historyKey,JSON.stringify(s))}}document.addEventListener("DOMContentLoaded",()=>{const i=document.getElementById("main-chatbot-ui");if(!i){console.error("Main Chatbot UI container not found");return}let t=localStorage.getItem("mainChatbotUserId");t||(t=l("mainChatbot"),localStorage.setItem("mainChatbotUserId",t));const e=new d({userID:t,endpoint:"https://chatbottings--development.gadget.app/voiceflowAPI/voiceflow-streaming",chatbotType:"main"}),s=new m(i),o=new u(e,s);o.loadHistory(),s.onUserMessage(r=>{o.sendMessage(r)}),s.onButtonClick(r=>{o.sendMessage(JSON.stringify(r))});let c=!1;const h=document.getElementById("header-ai-trigger");h?h.addEventListener("click",()=>{c||(o.launch(),c=!0)}):console.error("Chatbot drawer element not found")});export{u as M};
//# sourceMappingURL=chatbot-main.BZzBLx3E.js.map
