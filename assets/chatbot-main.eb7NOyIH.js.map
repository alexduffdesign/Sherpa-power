{"version":3,"file":"chatbot-main.eb7NOyIH.js","sources":["../frontend/utils/user-id-generator.js","../frontend/mainChatbot/chatbot-main.js"],"sourcesContent":["/**\n * Generates a unique user ID with the specified prefix.\n * @param {string} prefix - The prefix indicating the chatbot type ('mainChatbot' or 'sectionChatbot').\n * @returns {string} - The generated unique user ID.\n */\nexport function generateUserId(prefix) {\n  const uniquePart =\n    Date.now().toString(36) + Math.random().toString(36).substr(2, 9);\n  return `${prefix}-${uniquePart}`;\n}\n","// /frontend/mainChatbot/chatbot-main.js\n\nimport ChatbotCore from \"../baseChatbot/base-chatbot.js\";\nimport MainChatbotUI from \"./chatbot-main-ui.js\";\nimport { generateUserId } from \"../utils/user-id-generator.js\";\n\n/**\n * MainChatbot Class\n * Handles main chatbot functionality including history management and drawer integration\n */\nclass MainChatbot {\n  /**\n   * @param {HTMLElement} container - The container element for the chatbot\n   */\n  constructor(container) {\n    this.container = container;\n    this.historyKey = \"mainChatbotHistory\";\n    this.launchKey = \"chatHasLaunched\";\n    this.isLaunched = this.hasLaunched();\n\n    // Initialize core and UI\n    this.initialize();\n  }\n\n  /**\n   * Initialize the chatbot components\n   * @private\n   */\n  initialize() {\n    // Set up user ID\n    let userId = localStorage.getItem(\"mainChatbotUserId\");\n    if (!userId) {\n      userId = generateUserId(\"mainChatbot\");\n      localStorage.setItem(\"mainChatbotUserId\", userId);\n    }\n\n    // Initialize core\n    this.core = new ChatbotCore({\n      type: \"main\",\n      endpoint:\n        \"https://chatbottings--development.gadget.app/voiceflowAPI/voiceflow-streaming\",\n      userID: userId,\n    });\n\n    // Initialize UI\n    this.ui = new MainChatbotUI({\n      container: this.container,\n      eventBus: this.core.eventBus,\n      type: \"main\",\n    });\n\n    this.setupEventListeners();\n    this.loadHistory();\n  }\n\n  /**\n   * Set up event listeners\n   * @private\n   */\n  setupEventListeners() {\n    // Handle user messages\n    this.core.eventBus.on(\"userMessage\", (message) => {\n      this.saveToHistory(\"user\", message);\n    });\n\n    // Handle bot messages\n    this.core.eventBus.on(\"messageReceived\", ({ content, metadata }) => {\n      this.saveToHistory(\"assistant\", content, metadata);\n    });\n\n    // Handle choice presentation (saves them to history)\n    this.core.eventBus.on(\"choicePresented\", ({ buttons }) => {\n      this.saveToHistory(\"assistant\", \"Choice presented\", {\n        type: \"choice\",\n        buttons: buttons,\n      });\n    });\n\n    // Handle button clicks\n    this.core.eventBus.on(\"buttonClicked\", (payload) => {\n      this.saveToHistory(\"user\", payload.label || \"Button clicked\");\n    });\n\n    // Handle main menu\n    this.core.eventBus.on(\"mainMenu\", () => {\n      this.core.sendAction({\n        action: {\n          type: \"event\",\n          payload: {\n            event: {\n              name: \"main_menu\",\n            },\n          },\n        },\n      });\n    });\n  }\n\n  /**\n   * Check if chatbot has been launched before\n   * @private\n   * @returns {boolean}\n   */\n  hasLaunched() {\n    return localStorage.getItem(this.launchKey) === \"true\";\n  }\n\n  /**\n   * Set launched state\n   * @private\n   */\n  setLaunched() {\n    localStorage.setItem(this.launchKey, \"true\");\n    this.isLaunched = true;\n  }\n\n  /**\n   * Launch the chatbot\n   * @public\n   */\n  async launch() {\n    if (this.isLaunched) {\n      console.log(\"Chat already launched, skipping launch request\");\n      return;\n    }\n\n    try {\n      await this.core.sendLaunch();\n      this.setLaunched();\n    } catch (error) {\n      console.error(\"Error launching chatbot:\", error);\n      this.ui.displayError(\n        \"Failed to launch the chatbot. Please try again later.\"\n      );\n    }\n  }\n\n  /**\n   * Save message to history\n   * @private\n   * @param {string} sender - Message sender\n   * @param {string} message - Message content\n   * @param {Object} metadata - Optional metadata\n   */\n  saveToHistory(sender, message, metadata = null) {\n    const history = JSON.parse(localStorage.getItem(this.historyKey)) || [];\n\n    const historyEntry = {\n      sender,\n      message,\n      timestamp: Date.now(),\n      isInteractive: false,\n    };\n\n    if (sender === \"assistant\" && metadata) {\n      if (metadata.type === \"choice\") {\n        historyEntry.isInteractive = true;\n        historyEntry.traceType = \"choice\";\n        historyEntry.traceData = { buttons: metadata.buttons };\n      } else if (metadata.type === \"carousel\") {\n        historyEntry.isInteractive = true;\n        historyEntry.traceType = \"carousel\";\n        historyEntry.traceData = { cards: metadata.carouselItems };\n      }\n    }\n\n    history.push(historyEntry);\n    localStorage.setItem(this.historyKey, JSON.stringify(history));\n  }\n\n  /**\n   * Load conversation history\n   * @private\n   */\n  loadHistory() {\n    const history = JSON.parse(localStorage.getItem(this.historyKey)) || [];\n\n    history.forEach((entry, index) => {\n      if (entry.isInteractive) {\n        if (index === history.length - 1) {\n          this.restoreInteractiveElement(entry);\n        }\n        return;\n      }\n\n      if (entry.message) {\n        this.ui.addMessage(entry.sender, entry.message);\n      }\n    });\n  }\n\n  /**\n   * Restore interactive elements from history\n   * @private\n   * @param {Object} historyEntry - The history entry to restore\n   */\n  restoreInteractiveElement(historyEntry) {\n    if (historyEntry.traceType === \"choice\") {\n      this.ui.addButtons(historyEntry.traceData.buttons, true);\n    } else if (historyEntry.traceType === \"carousel\") {\n      this.ui.addCarousel(historyEntry.traceData.cards, true);\n    }\n  }\n\n  /**\n   * Clear chat history\n   * @public\n   */\n  clearHistory() {\n    localStorage.removeItem(this.historyKey);\n    localStorage.removeItem(this.launchKey);\n    this.isLaunched = false;\n    this.ui.clearChat();\n  }\n\n  /**\n   * Clean up resources\n   * @public\n   */\n  destroy() {\n    this.core.destroy();\n    this.ui.destroy();\n  }\n}\n\nexport default MainChatbot;\nwindow.MainChatbot = MainChatbot;\n"],"names":["generateUserId","prefix","uniquePart","MainChatbot","container","userId","ChatbotCore","MainChatbotUI","message","content","metadata","buttons","payload","error","sender","history","historyEntry","entry","index"],"mappings":"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"}