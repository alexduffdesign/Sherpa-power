import{e as i,g as l,C as d,E as c}from"./user-id-generator.Df9BxPRd.js";import"./chatbot-core-file.DqvJXvYX.js";class h{constructor(t){if(this.container=t,this.form=this.container.querySelector("form#section-chatbot-form"),this.input=this.container.querySelector("#section-chatbot-input"),!this.form||!this.input){console.error("Section Chatbot form or input not found");return}this.productTitle=this.getAttribute("product-title"),this.productCapacity=this.getAttribute("product-capacity"),this.acOutputContinuousPower=this.getAttribute("product-ac_output_continuous_power"),this.acOutputPeakPower=this.getAttribute("product-ac_output_peak_power"),this.dcOutputPower=this.getAttribute("product-dc_output_power"),this.startBlock="shopifySection",this.productDetails={title:this.productTitle,capacity:this.productCapacity,ac_output_continuous_power:this.acOutputContinuousPower,ac_output_peak_power:this.acOutputPeakPower,dc_output_power:this.dcOutputPower},this.setupEventListeners()}setupEventListeners(){this.form.addEventListener("submit",t=>{t.preventDefault();const e=this.input.value.trim();e&&(this.emit("userMessage",e),this.input.value="")})}onUserMessage(t){i.on("userMessage",t)}onButtonClick(t){i.on("buttonClicked",t)}emit(t,e){const o=new CustomEvent(t,{detail:e});this.container.dispatchEvent(o)}addMessage(t,e){const o=document.createElement("message-component");o.setAttribute("sender",t),o.setAttribute("content",e),this.container.querySelector(".chatbot-container").appendChild(o),this.scrollToBottom()}addButtons(t){t.forEach(e=>{const o=document.createElement("button-component");o.setAttribute("label",e.name),o.setAttribute("payload",JSON.stringify(e.request)),this.container.querySelector(".chatbot-container").appendChild(o)}),this.scrollToBottom(),this.container.querySelector(".chatbot-container").addEventListener("click",e=>{if(e.target.closest("button-component")){const o=e.target.closest("button-component"),s=JSON.parse(o.getAttribute("payload"));this.emit("buttonClicked",s),this.removeInteractiveElements()}})}addCarousel(t){const e=document.createElement("carousel-component");e.setAttribute("items",JSON.stringify(t)),this.container.querySelector(".chatbot-container").appendChild(e),this.scrollToBottom()}populateApplicationsGrid(t){const e=document.querySelector(".applications-grid");if(!e){console.error("Applications grid not found");return}t.forEach(o=>{const s=document.createElement("div");s.classList.add("application-card","chatbot-card"),s.innerHTML=`
        <div class="application-card__image">
          <img src="${o.imageUrl}" alt="${o.name}" />
        </div>
        <div class="application-card__content">
          <div class="application-card__title">${o.name}</div>
          <div class="application-card__runtime">${o.estimatedRuntime}</div>
        </div>
      `,e.appendChild(s)}),this.scrollToBottom()}displayError(t){const e=document.createElement("div");e.classList.add("error-message"),e.innerText=t,this.container.querySelector(".chatbot-container").appendChild(e),this.scrollToBottom()}scrollToBottom(){this.container.scrollTop=this.container.scrollHeight}getAttribute(t){return this.container.getAttribute(t)}removeInteractiveElements(){this.container.querySelectorAll("button-component, carousel-component").forEach(e=>e.remove())}}class p{constructor(t,e){this.core=t,this.ui=e,this.isLaunched=!1,this.setupEventListeners()}setupEventListeners(){i.on(c.SECTION_CHATBOT.MESSAGE_RECEIVED,t=>{this.ui.addMessage("assistant",t.content)}),i.on(c.SECTION_CHATBOT.CHOICE_PRESENTED,t=>{this.ui.addButtons(t.choices)}),i.on(c.SECTION_CHATBOT.CAROUSEL_PRESENTED,t=>{this.ui.addCarousel(t.carouselItems)}),i.on(c.SECTION_CHATBOT.DEVICE_ANSWER,t=>{this.ui.populateApplicationsGrid(t.devices)}),i.on(c.SECTION_CHATBOT.ERROR,t=>{this.ui.displayError(t.message)})}launch(){if(this.isLaunched)return;const t={action:{type:"launch",payload:{startBlock:"shopifySection",productDetails:this.ui.productDetails}}};this.core.sendLaunch(t),this.isLaunched=!0}sendMessage(t){this.core.sendMessage(t),this.ui.addMessage("user",t)}}document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("section-chatbot-ui");if(!n){console.error("Section Chatbot UI container not found");return}let t=localStorage.getItem("sectionChatbotUserId");t||(t=l("sectionChatbot"),localStorage.setItem("sectionChatbotUserId",t));const e=new d({userID:t,endpoint:"https://chatbottings--development.gadget.app/voiceflowAPI/voiceflow-streaming",chatbotType:"section"}),o=new h(n),s=new p(e,o);o.onUserMessage(r=>{s.sendMessage(r)}),o.onButtonClick(r=>{s.sendMessage(JSON.stringify(r))});let a=!1;const u=n.querySelector("#section-chatbot-input");u?u.addEventListener("focus",()=>{a||(s.launch(),a=!0)}):console.error("Section Chatbot input field not found")});
//# sourceMappingURL=chatbot-section.CTe8oMAG.js.map
